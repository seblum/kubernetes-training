<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 Exemplary ML workflow | MLOps Engineering</title>
  <meta name="description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 Exemplary ML workflow | MLOps Engineering" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  <meta name="github-repo" content="seblum/mlops-engineering-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 Exemplary ML workflow | MLOps Engineering" />
  
  <meta name="twitter:description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  

<meta name="author" content="Sebastian Blum" />


<meta name="date" content="2024-02-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="core-components.html"/>
<link rel="next" href="airflow-infrastructure.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MLOps Engineering</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="preamble.html"><a href="preamble.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html"><i class="fa fa-check"></i><b>1.1</b> Machine Learning Workflow</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html#ml-worflow-tools"><i class="fa fa-check"></i><b>1.1.1</b> ML Worflow Tools</a></li>
<li class="chapter" data-level="1.1.2" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html#developing-machine-learning-models"><i class="fa fa-check"></i><b>1.1.2</b> Developing Machine Learning Models</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html"><i class="fa fa-check"></i><b>1.2</b> Machine Learning Operations (MLOps)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#ml-dev-ops"><i class="fa fa-check"></i><b>1.2.1</b> ML + (Dev)-Ops</a></li>
<li class="chapter" data-level="1.2.2" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#mlops-lifecycle"><i class="fa fa-check"></i><b>1.2.2</b> MLOps Lifecycle</a></li>
<li class="chapter" data-level="1.2.3" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#mlops-engineering"><i class="fa fa-check"></i><b>1.2.3</b> MLOps Engineering</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html"><i class="fa fa-check"></i><b>1.3</b> Roles and Tasks in MLOps</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#data-engineer"><i class="fa fa-check"></i><b>1.3.1</b> Data Engineer</a></li>
<li class="chapter" data-level="1.3.2" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#data-scientist"><i class="fa fa-check"></i><b>1.3.2</b> Data Scientist</a></li>
<li class="chapter" data-level="1.3.3" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#ml-engineer"><i class="fa fa-check"></i><b>1.3.3</b> ML Engineer</a></li>
<li class="chapter" data-level="1.3.4" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#mlops-engineer"><i class="fa fa-check"></i><b>1.3.4</b> MLOps Engineer</a></li>
<li class="chapter" data-level="1.3.5" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#devops-engineer"><i class="fa fa-check"></i><b>1.3.5</b> DevOps Engineer</a></li>
<li class="chapter" data-level="1.3.6" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#additional-roles-function"><i class="fa fa-check"></i><b>1.3.6</b> Additional roles &amp; function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ops-tools-and-principles.html"><a href="ops-tools-and-principles.html"><i class="fa fa-check"></i><b>2</b> Ops Tools and Principles</a>
<ul>
<li class="chapter" data-level="2.1" data-path="containerization.html"><a href="containerization.html"><i class="fa fa-check"></i><b>2.1</b> Containerization</a></li>
<li class="chapter" data-level="2.2" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>2.2</b> Version Control</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="version-control.html"><a href="version-control.html#github"><i class="fa fa-check"></i><b>2.2.1</b> Github</a></li>
<li class="chapter" data-level="2.2.2" data-path="version-control.html"><a href="version-control.html#git-lifecycle"><i class="fa fa-check"></i><b>2.2.2</b> Git lifecycle</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cicd.html"><a href="cicd.html"><i class="fa fa-check"></i><b>2.3</b> CI/CD</a>
<ul>
<li class="chapter" data-level="" data-path="cicd.html"><a href="cicd.html#github-actions"><i class="fa fa-check"></i>Github Actions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="infrastructure-as-code.html"><a href="infrastructure-as-code.html"><i class="fa fa-check"></i><b>2.4</b> Infrastructure as code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="airflow.html"><a href="airflow.html"><i class="fa fa-check"></i><b>3</b> Airflow</a>
<ul>
<li class="chapter" data-level="3.1" data-path="core-components.html"><a href="core-components.html"><i class="fa fa-check"></i><b>3.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="core-components.html"><a href="core-components.html#dags"><i class="fa fa-check"></i><b>3.1.1</b> DAGs</a></li>
<li class="chapter" data-level="3.1.2" data-path="core-components.html"><a href="core-components.html#operators"><i class="fa fa-check"></i><b>3.1.2</b> Operators</a></li>
<li class="chapter" data-level="3.1.3" data-path="core-components.html"><a href="core-components.html#tasks"><i class="fa fa-check"></i><b>3.1.3</b> Tasks</a></li>
<li class="chapter" data-level="3.1.4" data-path="core-components.html"><a href="core-components.html#xcom"><i class="fa fa-check"></i><b>3.1.4</b> XCom</a></li>
<li class="chapter" data-level="3.1.5" data-path="core-components.html"><a href="core-components.html#scheduling"><i class="fa fa-check"></i><b>3.1.5</b> Scheduling</a></li>
<li class="chapter" data-level="3.1.6" data-path="core-components.html"><a href="core-components.html#taskflow"><i class="fa fa-check"></i><b>3.1.6</b> Taskflow</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="exemplary-ml-workflow.html"><a href="exemplary-ml-workflow.html"><i class="fa fa-check"></i><b>3.2</b> Exemplary ML workflow</a></li>
<li class="chapter" data-level="3.3" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html"><i class="fa fa-check"></i><b>3.3</b> Airflow infrastructure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#airflow-as-a-distributed-system"><i class="fa fa-check"></i><b>3.3.1</b> Airflow as a distributed system</a></li>
<li class="chapter" data-level="3.3.2" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#scheduler"><i class="fa fa-check"></i><b>3.3.2</b> Scheduler</a></li>
<li class="chapter" data-level="3.3.3" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#webserver"><i class="fa fa-check"></i><b>3.3.3</b> Webserver</a></li>
<li class="chapter" data-level="3.3.4" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#executor"><i class="fa fa-check"></i><b>3.3.4</b> Executor</a></li>
<li class="chapter" data-level="3.3.5" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#dag-directory"><i class="fa fa-check"></i><b>3.3.5</b> DAG Directory</a></li>
<li class="chapter" data-level="3.3.6" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#metadata-database"><i class="fa fa-check"></i><b>3.3.6</b> Metadata Database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mlflow.html"><a href="mlflow.html"><i class="fa fa-check"></i><b>4</b> MLflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="core-components-1.html"><a href="core-components-1.html"><i class="fa fa-check"></i><b>4.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-tracking"><i class="fa fa-check"></i><b>4.1.1</b> MLflow Tracking</a></li>
<li class="chapter" data-level="4.1.2" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-models"><i class="fa fa-check"></i><b>4.1.2</b> MLflow Models</a></li>
<li class="chapter" data-level="4.1.3" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-model-registry"><i class="fa fa-check"></i><b>4.1.3</b> MLflow Model Registry</a></li>
<li class="chapter" data-level="4.1.4" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-projects"><i class="fa fa-check"></i><b>4.1.4</b> MLflow Projects</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html"><i class="fa fa-check"></i><b>4.2</b> MLFflow Architecture</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-tracking-server"><i class="fa fa-check"></i><b>4.2.1</b> MLflow Tracking Server</a></li>
<li class="chapter" data-level="4.2.2" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-backend-store"><i class="fa fa-check"></i><b>4.2.2</b> MLflow Backend Store</a></li>
<li class="chapter" data-level="4.2.3" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-artifact-store"><i class="fa fa-check"></i><b>4.2.3</b> MLflow Artifact Store</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="kubernetes.html"><a href="kubernetes.html"><i class="fa fa-check"></i><b>5</b> Kubernetes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="core-components-2.html"><a href="core-components-2.html"><i class="fa fa-check"></i><b>5.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="core-components-2.html"><a href="core-components-2.html#nodes"><i class="fa fa-check"></i><b>5.1.1</b> Nodes</a></li>
<li class="chapter" data-level="5.1.2" data-path="core-components-2.html"><a href="core-components-2.html#pods"><i class="fa fa-check"></i><b>5.1.2</b> Pods</a></li>
<li class="chapter" data-level="5.1.3" data-path="core-components-2.html"><a href="core-components-2.html#imperative-declarative-management"><i class="fa fa-check"></i><b>5.1.3</b> Imperative &amp; Declarative Management</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="application-deployment-design.html"><a href="application-deployment-design.html"><i class="fa fa-check"></i><b>5.2</b> Application Deployment &amp; Design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="application-deployment-design.html"><a href="application-deployment-design.html#deployments"><i class="fa fa-check"></i><b>5.2.1</b> Deployments</a></li>
<li class="chapter" data-level="5.2.2" data-path="application-deployment-design.html"><a href="application-deployment-design.html#resource-management"><i class="fa fa-check"></i><b>5.2.2</b> Resource Management</a></li>
<li class="chapter" data-level="5.2.3" data-path="application-deployment-design.html"><a href="application-deployment-design.html#daemonsets"><i class="fa fa-check"></i><b>5.2.3</b> DaemonSets</a></li>
<li class="chapter" data-level="5.2.4" data-path="application-deployment-design.html"><a href="application-deployment-design.html#statefulsets"><i class="fa fa-check"></i><b>5.2.4</b> StatefulSets</a></li>
<li class="chapter" data-level="5.2.5" data-path="application-deployment-design.html"><a href="application-deployment-design.html#jobs-cron-jobs"><i class="fa fa-check"></i><b>5.2.5</b> Jobs &amp; Cron Jobs</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="services-and-networking.html"><a href="services-and-networking.html"><i class="fa fa-check"></i><b>5.3</b> Services and Networking</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="services-and-networking.html"><a href="services-and-networking.html#services"><i class="fa fa-check"></i><b>5.3.1</b> Services</a></li>
<li class="chapter" data-level="5.3.2" data-path="services-and-networking.html"><a href="services-and-networking.html#service-discovery"><i class="fa fa-check"></i><b>5.3.2</b> Service Discovery</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html"><i class="fa fa-check"></i><b>5.4</b> Volumes and Storage</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#emptydir-volume"><i class="fa fa-check"></i><b>5.4.1</b> EmptyDir Volume</a></li>
<li class="chapter" data-level="5.4.2" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#hostpath-volume"><i class="fa fa-check"></i><b>5.4.2</b> HostPath Volume</a></li>
<li class="chapter" data-level="5.4.3" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#persistent-volumes"><i class="fa fa-check"></i><b>5.4.3</b> Persistent Volumes</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html"><i class="fa fa-check"></i><b>5.5</b> Environment, Configuration &amp; Security</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#namespaces"><i class="fa fa-check"></i><b>5.5.1</b> Namespaces</a></li>
<li class="chapter" data-level="5.5.2" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#labels-selectors-and-annotations"><i class="fa fa-check"></i><b>5.5.2</b> Labels, Selectors and Annotations</a></li>
<li class="chapter" data-level="5.5.3" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#configmaps"><i class="fa fa-check"></i><b>5.5.3</b> ConfigMaps</a></li>
<li class="chapter" data-level="5.5.4" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#secrets"><i class="fa fa-check"></i><b>5.5.4</b> Secrets</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="observability-maintenance.html"><a href="observability-maintenance.html"><i class="fa fa-check"></i><b>5.6</b> Observability &amp; Maintenance</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="observability-maintenance.html"><a href="observability-maintenance.html#health-checks"><i class="fa fa-check"></i><b>5.6.1</b> Health Checks</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="helm.html"><a href="helm.html"><i class="fa fa-check"></i><b>5.7</b> Helm</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="helm.html"><a href="helm.html#helm-chart-structure"><i class="fa fa-check"></i><b>5.7.1</b> Helm Chart Structure</a></li>
<li class="chapter" data-level="5.7.2" data-path="helm.html"><a href="helm.html#working-with-helm"><i class="fa fa-check"></i><b>5.7.2</b> Working with Helm</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="terraform.html"><a href="terraform.html"><i class="fa fa-check"></i><b>6</b> Terraform</a>
<ul>
<li class="chapter" data-level="6.1" data-path="basic-usage.html"><a href="basic-usage.html"><i class="fa fa-check"></i><b>6.1</b> Basic usage</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="basic-usage.html"><a href="basic-usage.html#terraform-init"><i class="fa fa-check"></i><b>6.1.1</b> terraform init</a></li>
<li class="chapter" data-level="6.1.2" data-path="basic-usage.html"><a href="basic-usage.html#terraform-validate"><i class="fa fa-check"></i><b>6.1.2</b> terraform validate</a></li>
<li class="chapter" data-level="6.1.3" data-path="basic-usage.html"><a href="basic-usage.html#terraform-plan"><i class="fa fa-check"></i><b>6.1.3</b> terraform plan</a></li>
<li class="chapter" data-level="6.1.4" data-path="basic-usage.html"><a href="basic-usage.html#terraform-apply"><i class="fa fa-check"></i><b>6.1.4</b> terraform apply</a></li>
<li class="chapter" data-level="6.1.5" data-path="basic-usage.html"><a href="basic-usage.html#terraform-destroy"><i class="fa fa-check"></i><b>6.1.5</b> terraform destroy</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="core-components-3.html"><a href="core-components-3.html"><i class="fa fa-check"></i><b>6.2</b> Core Components</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="core-components-3.html"><a href="core-components-3.html#providers"><i class="fa fa-check"></i><b>6.2.1</b> Providers</a></li>
<li class="chapter" data-level="6.2.2" data-path="core-components-3.html"><a href="core-components-3.html#resources"><i class="fa fa-check"></i><b>6.2.2</b> Resources</a></li>
<li class="chapter" data-level="6.2.3" data-path="core-components-3.html"><a href="core-components-3.html#data-sources"><i class="fa fa-check"></i><b>6.2.3</b> Data Sources</a></li>
<li class="chapter" data-level="6.2.4" data-path="core-components-3.html"><a href="core-components-3.html#state"><i class="fa fa-check"></i><b>6.2.4</b> State</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="modules.html"><a href="modules.html"><i class="fa fa-check"></i><b>6.3</b> Modules</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="modules.html"><a href="modules.html#input-variables"><i class="fa fa-check"></i><b>6.3.1</b> Input Variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="modules.html"><a href="modules.html#output-variables"><i class="fa fa-check"></i><b>6.3.2</b> Output Variables</a></li>
<li class="chapter" data-level="6.3.3" data-path="modules.html"><a href="modules.html#local-variables"><i class="fa fa-check"></i><b>6.3.3</b> Local Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html"><i class="fa fa-check"></i><b>6.4</b> Additional tips &amp; tricks</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#count"><i class="fa fa-check"></i><b>6.4.1</b> count</a></li>
<li class="chapter" data-level="6.4.2" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#for-each"><i class="fa fa-check"></i><b>6.4.2</b> for-each</a></li>
<li class="chapter" data-level="6.4.3" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#for"><i class="fa fa-check"></i><b>6.4.3</b> for</a></li>
<li class="chapter" data-level="6.4.4" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#workspaces"><i class="fa fa-check"></i><b>6.4.4</b> Workspaces</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html"><i class="fa fa-check"></i><b>6.5</b> Exemplary Deployment</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#root"><i class="fa fa-check"></i><b>6.5.1</b> root</a></li>
<li class="chapter" data-level="6.5.2" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#vpc"><i class="fa fa-check"></i><b>6.5.2</b> vpc</a></li>
<li class="chapter" data-level="6.5.3" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#run-the-code"><i class="fa fa-check"></i><b>6.5.3</b> Run the code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ml-platform-design.html"><a href="ml-platform-design.html"><i class="fa fa-check"></i><b>7</b> ML Platform Design</a>
<ul>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#infrastructure"><i class="fa fa-check"></i>Infrastructure</a></li>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#mlops-tools"><i class="fa fa-check"></i>MLOps Tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="platform-deployment.html"><a href="platform-deployment.html"><i class="fa fa-check"></i><b>8</b> Platform Deployment</a>
<ul>
<li class="chapter" data-level="8.1" data-path="root-module.html"><a href="root-module.html"><i class="fa fa-check"></i><b>8.1</b> Root module</a></li>
<li class="chapter" data-level="8.2" data-path="infrastructure-2.html"><a href="infrastructure-2.html"><i class="fa fa-check"></i><b>8.2</b> Infrastructure</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="infrastructure-2.html"><a href="infrastructure-2.html#virtual-private-cloud"><i class="fa fa-check"></i><b>8.2.1</b> Virtual Private Cloud</a></li>
<li class="chapter" data-level="8.2.2" data-path="infrastructure-2.html"><a href="infrastructure-2.html#elastic-kubernetes-service"><i class="fa fa-check"></i><b>8.2.2</b> Elastic Kubernetes Service</a></li>
<li class="chapter" data-level="8.2.3" data-path="infrastructure-2.html"><a href="infrastructure-2.html#networking"><i class="fa fa-check"></i><b>8.2.3</b> Networking</a></li>
<li class="chapter" data-level="8.2.4" data-path="infrastructure-2.html"><a href="infrastructure-2.html#relational-database-service"><i class="fa fa-check"></i><b>8.2.4</b> Relational Database Service</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>8.3</b> Components</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="components.html"><a href="components.html#user-profiles"><i class="fa fa-check"></i><b>8.3.1</b> User Profiles</a></li>
<li class="chapter" data-level="8.3.2" data-path="components.html"><a href="components.html#airflow-1"><i class="fa fa-check"></i><b>8.3.2</b> Airflow</a></li>
<li class="chapter" data-level="8.3.3" data-path="components.html"><a href="components.html#mlflow-1"><i class="fa fa-check"></i><b>8.3.3</b> Mlflow</a></li>
<li class="chapter" data-level="8.3.4" data-path="components.html"><a href="components.html#jupyterhub"><i class="fa fa-check"></i><b>8.3.4</b> Jupyterhub</a></li>
<li class="chapter" data-level="8.3.5" data-path="components.html"><a href="components.html#monitoring"><i class="fa fa-check"></i><b>8.3.5</b> Monitoring</a></li>
<li class="chapter" data-level="8.3.6" data-path="components.html"><a href="components.html#sagemaker"><i class="fa fa-check"></i><b>8.3.6</b> Sagemaker</a></li>
<li class="chapter" data-level="8.3.7" data-path="components.html"><a href="components.html#dashboard"><i class="fa fa-check"></i><b>8.3.7</b> Dashboard</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="design-decisions.html"><a href="design-decisions.html"><i class="fa fa-check"></i><b>8.4</b> Design Decisions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="use-case-development.html"><a href="use-case-development.html"><i class="fa fa-check"></i><b>9</b> Use Case Development</a>
<ul>
<li class="chapter" data-level="9.1" data-path="integrated-development-environment-1.html"><a href="integrated-development-environment-1.html"><i class="fa fa-check"></i><b>9.1</b> Integrated Development Environment</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="integrated-development-environment-1.html"><a href="integrated-development-environment-1.html#github-repository"><i class="fa fa-check"></i><b>9.1.1</b> Github Repository</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html"><i class="fa fa-check"></i><b>9.2</b> Training &amp; Deployment Pipeline Workflow</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#airflow-workflow"><i class="fa fa-check"></i><b>9.2.1</b> Airflow Workflow</a></li>
<li class="chapter" data-level="9.2.2" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#mlflow-integration"><i class="fa fa-check"></i><b>9.2.2</b> MLflow integration</a></li>
<li class="chapter" data-level="9.2.3" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#pipeline-workflow"><i class="fa fa-check"></i><b>9.2.3</b> Pipeline Workflow</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html"><i class="fa fa-check"></i><b>9.3</b> Pipeline Workflow Steps</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#data-preprocessing"><i class="fa fa-check"></i><b>9.3.1</b> Data Preprocessing</a></li>
<li class="chapter" data-level="9.3.2" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#model-training"><i class="fa fa-check"></i><b>9.3.2</b> Model Training</a></li>
<li class="chapter" data-level="9.3.3" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#model-comparison"><i class="fa fa-check"></i><b>9.3.3</b> Model Comparison</a></li>
<li class="chapter" data-level="9.3.4" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#model-deployment-serving"><i class="fa fa-check"></i><b>9.3.4</b> Model Deployment &amp; Serving</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="model-inferencing.html"><a href="model-inferencing.html"><i class="fa fa-check"></i><b>9.4</b> Model Inferencing</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="model-inferencing.html"><a href="model-inferencing.html#pipeline-workflow-1"><i class="fa fa-check"></i><b>9.4.1</b> Pipeline Workflow</a></li>
<li class="chapter" data-level="9.4.2" data-path="model-inferencing.html"><a href="model-inferencing.html#inference-workflow-code"><i class="fa fa-check"></i><b>9.4.2</b> Inference Workflow Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i>Contributing</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MLOps Engineering</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exemplary-ml-workflow" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Exemplary ML workflow<a href="exemplary-ml-workflow.html#exemplary-ml-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following shows an exemplary Airflow DAG by building a MNIST Image Classification Workflow with Keras and the Taskflow API. The DAG automates the process of training and testing a convolutional neural network (CNN) model using the popular MNIST dataset and Keras. The DAG demonstrates how to set up a simple task flow for data preprocessing, model training, and model testing. A python file of the DAG can be found <a href="https://github.com/seblum/mlops-engineering-book/tree/master/manuscript/files/05-Airflow/08_exemlary-ML-Workflow">here</a></p>
<p>The Airflow DAG is named <code>"tutorial_mnist_keras_taskflow_api"</code> and is designed to be informative and easy to understand. It includes three distinct tasks: <code>preprocess_data()</code>, <code>train_model(data_paths_dict)</code>, and <code>test_model(model_name)</code>. These tasks collectively create a streamlined workflow for building, training, and evaluating a deep learning model.</p>
<p>The <code>preprocess_data()</code> task preprocesses the MNIST dataset, which includes loading and scaling the image data and converting class labels into categorical format. The preprocessed data is then saved as NumPy arrays for subsequent use. This task returns a dictionary containing file paths to these preprocessed data arrays.</p>
<p>The <code>train_model(data_paths_dict)</code> task is responsible for building and training the Keras CNN model. It starts by loading the preprocessed data using the data paths provided in the input dictionary. The CNN architecture comprises convolutional and pooling layers, followed by flattening and dense layers. After model compilation, training begins with specified hyperparameters such as batch size and epochs. Once training is complete, the model is saved with a name, and the task returns this name as output.</p>
<p>The <code>test_model(model_name)</code> task loads the trained Keras model using the provided model name and evaluates its performance on the test dataset. It calculates and prints both the test loss and accuracy, providing insights into how well the model generalizes to unseen data.</p>
<p>The DAG execution flow is straightforward. It starts with the <code>preprocess_data()</code> task, which prepares the data for model training. The output of this task is then passed as an input to the <code>train_model(data_paths_dict)</code> task, where the CNN model is constructed and trained. Finally, the <code>test_model(model_name)</code> task tests the trained model and reports its performance metrics.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="exemplary-ml-workflow.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="at">@dag</span>(</span>
<span id="cb22-2"><a href="exemplary-ml-workflow.html#cb22-2" aria-hidden="true" tabindex="-1"></a>    dag_id<span class="op">=</span><span class="st">&quot;tutorial_mnist_keras_taskflow_api&quot;</span>,</span>
<span id="cb22-3"><a href="exemplary-ml-workflow.html#cb22-3" aria-hidden="true" tabindex="-1"></a>    schedule<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb22-4"><a href="exemplary-ml-workflow.html#cb22-4" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span>pendulum.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">1</span>, tz<span class="op">=</span><span class="st">&quot;UTC&quot;</span>),</span>
<span id="cb22-5"><a href="exemplary-ml-workflow.html#cb22-5" aria-hidden="true" tabindex="-1"></a>    catchup<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb22-6"><a href="exemplary-ml-workflow.html#cb22-6" aria-hidden="true" tabindex="-1"></a>    tags<span class="op">=</span>[<span class="st">&quot;example&quot;</span>, <span class="st">&quot;mnist&quot;</span>, <span class="st">&quot;keras&quot;</span>],</span>
<span id="cb22-7"><a href="exemplary-ml-workflow.html#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="exemplary-ml-workflow.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tutorial_mnist_keras_taskflow_api():</span>
<span id="cb22-9"><a href="exemplary-ml-workflow.html#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb22-10"><a href="exemplary-ml-workflow.html#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">    This Airflow DAG demonstrates a simple task flow for training and testing a Keras model on the MNIST dataset.</span></span>
<span id="cb22-11"><a href="exemplary-ml-workflow.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">    It consists of three tasks: preprocess_data, train_model, and test_model.</span></span>
<span id="cb22-12"><a href="exemplary-ml-workflow.html#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb22-13"><a href="exemplary-ml-workflow.html#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="exemplary-ml-workflow.html#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">@task</span>()</span>
<span id="cb22-15"><a href="exemplary-ml-workflow.html#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> preprocess_data():</span>
<span id="cb22-16"><a href="exemplary-ml-workflow.html#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb22-17"><a href="exemplary-ml-workflow.html#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Preprocesses the MNIST dataset, scaling it and saving the preprocessed data as NumPy arrays.</span></span>
<span id="cb22-18"><a href="exemplary-ml-workflow.html#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="exemplary-ml-workflow.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb22-20"><a href="exemplary-ml-workflow.html#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">            dict: A dictionary containing file paths to the preprocessed data arrays.</span></span>
<span id="cb22-21"><a href="exemplary-ml-workflow.html#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb22-22"><a href="exemplary-ml-workflow.html#cb22-22" aria-hidden="true" tabindex="-1"></a>        dirname <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>dirname(<span class="va">__file__</span>)<span class="sc">}</span><span class="ss">/data/&quot;</span></span>
<span id="cb22-23"><a href="exemplary-ml-workflow.html#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;dirname: &quot;</span>, dirname)</span>
<span id="cb22-24"><a href="exemplary-ml-workflow.html#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="exemplary-ml-workflow.html#cb22-25" aria-hidden="true" tabindex="-1"></a>        num_classes <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb22-26"><a href="exemplary-ml-workflow.html#cb22-26" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>dirname<span class="sc">}</span><span class="ss">mnist.npz&quot;</span></span>
<span id="cb22-27"><a href="exemplary-ml-workflow.html#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="exemplary-ml-workflow.html#cb22-28" aria-hidden="true" tabindex="-1"></a>        (x_train, y_train), (x_test, y_test) <span class="op">=</span> keras.datasets.mnist.load_data(path<span class="op">=</span>path)</span>
<span id="cb22-29"><a href="exemplary-ml-workflow.html#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="exemplary-ml-workflow.html#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Scale images to the [0, 1] range</span></span>
<span id="cb22-31"><a href="exemplary-ml-workflow.html#cb22-31" aria-hidden="true" tabindex="-1"></a>        x_train <span class="op">=</span> x_train.astype(<span class="st">&quot;float32&quot;</span>) <span class="op">/</span> <span class="dv">255</span></span>
<span id="cb22-32"><a href="exemplary-ml-workflow.html#cb22-32" aria-hidden="true" tabindex="-1"></a>        x_test <span class="op">=</span> x_test.astype(<span class="st">&quot;float32&quot;</span>) <span class="op">/</span> <span class="dv">255</span></span>
<span id="cb22-33"><a href="exemplary-ml-workflow.html#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make sure images have shape (28, 28, 1)</span></span>
<span id="cb22-34"><a href="exemplary-ml-workflow.html#cb22-34" aria-hidden="true" tabindex="-1"></a>        x_train <span class="op">=</span> np.expand_dims(x_train, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb22-35"><a href="exemplary-ml-workflow.html#cb22-35" aria-hidden="true" tabindex="-1"></a>        x_test <span class="op">=</span> np.expand_dims(x_test, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb22-36"><a href="exemplary-ml-workflow.html#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;x_train shape:&quot;</span>, x_train.shape)</span>
<span id="cb22-37"><a href="exemplary-ml-workflow.html#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(x_train.shape[<span class="dv">0</span>], <span class="st">&quot;train samples&quot;</span>)</span>
<span id="cb22-38"><a href="exemplary-ml-workflow.html#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(x_test.shape[<span class="dv">0</span>], <span class="st">&quot;test samples&quot;</span>)</span>
<span id="cb22-39"><a href="exemplary-ml-workflow.html#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="exemplary-ml-workflow.html#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># convert class vectors to binary class matrices</span></span>
<span id="cb22-41"><a href="exemplary-ml-workflow.html#cb22-41" aria-hidden="true" tabindex="-1"></a>        y_train <span class="op">=</span> keras.utils.to_categorical(y_train, num_classes)</span>
<span id="cb22-42"><a href="exemplary-ml-workflow.html#cb22-42" aria-hidden="true" tabindex="-1"></a>        y_test <span class="op">=</span> keras.utils.to_categorical(y_test, num_classes)</span>
<span id="cb22-43"><a href="exemplary-ml-workflow.html#cb22-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-44"><a href="exemplary-ml-workflow.html#cb22-44" aria-hidden="true" tabindex="-1"></a>        y_train_path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>dirname<span class="sc">}</span><span class="ss">y_train.npy&quot;</span></span>
<span id="cb22-45"><a href="exemplary-ml-workflow.html#cb22-45" aria-hidden="true" tabindex="-1"></a>        x_train_path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>dirname<span class="sc">}</span><span class="ss">x_train.npy&quot;</span></span>
<span id="cb22-46"><a href="exemplary-ml-workflow.html#cb22-46" aria-hidden="true" tabindex="-1"></a>        y_test_path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>dirname<span class="sc">}</span><span class="ss">y_test.npy&quot;</span></span>
<span id="cb22-47"><a href="exemplary-ml-workflow.html#cb22-47" aria-hidden="true" tabindex="-1"></a>        x_test_path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>dirname<span class="sc">}</span><span class="ss">x_test.npy&quot;</span></span>
<span id="cb22-48"><a href="exemplary-ml-workflow.html#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="exemplary-ml-workflow.html#cb22-49" aria-hidden="true" tabindex="-1"></a>        np.save(y_train_path, y_train)</span>
<span id="cb22-50"><a href="exemplary-ml-workflow.html#cb22-50" aria-hidden="true" tabindex="-1"></a>        np.save(x_train_path, x_train)</span>
<span id="cb22-51"><a href="exemplary-ml-workflow.html#cb22-51" aria-hidden="true" tabindex="-1"></a>        np.save(y_test_path, y_test)</span>
<span id="cb22-52"><a href="exemplary-ml-workflow.html#cb22-52" aria-hidden="true" tabindex="-1"></a>        np.save(x_test_path, x_test)</span>
<span id="cb22-53"><a href="exemplary-ml-workflow.html#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="exemplary-ml-workflow.html#cb22-54" aria-hidden="true" tabindex="-1"></a>        data_paths_dict <span class="op">=</span> {</span>
<span id="cb22-55"><a href="exemplary-ml-workflow.html#cb22-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;y_train_path&quot;</span>: y_train_path,</span>
<span id="cb22-56"><a href="exemplary-ml-workflow.html#cb22-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;x_train_path&quot;</span>: x_train_path,</span>
<span id="cb22-57"><a href="exemplary-ml-workflow.html#cb22-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;y_test_path&quot;</span>: y_test_path,</span>
<span id="cb22-58"><a href="exemplary-ml-workflow.html#cb22-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;x_test_path&quot;</span>: x_test_path,</span>
<span id="cb22-59"><a href="exemplary-ml-workflow.html#cb22-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb22-60"><a href="exemplary-ml-workflow.html#cb22-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data_paths_dict</span>
<span id="cb22-61"><a href="exemplary-ml-workflow.html#cb22-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-62"><a href="exemplary-ml-workflow.html#cb22-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">@task</span>(multiple_outputs<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-63"><a href="exemplary-ml-workflow.html#cb22-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train_model(data_paths_dict: <span class="bu">dict</span>):</span>
<span id="cb22-64"><a href="exemplary-ml-workflow.html#cb22-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb22-65"><a href="exemplary-ml-workflow.html#cb22-65" aria-hidden="true" tabindex="-1"></a><span class="co">        Trains a Keras model on the preprocessed MNIST dataset.</span></span>
<span id="cb22-66"><a href="exemplary-ml-workflow.html#cb22-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-67"><a href="exemplary-ml-workflow.html#cb22-67" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb22-68"><a href="exemplary-ml-workflow.html#cb22-68" aria-hidden="true" tabindex="-1"></a><span class="co">            data_paths_dict (dict): A dictionary containing file paths to the preprocessed data arrays.</span></span>
<span id="cb22-69"><a href="exemplary-ml-workflow.html#cb22-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-70"><a href="exemplary-ml-workflow.html#cb22-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb22-71"><a href="exemplary-ml-workflow.html#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="co">            model_data_paths_dict: A dictionary containing file paths to the preprocessed data arrays and the model name after training.</span></span>
<span id="cb22-72"><a href="exemplary-ml-workflow.html#cb22-72" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb22-73"><a href="exemplary-ml-workflow.html#cb22-73" aria-hidden="true" tabindex="-1"></a>        dirname <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>dirname(<span class="va">__file__</span>)<span class="sc">}</span><span class="ss">/data/&quot;</span></span>
<span id="cb22-74"><a href="exemplary-ml-workflow.html#cb22-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;dirname: &quot;</span>, dirname)</span>
<span id="cb22-75"><a href="exemplary-ml-workflow.html#cb22-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-76"><a href="exemplary-ml-workflow.html#cb22-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">## Load preprocessed train data</span></span>
<span id="cb22-77"><a href="exemplary-ml-workflow.html#cb22-77" aria-hidden="true" tabindex="-1"></a>        y_train <span class="op">=</span> np.load(data_paths_dict.get(<span class="st">&quot;y_train_path&quot;</span>))</span>
<span id="cb22-78"><a href="exemplary-ml-workflow.html#cb22-78" aria-hidden="true" tabindex="-1"></a>        x_train <span class="op">=</span> np.load(data_paths_dict.get(<span class="st">&quot;x_train_path&quot;</span>))</span>
<span id="cb22-79"><a href="exemplary-ml-workflow.html#cb22-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-80"><a href="exemplary-ml-workflow.html#cb22-80" aria-hidden="true" tabindex="-1"></a>        <span class="co">## Build the model</span></span>
<span id="cb22-81"><a href="exemplary-ml-workflow.html#cb22-81" aria-hidden="true" tabindex="-1"></a>        input_shape <span class="op">=</span> (<span class="dv">28</span>, <span class="dv">28</span>, <span class="dv">1</span>)</span>
<span id="cb22-82"><a href="exemplary-ml-workflow.html#cb22-82" aria-hidden="true" tabindex="-1"></a>        num_classes <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb22-83"><a href="exemplary-ml-workflow.html#cb22-83" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> keras.Sequential(</span>
<span id="cb22-84"><a href="exemplary-ml-workflow.html#cb22-84" aria-hidden="true" tabindex="-1"></a>            [</span>
<span id="cb22-85"><a href="exemplary-ml-workflow.html#cb22-85" aria-hidden="true" tabindex="-1"></a>                keras.Input(shape<span class="op">=</span>input_shape),</span>
<span id="cb22-86"><a href="exemplary-ml-workflow.html#cb22-86" aria-hidden="true" tabindex="-1"></a>                layers.Conv2D(<span class="dv">32</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>),</span>
<span id="cb22-87"><a href="exemplary-ml-workflow.html#cb22-87" aria-hidden="true" tabindex="-1"></a>                layers.MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb22-88"><a href="exemplary-ml-workflow.html#cb22-88" aria-hidden="true" tabindex="-1"></a>                layers.Conv2D(<span class="dv">64</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>),</span>
<span id="cb22-89"><a href="exemplary-ml-workflow.html#cb22-89" aria-hidden="true" tabindex="-1"></a>                layers.MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb22-90"><a href="exemplary-ml-workflow.html#cb22-90" aria-hidden="true" tabindex="-1"></a>                layers.Flatten(),</span>
<span id="cb22-91"><a href="exemplary-ml-workflow.html#cb22-91" aria-hidden="true" tabindex="-1"></a>                layers.Dropout(<span class="fl">0.5</span>),</span>
<span id="cb22-92"><a href="exemplary-ml-workflow.html#cb22-92" aria-hidden="true" tabindex="-1"></a>                layers.Dense(num_classes, activation<span class="op">=</span><span class="st">&quot;softmax&quot;</span>),</span>
<span id="cb22-93"><a href="exemplary-ml-workflow.html#cb22-93" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb22-94"><a href="exemplary-ml-workflow.html#cb22-94" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-95"><a href="exemplary-ml-workflow.html#cb22-95" aria-hidden="true" tabindex="-1"></a>        model.summary()</span>
<span id="cb22-96"><a href="exemplary-ml-workflow.html#cb22-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-97"><a href="exemplary-ml-workflow.html#cb22-97" aria-hidden="true" tabindex="-1"></a>        <span class="co">## Train the model</span></span>
<span id="cb22-98"><a href="exemplary-ml-workflow.html#cb22-98" aria-hidden="true" tabindex="-1"></a>        batch_size <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb22-99"><a href="exemplary-ml-workflow.html#cb22-99" aria-hidden="true" tabindex="-1"></a>        epochs <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb22-100"><a href="exemplary-ml-workflow.html#cb22-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-101"><a href="exemplary-ml-workflow.html#cb22-101" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">compile</span>(</span>
<span id="cb22-102"><a href="exemplary-ml-workflow.html#cb22-102" aria-hidden="true" tabindex="-1"></a>            loss<span class="op">=</span><span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer<span class="op">=</span><span class="st">&quot;adam&quot;</span>, metrics<span class="op">=</span>[<span class="st">&quot;accuracy&quot;</span>]</span>
<span id="cb22-103"><a href="exemplary-ml-workflow.html#cb22-103" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-104"><a href="exemplary-ml-workflow.html#cb22-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-105"><a href="exemplary-ml-workflow.html#cb22-105" aria-hidden="true" tabindex="-1"></a>        model.fit(</span>
<span id="cb22-106"><a href="exemplary-ml-workflow.html#cb22-106" aria-hidden="true" tabindex="-1"></a>            x_train, y_train, batch_size<span class="op">=</span>batch_size, epochs<span class="op">=</span>epochs, validation_split<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb22-107"><a href="exemplary-ml-workflow.html#cb22-107" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-108"><a href="exemplary-ml-workflow.html#cb22-108" aria-hidden="true" tabindex="-1"></a>        model_path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>dirname<span class="sc">}</span><span class="ss">model.keras&quot;</span></span>
<span id="cb22-109"><a href="exemplary-ml-workflow.html#cb22-109" aria-hidden="true" tabindex="-1"></a>        model.save(model_path)</span>
<span id="cb22-110"><a href="exemplary-ml-workflow.html#cb22-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-111"><a href="exemplary-ml-workflow.html#cb22-111" aria-hidden="true" tabindex="-1"></a>        model_data_paths_dict <span class="op">=</span> deepcopy(data_paths_dict)</span>
<span id="cb22-112"><a href="exemplary-ml-workflow.html#cb22-112" aria-hidden="true" tabindex="-1"></a>        model_data_paths_dict[<span class="st">&quot;model_name&quot;</span>] <span class="op">=</span> model_path</span>
<span id="cb22-113"><a href="exemplary-ml-workflow.html#cb22-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> model_data_paths_dict</span>
<span id="cb22-114"><a href="exemplary-ml-workflow.html#cb22-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-115"><a href="exemplary-ml-workflow.html#cb22-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">@task</span>()</span>
<span id="cb22-116"><a href="exemplary-ml-workflow.html#cb22-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_model(model_data_paths_dict: <span class="bu">str</span>):</span>
<span id="cb22-117"><a href="exemplary-ml-workflow.html#cb22-117" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb22-118"><a href="exemplary-ml-workflow.html#cb22-118" aria-hidden="true" tabindex="-1"></a><span class="co">        Tests a trained Keras model on the test dataset and prints the test loss and accuracy.</span></span>
<span id="cb22-119"><a href="exemplary-ml-workflow.html#cb22-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-120"><a href="exemplary-ml-workflow.html#cb22-120" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb22-121"><a href="exemplary-ml-workflow.html#cb22-121" aria-hidden="true" tabindex="-1"></a><span class="co">            model_data_paths_dict: A dictionary containing file paths to the preprocessed data arrays and the model name after training.</span></span>
<span id="cb22-122"><a href="exemplary-ml-workflow.html#cb22-122" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb22-123"><a href="exemplary-ml-workflow.html#cb22-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">## Load preprocessed test data</span></span>
<span id="cb22-124"><a href="exemplary-ml-workflow.html#cb22-124" aria-hidden="true" tabindex="-1"></a>        y_test <span class="op">=</span> np.load(model_data_paths_dict.get(<span class="st">&quot;y_test_path&quot;</span>))</span>
<span id="cb22-125"><a href="exemplary-ml-workflow.html#cb22-125" aria-hidden="true" tabindex="-1"></a>        x_test <span class="op">=</span> np.load(model_data_paths_dict.get(<span class="st">&quot;x_test_path&quot;</span>))</span>
<span id="cb22-126"><a href="exemplary-ml-workflow.html#cb22-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-127"><a href="exemplary-ml-workflow.html#cb22-127" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> keras.models.load_model(model_data_paths_dict.get(<span class="st">&quot;model_name&quot;</span>))</span>
<span id="cb22-128"><a href="exemplary-ml-workflow.html#cb22-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-129"><a href="exemplary-ml-workflow.html#cb22-129" aria-hidden="true" tabindex="-1"></a>        score <span class="op">=</span> model.evaluate(x_test, y_test, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-130"><a href="exemplary-ml-workflow.html#cb22-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Test loss:&quot;</span>, score[<span class="dv">0</span>])</span>
<span id="cb22-131"><a href="exemplary-ml-workflow.html#cb22-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Test accuracy:&quot;</span>, score[<span class="dv">1</span>])</span>
<span id="cb22-132"><a href="exemplary-ml-workflow.html#cb22-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-133"><a href="exemplary-ml-workflow.html#cb22-133" aria-hidden="true" tabindex="-1"></a>    data_paths_dict <span class="op">=</span> preprocess_data()</span>
<span id="cb22-134"><a href="exemplary-ml-workflow.html#cb22-134" aria-hidden="true" tabindex="-1"></a>    model_data_paths_dict <span class="op">=</span> train_model(data_paths_dict)</span>
<span id="cb22-135"><a href="exemplary-ml-workflow.html#cb22-135" aria-hidden="true" tabindex="-1"></a>    test_model(model_data_paths_dict)</span>
<span id="cb22-136"><a href="exemplary-ml-workflow.html#cb22-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-137"><a href="exemplary-ml-workflow.html#cb22-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-138"><a href="exemplary-ml-workflow.html#cb22-138" aria-hidden="true" tabindex="-1"></a>tutorial_mnist_keras_taskflow_api()</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="core-components.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="airflow-infrastructure.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/seblum/kubernetes-training/edit/master/03.2-Airflow-Exemplary_ML_Workflow.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
