<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.3 Components | MLOps Engineering</title>
  <meta name="description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="8.3 Components | MLOps Engineering" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  <meta name="github-repo" content="seblum/mlops-engineering-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.3 Components | MLOps Engineering" />
  
  <meta name="twitter:description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  

<meta name="author" content="Sebastian Blum" />


<meta name="date" content="2024-02-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="infrastructure-2.html"/>
<link rel="next" href="design-decisions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MLOps Engineering</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="preamble.html"><a href="preamble.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html"><i class="fa fa-check"></i><b>1.1</b> Machine Learning Workflow</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html#ml-worflow-tools"><i class="fa fa-check"></i><b>1.1.1</b> ML Worflow Tools</a></li>
<li class="chapter" data-level="1.1.2" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html#developing-machine-learning-models"><i class="fa fa-check"></i><b>1.1.2</b> Developing Machine Learning Models</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html"><i class="fa fa-check"></i><b>1.2</b> Machine Learning Operations (MLOps)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#ml-dev-ops"><i class="fa fa-check"></i><b>1.2.1</b> ML + (Dev)-Ops</a></li>
<li class="chapter" data-level="1.2.2" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#mlops-lifecycle"><i class="fa fa-check"></i><b>1.2.2</b> MLOps Lifecycle</a></li>
<li class="chapter" data-level="1.2.3" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#mlops-engineering"><i class="fa fa-check"></i><b>1.2.3</b> MLOps Engineering</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html"><i class="fa fa-check"></i><b>1.3</b> Roles and Tasks in MLOps</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#data-engineer"><i class="fa fa-check"></i><b>1.3.1</b> Data Engineer</a></li>
<li class="chapter" data-level="1.3.2" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#data-scientist"><i class="fa fa-check"></i><b>1.3.2</b> Data Scientist</a></li>
<li class="chapter" data-level="1.3.3" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#ml-engineer"><i class="fa fa-check"></i><b>1.3.3</b> ML Engineer</a></li>
<li class="chapter" data-level="1.3.4" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#mlops-engineer"><i class="fa fa-check"></i><b>1.3.4</b> MLOps Engineer</a></li>
<li class="chapter" data-level="1.3.5" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#devops-engineer"><i class="fa fa-check"></i><b>1.3.5</b> DevOps Engineer</a></li>
<li class="chapter" data-level="1.3.6" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#additional-roles-function"><i class="fa fa-check"></i><b>1.3.6</b> Additional roles &amp; function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ops-tools-principles.html"><a href="ops-tools-principles.html"><i class="fa fa-check"></i><b>2</b> Ops Tools &amp; Principles</a>
<ul>
<li class="chapter" data-level="2.1" data-path="containerization.html"><a href="containerization.html"><i class="fa fa-check"></i><b>2.1</b> Containerization</a></li>
<li class="chapter" data-level="2.2" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>2.2</b> Version Control</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="version-control.html"><a href="version-control.html#github"><i class="fa fa-check"></i><b>2.2.1</b> Github</a></li>
<li class="chapter" data-level="2.2.2" data-path="version-control.html"><a href="version-control.html#git-lifecycle"><i class="fa fa-check"></i><b>2.2.2</b> Git lifecycle</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cicd.html"><a href="cicd.html"><i class="fa fa-check"></i><b>2.3</b> CI/CD</a></li>
<li class="chapter" data-level="2.4" data-path="infrastructure-as-code.html"><a href="infrastructure-as-code.html"><i class="fa fa-check"></i><b>2.4</b> Infrastructure as code</a></li>
<li class="chapter" data-level="2.5" data-path="containerization-1.html"><a href="containerization-1.html"><i class="fa fa-check"></i><b>2.5</b> Containerization</a></li>
<li class="chapter" data-level="2.6" data-path="version-control-1.html"><a href="version-control-1.html"><i class="fa fa-check"></i><b>2.6</b> Version Control</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="version-control-1.html"><a href="version-control-1.html#github-1"><i class="fa fa-check"></i><b>2.6.1</b> Github</a></li>
<li class="chapter" data-level="2.6.2" data-path="version-control-1.html"><a href="version-control-1.html#git-lifecycle-1"><i class="fa fa-check"></i><b>2.6.2</b> Git lifecycle</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="cicd-1.html"><a href="cicd-1.html"><i class="fa fa-check"></i><b>2.7</b> CI/CD</a>
<ul>
<li class="chapter" data-level="" data-path="cicd-1.html"><a href="cicd-1.html#github-actions"><i class="fa fa-check"></i>Github Actions</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="infrastructure-as-code-1.html"><a href="infrastructure-as-code-1.html"><i class="fa fa-check"></i><b>2.8</b> Infrastructure as code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="airflow.html"><a href="airflow.html"><i class="fa fa-check"></i><b>3</b> Airflow</a>
<ul>
<li class="chapter" data-level="3.1" data-path="core-components.html"><a href="core-components.html"><i class="fa fa-check"></i><b>3.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="core-components.html"><a href="core-components.html#dags"><i class="fa fa-check"></i><b>3.1.1</b> DAGs</a></li>
<li class="chapter" data-level="3.1.2" data-path="core-components.html"><a href="core-components.html#operators"><i class="fa fa-check"></i><b>3.1.2</b> Operators</a></li>
<li class="chapter" data-level="3.1.3" data-path="core-components.html"><a href="core-components.html#tasks"><i class="fa fa-check"></i><b>3.1.3</b> Tasks</a></li>
<li class="chapter" data-level="3.1.4" data-path="core-components.html"><a href="core-components.html#xcom"><i class="fa fa-check"></i><b>3.1.4</b> XCom</a></li>
<li class="chapter" data-level="3.1.5" data-path="core-components.html"><a href="core-components.html#scheduling"><i class="fa fa-check"></i><b>3.1.5</b> Scheduling</a></li>
<li class="chapter" data-level="3.1.6" data-path="core-components.html"><a href="core-components.html#taskflow"><i class="fa fa-check"></i><b>3.1.6</b> Taskflow</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="exemplary-ml-workflow.html"><a href="exemplary-ml-workflow.html"><i class="fa fa-check"></i><b>3.2</b> Exemplary ML workflow</a></li>
<li class="chapter" data-level="3.3" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html"><i class="fa fa-check"></i><b>3.3</b> Airflow infrastructure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#airflow-as-a-distributed-system"><i class="fa fa-check"></i><b>3.3.1</b> Airflow as a distributed system</a></li>
<li class="chapter" data-level="3.3.2" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#scheduler"><i class="fa fa-check"></i><b>3.3.2</b> Scheduler</a></li>
<li class="chapter" data-level="3.3.3" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#webserver"><i class="fa fa-check"></i><b>3.3.3</b> Webserver</a></li>
<li class="chapter" data-level="3.3.4" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#executor"><i class="fa fa-check"></i><b>3.3.4</b> Executor</a></li>
<li class="chapter" data-level="3.3.5" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#dag-directory"><i class="fa fa-check"></i><b>3.3.5</b> DAG Directory</a></li>
<li class="chapter" data-level="3.3.6" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#metadata-database"><i class="fa fa-check"></i><b>3.3.6</b> Metadata Database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mlflow.html"><a href="mlflow.html"><i class="fa fa-check"></i><b>4</b> MLflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="core-components-1.html"><a href="core-components-1.html"><i class="fa fa-check"></i><b>4.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-tracking"><i class="fa fa-check"></i><b>4.1.1</b> MLflow Tracking</a></li>
<li class="chapter" data-level="4.1.2" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-models"><i class="fa fa-check"></i><b>4.1.2</b> MLflow Models</a></li>
<li class="chapter" data-level="4.1.3" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-model-registry"><i class="fa fa-check"></i><b>4.1.3</b> MLflow Model Registry</a></li>
<li class="chapter" data-level="4.1.4" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-projects"><i class="fa fa-check"></i><b>4.1.4</b> MLflow Projects</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html"><i class="fa fa-check"></i><b>4.2</b> MLFflow Architecture</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-tracking-server"><i class="fa fa-check"></i><b>4.2.1</b> MLflow Tracking Server</a></li>
<li class="chapter" data-level="4.2.2" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-backend-store"><i class="fa fa-check"></i><b>4.2.2</b> MLflow Backend Store</a></li>
<li class="chapter" data-level="4.2.3" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-artifact-store"><i class="fa fa-check"></i><b>4.2.3</b> MLflow Artifact Store</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="kubernetes.html"><a href="kubernetes.html"><i class="fa fa-check"></i><b>5</b> Kubernetes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="core-components-2.html"><a href="core-components-2.html"><i class="fa fa-check"></i><b>5.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="core-components-2.html"><a href="core-components-2.html#nodes"><i class="fa fa-check"></i><b>5.1.1</b> Nodes</a></li>
<li class="chapter" data-level="5.1.2" data-path="core-components-2.html"><a href="core-components-2.html#pods"><i class="fa fa-check"></i><b>5.1.2</b> Pods</a></li>
<li class="chapter" data-level="5.1.3" data-path="core-components-2.html"><a href="core-components-2.html#imperative-declarative-management"><i class="fa fa-check"></i><b>5.1.3</b> Imperative &amp; Declarative Management</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="application-deployment-design.html"><a href="application-deployment-design.html"><i class="fa fa-check"></i><b>5.2</b> Application Deployment &amp; Design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="application-deployment-design.html"><a href="application-deployment-design.html#deployments"><i class="fa fa-check"></i><b>5.2.1</b> Deployments</a></li>
<li class="chapter" data-level="5.2.2" data-path="application-deployment-design.html"><a href="application-deployment-design.html#resource-management"><i class="fa fa-check"></i><b>5.2.2</b> Resource Management</a></li>
<li class="chapter" data-level="5.2.3" data-path="application-deployment-design.html"><a href="application-deployment-design.html#daemonsets"><i class="fa fa-check"></i><b>5.2.3</b> DaemonSets</a></li>
<li class="chapter" data-level="5.2.4" data-path="application-deployment-design.html"><a href="application-deployment-design.html#statefulsets"><i class="fa fa-check"></i><b>5.2.4</b> StatefulSets</a></li>
<li class="chapter" data-level="5.2.5" data-path="application-deployment-design.html"><a href="application-deployment-design.html#jobs-cron-jobs"><i class="fa fa-check"></i><b>5.2.5</b> Jobs &amp; Cron Jobs</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="services-and-networking.html"><a href="services-and-networking.html"><i class="fa fa-check"></i><b>5.3</b> Services and Networking</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="services-and-networking.html"><a href="services-and-networking.html#services"><i class="fa fa-check"></i><b>5.3.1</b> Services</a></li>
<li class="chapter" data-level="5.3.2" data-path="services-and-networking.html"><a href="services-and-networking.html#service-discovery"><i class="fa fa-check"></i><b>5.3.2</b> Service Discovery</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html"><i class="fa fa-check"></i><b>5.4</b> Volumes and Storage</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#emptydir-volume"><i class="fa fa-check"></i><b>5.4.1</b> EmptyDir Volume</a></li>
<li class="chapter" data-level="5.4.2" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#hostpath-volume"><i class="fa fa-check"></i><b>5.4.2</b> HostPath Volume</a></li>
<li class="chapter" data-level="5.4.3" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#persistent-volumes"><i class="fa fa-check"></i><b>5.4.3</b> Persistent Volumes</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html"><i class="fa fa-check"></i><b>5.5</b> Environment, Configuration &amp; Security</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#namespaces"><i class="fa fa-check"></i><b>5.5.1</b> Namespaces</a></li>
<li class="chapter" data-level="5.5.2" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#labels-selectors-and-annotations"><i class="fa fa-check"></i><b>5.5.2</b> Labels, Selectors and Annotations</a></li>
<li class="chapter" data-level="5.5.3" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#configmaps"><i class="fa fa-check"></i><b>5.5.3</b> ConfigMaps</a></li>
<li class="chapter" data-level="5.5.4" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#secrets"><i class="fa fa-check"></i><b>5.5.4</b> Secrets</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="observability-maintenance.html"><a href="observability-maintenance.html"><i class="fa fa-check"></i><b>5.6</b> Observability &amp; Maintenance</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="observability-maintenance.html"><a href="observability-maintenance.html#health-checks"><i class="fa fa-check"></i><b>5.6.1</b> Health Checks</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="helm.html"><a href="helm.html"><i class="fa fa-check"></i><b>5.7</b> Helm</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="helm.html"><a href="helm.html#helm-chart-structure"><i class="fa fa-check"></i><b>5.7.1</b> Helm Chart Structure</a></li>
<li class="chapter" data-level="5.7.2" data-path="helm.html"><a href="helm.html#working-with-helm"><i class="fa fa-check"></i><b>5.7.2</b> Working with Helm</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="terraform.html"><a href="terraform.html"><i class="fa fa-check"></i><b>6</b> Terraform</a>
<ul>
<li class="chapter" data-level="6.1" data-path="basic-usage.html"><a href="basic-usage.html"><i class="fa fa-check"></i><b>6.1</b> Basic usage</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="basic-usage.html"><a href="basic-usage.html#terraform-init"><i class="fa fa-check"></i><b>6.1.1</b> terraform init</a></li>
<li class="chapter" data-level="6.1.2" data-path="basic-usage.html"><a href="basic-usage.html#terraform-validate"><i class="fa fa-check"></i><b>6.1.2</b> terraform validate</a></li>
<li class="chapter" data-level="6.1.3" data-path="basic-usage.html"><a href="basic-usage.html#terraform-plan"><i class="fa fa-check"></i><b>6.1.3</b> terraform plan</a></li>
<li class="chapter" data-level="6.1.4" data-path="basic-usage.html"><a href="basic-usage.html#terraform-apply"><i class="fa fa-check"></i><b>6.1.4</b> terraform apply</a></li>
<li class="chapter" data-level="6.1.5" data-path="basic-usage.html"><a href="basic-usage.html#terraform-destroy"><i class="fa fa-check"></i><b>6.1.5</b> terraform destroy</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="core-components-3.html"><a href="core-components-3.html"><i class="fa fa-check"></i><b>6.2</b> Core Components</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="core-components-3.html"><a href="core-components-3.html#providers"><i class="fa fa-check"></i><b>6.2.1</b> Providers</a></li>
<li class="chapter" data-level="6.2.2" data-path="core-components-3.html"><a href="core-components-3.html#resources"><i class="fa fa-check"></i><b>6.2.2</b> Resources</a></li>
<li class="chapter" data-level="6.2.3" data-path="core-components-3.html"><a href="core-components-3.html#data-sources"><i class="fa fa-check"></i><b>6.2.3</b> Data Sources</a></li>
<li class="chapter" data-level="6.2.4" data-path="core-components-3.html"><a href="core-components-3.html#state"><i class="fa fa-check"></i><b>6.2.4</b> State</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="modules.html"><a href="modules.html"><i class="fa fa-check"></i><b>6.3</b> Modules</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="modules.html"><a href="modules.html#input-variables"><i class="fa fa-check"></i><b>6.3.1</b> Input Variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="modules.html"><a href="modules.html#output-variables"><i class="fa fa-check"></i><b>6.3.2</b> Output Variables</a></li>
<li class="chapter" data-level="6.3.3" data-path="modules.html"><a href="modules.html#local-variables"><i class="fa fa-check"></i><b>6.3.3</b> Local Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html"><i class="fa fa-check"></i><b>6.4</b> Additional tips &amp; tricks</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#count"><i class="fa fa-check"></i><b>6.4.1</b> count</a></li>
<li class="chapter" data-level="6.4.2" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#for-each"><i class="fa fa-check"></i><b>6.4.2</b> for-each</a></li>
<li class="chapter" data-level="6.4.3" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#for"><i class="fa fa-check"></i><b>6.4.3</b> for</a></li>
<li class="chapter" data-level="6.4.4" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#workspaces"><i class="fa fa-check"></i><b>6.4.4</b> Workspaces</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html"><i class="fa fa-check"></i><b>6.5</b> Exemplary Deployment</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#root"><i class="fa fa-check"></i><b>6.5.1</b> root</a></li>
<li class="chapter" data-level="6.5.2" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#vpc"><i class="fa fa-check"></i><b>6.5.2</b> vpc</a></li>
<li class="chapter" data-level="6.5.3" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#run-the-code"><i class="fa fa-check"></i><b>6.5.3</b> Run the code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ml-platform-design.html"><a href="ml-platform-design.html"><i class="fa fa-check"></i><b>7</b> ML Platform Design</a>
<ul>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#infrastructure"><i class="fa fa-check"></i>Infrastructure</a></li>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#mlops-tools"><i class="fa fa-check"></i>MLOps Tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="platform-deployment.html"><a href="platform-deployment.html"><i class="fa fa-check"></i><b>8</b> Platform Deployment</a>
<ul>
<li class="chapter" data-level="8.1" data-path="root-module.html"><a href="root-module.html"><i class="fa fa-check"></i><b>8.1</b> Root module</a></li>
<li class="chapter" data-level="8.2" data-path="infrastructure-2.html"><a href="infrastructure-2.html"><i class="fa fa-check"></i><b>8.2</b> Infrastructure</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="infrastructure-2.html"><a href="infrastructure-2.html#virtual-private-cloud"><i class="fa fa-check"></i><b>8.2.1</b> Virtual Private Cloud</a></li>
<li class="chapter" data-level="8.2.2" data-path="infrastructure-2.html"><a href="infrastructure-2.html#elastic-kubernetes-service"><i class="fa fa-check"></i><b>8.2.2</b> Elastic Kubernetes Service</a></li>
<li class="chapter" data-level="8.2.3" data-path="infrastructure-2.html"><a href="infrastructure-2.html#networking"><i class="fa fa-check"></i><b>8.2.3</b> Networking</a></li>
<li class="chapter" data-level="8.2.4" data-path="infrastructure-2.html"><a href="infrastructure-2.html#relational-database-service"><i class="fa fa-check"></i><b>8.2.4</b> Relational Database Service</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>8.3</b> Components</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="components.html"><a href="components.html#user-profiles"><i class="fa fa-check"></i><b>8.3.1</b> User Profiles</a></li>
<li class="chapter" data-level="8.3.2" data-path="components.html"><a href="components.html#airflow-1"><i class="fa fa-check"></i><b>8.3.2</b> Airflow</a></li>
<li class="chapter" data-level="8.3.3" data-path="components.html"><a href="components.html#mlflow-1"><i class="fa fa-check"></i><b>8.3.3</b> Mlflow</a></li>
<li class="chapter" data-level="8.3.4" data-path="components.html"><a href="components.html#jupyterhub"><i class="fa fa-check"></i><b>8.3.4</b> Jupyterhub</a></li>
<li class="chapter" data-level="8.3.5" data-path="components.html"><a href="components.html#monitoring"><i class="fa fa-check"></i><b>8.3.5</b> Monitoring</a></li>
<li class="chapter" data-level="8.3.6" data-path="components.html"><a href="components.html#sagemaker"><i class="fa fa-check"></i><b>8.3.6</b> Sagemaker</a></li>
<li class="chapter" data-level="8.3.7" data-path="components.html"><a href="components.html#dashboard"><i class="fa fa-check"></i><b>8.3.7</b> Dashboard</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="design-decisions.html"><a href="design-decisions.html"><i class="fa fa-check"></i><b>8.4</b> Design Decisions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="use-case-development.html"><a href="use-case-development.html"><i class="fa fa-check"></i><b>9</b> Use Case Development</a>
<ul>
<li class="chapter" data-level="9.1" data-path="integrated-development-environment-1.html"><a href="integrated-development-environment-1.html"><i class="fa fa-check"></i><b>9.1</b> Integrated Development Environment</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="integrated-development-environment-1.html"><a href="integrated-development-environment-1.html#github-repository"><i class="fa fa-check"></i><b>9.1.1</b> Github Repository</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html"><i class="fa fa-check"></i><b>9.2</b> Training &amp; Deployment Pipeline Workflow</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#airflow-workflow"><i class="fa fa-check"></i><b>9.2.1</b> Airflow Workflow</a></li>
<li class="chapter" data-level="9.2.2" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#mlflow-integration"><i class="fa fa-check"></i><b>9.2.2</b> MLflow integration</a></li>
<li class="chapter" data-level="9.2.3" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#pipeline-workflow"><i class="fa fa-check"></i><b>9.2.3</b> Pipeline Workflow</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html"><i class="fa fa-check"></i><b>9.3</b> Training Pipeline Steps</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html#data-preprocessing"><i class="fa fa-check"></i><b>9.3.1</b> Data Preprocessing</a></li>
<li class="chapter" data-level="9.3.2" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html#model-training"><i class="fa fa-check"></i><b>9.3.2</b> Model Training</a></li>
<li class="chapter" data-level="9.3.3" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html#data-preprocessing-1"><i class="fa fa-check"></i><b>9.3.3</b> Data Preprocessing</a></li>
<li class="chapter" data-level="9.3.4" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html#model-training-1"><i class="fa fa-check"></i><b>9.3.4</b> Model Training</a></li>
<li class="chapter" data-level="9.3.5" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html#model-comparison"><i class="fa fa-check"></i><b>9.3.5</b> Model Comparison</a></li>
<li class="chapter" data-level="9.3.6" data-path="training-pipeline-steps.html"><a href="training-pipeline-steps.html#model-deployment-serving"><i class="fa fa-check"></i><b>9.3.6</b> Model Deployment &amp; Serving</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="model-inferencing.html"><a href="model-inferencing.html"><i class="fa fa-check"></i><b>9.4</b> Model Inferencing</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="model-inferencing.html"><a href="model-inferencing.html#pipeline-workflow-1"><i class="fa fa-check"></i><b>9.4.1</b> Pipeline Workflow</a></li>
<li class="chapter" data-level="9.4.2" data-path="model-inferencing.html"><a href="model-inferencing.html#inference-workflow-code"><i class="fa fa-check"></i><b>9.4.2</b> Inference Workflow Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i>Contributing</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MLOps Engineering</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="components" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Components<a href="components.html#components" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this configuration, several custom modules are in place, including Airflow, MLflow, JupyterHub, and monitoring. Each module has a distinct role in deploying specific workflow tools.</p>
<p>Additionally, these module names correspond to their respective namespaces within the cluster.</p>

<div id="user-profiles" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> User Profiles<a href="components.html#user-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The code within the <code>"User-profiles"</code> module serves the purpose of configuring IAM (Identity and Access Management) policies and roles tailored for an ML (Machine Learning) platform. It involves the creation of AWS IAM user profiles, each linked to specific users and their corresponding access keys. These users are granted access privileges determined by specific policies, which can be designated as either user or developer access levels. All pertinent information is securely stored within AWS Secrets Manager. The list of users is dynamically provided to the module through the <code>var.profiles</code> variable from the root modules.</p>
<p>At the outset of the code, data sources are defined to retrieve essential information about the AWS caller’s identity and the current AWS region. These data sources, namely <code>aws_caller_identity</code> and <code>aws_region</code>, serve as repositories for critical details that may be utilized in subsequent configurations.</p>
<p>Furthermore, the code introduces an AWS managed policy named “AmazonSageMakerFullAccess” using the <code>aws_iam_policy</code> data source. This policy is characterized by its unique ARN (Amazon Resource Name) and is configured to grant comprehensive access privileges to Amazon SageMaker services.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb134-1"><a href="components.html#cb134-1" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_caller_identity&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb134-2"><a href="components.html#cb134-2" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_region&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb134-3"><a href="components.html#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="components.html#cb134-4" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_iam_policy&quot;</span> <span class="st">&quot;AmazonSageMakerFullAccess&quot;</span> {</span>
<span id="cb134-5"><a href="components.html#cb134-5" aria-hidden="true" tabindex="-1"></a>  arn <span class="op">=</span> <span class="st">&quot;arn:aws:iam::aws:policy/AmazonSageMakerFullAccess&quot;</span></span>
<span id="cb134-6"><a href="components.html#cb134-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>An IAM policy titled <code>"mlplatform-developer-access-policy"</code> is meticulously crafted to cater to platform developers, extending to them full-fledged access to a wide array of AWS services. This comprehensive access includes EKS, EC2 , S3, RDS, and VPC. The policy’s specifications are delineated within a JSON file situated at the designated file path.</p>
<p>In a parallel fashion, an IAM policy denoted as <code>"mlplatform-user-access-policy"</code> is tailored to accommodate platform users, authorizing them to harness the capabilities of Amazon SageMaker services. This policy is also constructed through the utilization of a JSON file, residing at the specified path, and is thoughtfully designed to provide users with the necessary access privileges.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb135-1"><a href="components.html#cb135-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_policy&quot;</span> <span class="st">&quot;mlplatform_developer_access_policy&quot;</span> {</span>
<span id="cb135-2"><a href="components.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  name        <span class="op">=</span> <span class="st">&quot;mlplatform-developer-access-policy&quot;</span></span>
<span id="cb135-3"><a href="components.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  description <span class="op">=</span> <span class="st">&quot;Access for platform developers granting them full EKS, EC2, S3, RDS, VPC access&quot;</span></span>
<span id="cb135-4"><a href="components.html#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="components.html#cb135-5" aria-hidden="true" tabindex="-1"></a>  policy <span class="op">=</span> <span class="fu">file</span>(<span class="st">&quot;${path.module}/access_policies/AccessPolicyDeveloper.json&quot;</span>)</span>
<span id="cb135-6"><a href="components.html#cb135-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-7"><a href="components.html#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="components.html#cb135-8" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_policy&quot;</span> <span class="st">&quot;mlplatform_user_access_policy&quot;</span> {</span>
<span id="cb135-9"><a href="components.html#cb135-9" aria-hidden="true" tabindex="-1"></a>  name        <span class="op">=</span> <span class="st">&quot;mlplatform-user-access-policy&quot;</span></span>
<span id="cb135-10"><a href="components.html#cb135-10" aria-hidden="true" tabindex="-1"></a>  description <span class="op">=</span> <span class="st">&quot;Access for platform users granting them access to Sagemaker&quot;</span></span>
<span id="cb135-11"><a href="components.html#cb135-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-12"><a href="components.html#cb135-12" aria-hidden="true" tabindex="-1"></a>  policy <span class="op">=</span> <span class="fu">file</span>(<span class="st">&quot;${path.module}/access_policies/AccessPolicyUser.json&quot;</span>)</span>
<span id="cb135-13"><a href="components.html#cb135-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For each profile outlined within the <code>var.profiles</code> variable, the “aws-profiles” module is instantiated. The primary purpose of this module is to facilitate the creation of IAM users, IAM roles, and AWS Secrets Manager secrets. Furthermore, it establishes the necessary associations by linking the previously defined developer and user access policies with their corresponding roles.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb136-1"><a href="components.html#cb136-1" aria-hidden="true" tabindex="-1"></a>module <span class="st">&quot;aws-profiles&quot;</span> {</span>
<span id="cb136-2"><a href="components.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  for_each <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">profiles</span></span>
<span id="cb136-3"><a href="components.html#cb136-3" aria-hidden="true" tabindex="-1"></a>  source   <span class="op">=</span> <span class="st">&quot;./aws-profiles&quot;</span></span>
<span id="cb136-4"><a href="components.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  profile  <span class="op">=</span> each<span class="op">.</span><span class="at">value</span></span>
<span id="cb136-5"><a href="components.html#cb136-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-6"><a href="components.html#cb136-6" aria-hidden="true" tabindex="-1"></a>  access_policy_developer <span class="op">=</span> aws_iam_policy<span class="op">.</span><span class="at">mlplatform_developer_access_policy</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb136-7"><a href="components.html#cb136-7" aria-hidden="true" tabindex="-1"></a>  access_policy_user      <span class="op">=</span> aws_iam_policy<span class="op">.</span><span class="at">mlplatform_user_access_policy</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb136-8"><a href="components.html#cb136-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In the concluding phase of the code, the <code>"AmazonSageMakerFullAccess"</code> policy is affixed to IAM roles that are employed by platform users. This process involves iterating through the <code>local.user_user_access_auth_list</code>, which encompasses a collection of IAM role names designated for users. For each user role, the SageMaker access policy is linked or attached.
</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb137-1"><a href="components.html#cb137-1" aria-hidden="true" tabindex="-1"></a># Add additional policies to ALL users</span>
<span id="cb137-2"><a href="components.html#cb137-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role_policy_attachment&quot;</span> <span class="st">&quot;sagemaker_access_user_role_policy&quot;</span> {</span>
<span id="cb137-3"><a href="components.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  for_each <span class="op">=</span> <span class="fu">toset</span>(local<span class="op">.</span><span class="at">user_user_access_auth_list</span>)</span>
<span id="cb137-4"><a href="components.html#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="components.html#cb137-5" aria-hidden="true" tabindex="-1"></a>  role       <span class="op">=</span> each<span class="op">.</span><span class="at">value</span></span>
<span id="cb137-6"><a href="components.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  policy_arn <span class="op">=</span> data<span class="op">.</span><span class="at">aws_iam_policy</span><span class="op">.</span><span class="at">AmazonSageMakerFullAccess</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb137-7"><a href="components.html#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="components.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  depends_on <span class="op">=</span> [module<span class="op">.</span><span class="at">aws</span><span class="op">-</span>profiles]</span>
<span id="cb137-9"><a href="components.html#cb137-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="aws-profiles" class="section level4 hasAnchor" number="8.3.1.1">
<h4><span class="header-section-number">8.3.1.1</span> AWS Profiles<a href="components.html#aws-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>aws-profiles</code> module, which is invoked within the <code>user-profiles</code> module, streamlines the creation of IAM users, roles, access keys, and Secrets Manager secrets tailored to user profiles within an ML platform. This module takes charge of managing IAM permissions and securely storing secrets, ensuring that platform users and developers can access AWS resources securely.</p>
<p>In this segment, local variables are established based on the details provided in the <code>var.profile</code>. It dissects the username into <code>firstName</code> and <code>lastName</code>, extracts the <code>role</code>, and assembles a <code>username</code> for the IAM user. Just as in the preceding code snippet, this section fetches details regarding the AWS caller’s identity and the current AWS region.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb138-1"><a href="components.html#cb138-1" aria-hidden="true" tabindex="-1"></a>locals {</span>
<span id="cb138-2"><a href="components.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  firstName <span class="op">=</span> <span class="fu">split</span>(<span class="st">&quot;.&quot;</span><span class="op">,</span> <span class="kw">var</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="at">username</span>)[<span class="dv">0</span>]</span>
<span id="cb138-3"><a href="components.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  lastName  <span class="op">=</span> <span class="fu">split</span>(<span class="st">&quot;.&quot;</span><span class="op">,</span> <span class="kw">var</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="at">username</span>)[<span class="dv">1</span>]</span>
<span id="cb138-4"><a href="components.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  role      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="at">role</span></span>
<span id="cb138-5"><a href="components.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  username  <span class="op">=</span> <span class="st">&quot;${local.firstName}-${local.lastName}&quot;</span></span>
<span id="cb138-6"><a href="components.html#cb138-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-7"><a href="components.html#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="components.html#cb138-8" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_caller_identity&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb138-9"><a href="components.html#cb138-9" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_region&quot;</span> <span class="st">&quot;current&quot;</span> {}</span></code></pre></div>
<p>Next, an IAM user is generated using the previously constructed username. The user is established at the root level (“/”) within IAM. Additionally, an IAM access key is generated for this IAM user, providing the capability for programmatic access to AWS resources.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb139-1"><a href="components.html#cb139-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_user&quot;</span> <span class="st">&quot;this&quot;</span> {</span>
<span id="cb139-2"><a href="components.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> local<span class="op">.</span><span class="at">username</span></span>
<span id="cb139-3"><a href="components.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  path <span class="op">=</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb139-4"><a href="components.html#cb139-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-5"><a href="components.html#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="components.html#cb139-6" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_access_key&quot;</span> <span class="st">&quot;this&quot;</span> {</span>
<span id="cb139-7"><a href="components.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  user <span class="op">=</span> aws_iam_user<span class="op">.</span><span class="at">this</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb139-8"><a href="components.html#cb139-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Following this, an IAM role is generated and assigned the name <code>"mlplatform-access-${local.firstName}-${local.lastName}"</code>. This role is configured with a maximum session duration of 28,800 seconds, equivalent to 8 hours. The <code>assume_role_policy</code> is defined to grant the IAM user the ability to assume this role, and it also authorizes Amazon S3 to assume this role. This is commonly employed to facilitate access to S3 buckets.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb140-1"><a href="components.html#cb140-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role&quot;</span> <span class="st">&quot;user_access_role&quot;</span> {</span>
<span id="cb140-2"><a href="components.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  name                 <span class="op">=</span> <span class="st">&quot;mlplatform-access-${local.firstName}-${local.lastName}&quot;</span></span>
<span id="cb140-3"><a href="components.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  max_session_duration <span class="op">=</span> <span class="dv">28800</span></span>
<span id="cb140-4"><a href="components.html#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="components.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  assume_role_policy <span class="op">=</span> <span class="op">&lt;&lt;</span>EOF</span>
<span id="cb140-6"><a href="components.html#cb140-6" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb140-7"><a href="components.html#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Version&quot;</span><span class="op">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="op">,</span></span>
<span id="cb140-8"><a href="components.html#cb140-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Statement&quot;</span><span class="op">:</span> [</span>
<span id="cb140-9"><a href="components.html#cb140-9" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb140-10"><a href="components.html#cb140-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Effect&quot;</span><span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb140-11"><a href="components.html#cb140-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Principal&quot;</span><span class="op">:</span> {</span>
<span id="cb140-12"><a href="components.html#cb140-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;AWS&quot;</span><span class="op">:</span> <span class="st">&quot;arn:aws:iam::${data.aws_caller_identity.current.account_id}:user/${aws_iam_user.this.name}&quot;</span></span>
<span id="cb140-13"><a href="components.html#cb140-13" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb140-14"><a href="components.html#cb140-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Action&quot;</span><span class="op">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></span>
<span id="cb140-15"><a href="components.html#cb140-15" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb140-16"><a href="components.html#cb140-16" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb140-17"><a href="components.html#cb140-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Effect&quot;</span><span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb140-18"><a href="components.html#cb140-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Principal&quot;</span><span class="op">:</span> {</span>
<span id="cb140-19"><a href="components.html#cb140-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Service&quot;</span><span class="op">:</span> <span class="st">&quot;s3.amazonaws.com&quot;</span></span>
<span id="cb140-20"><a href="components.html#cb140-20" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb140-21"><a href="components.html#cb140-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Action&quot;</span><span class="op">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></span>
<span id="cb140-22"><a href="components.html#cb140-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb140-23"><a href="components.html#cb140-23" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb140-24"><a href="components.html#cb140-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-25"><a href="components.html#cb140-25" aria-hidden="true" tabindex="-1"></a>  EOF</span>
<span id="cb140-26"><a href="components.html#cb140-26" aria-hidden="true" tabindex="-1"></a>  #   # tags <span class="op">=</span> {</span>
<span id="cb140-27"><a href="components.html#cb140-27" aria-hidden="true" tabindex="-1"></a>  #   #   tag<span class="op">-</span>key <span class="op">=</span> <span class="st">&quot;tag-value&quot;</span></span>
<span id="cb140-28"><a href="components.html#cb140-28" aria-hidden="true" tabindex="-1"></a>  #   # }</span>
<span id="cb140-29"><a href="components.html#cb140-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Furthermore, the code dynamically attaches two IAM role policy attachments based on the role specified in <code>var.profile</code>. If the role is designated as <em>“Developer”</em>, the <code>"access_policy_developer"</code> is linked to the IAM role. Alternatively, if the role is marked as <em>“User”</em>, the <code>"access_policy_user"</code> is connected to the IAM role. This conditional attachment of policies ensures that each IAM role is granted the appropriate level of access based on the user’s role designation.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb141-1"><a href="components.html#cb141-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role_policy_attachment&quot;</span> <span class="st">&quot;role_attachement_policy_developer&quot;</span> {</span>
<span id="cb141-2"><a href="components.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  count      <span class="op">=</span> local<span class="op">.</span><span class="at">role</span> <span class="op">==</span> <span class="st">&quot;Developer&quot;</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb141-3"><a href="components.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  role       <span class="op">=</span> aws_iam_role<span class="op">.</span><span class="at">user_access_role</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb141-4"><a href="components.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  policy_arn <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">access_policy_developer</span></span>
<span id="cb141-5"><a href="components.html#cb141-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb141-6"><a href="components.html#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="components.html#cb141-7" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role_policy_attachment&quot;</span> <span class="st">&quot;role_attachement_policy_user&quot;</span> {</span>
<span id="cb141-8"><a href="components.html#cb141-8" aria-hidden="true" tabindex="-1"></a>  count      <span class="op">=</span> local<span class="op">.</span><span class="at">role</span> <span class="op">==</span> <span class="st">&quot;User&quot;</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb141-9"><a href="components.html#cb141-9" aria-hidden="true" tabindex="-1"></a>  role       <span class="op">=</span> aws_iam_role<span class="op">.</span><span class="at">user_access_role</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb141-10"><a href="components.html#cb141-10" aria-hidden="true" tabindex="-1"></a>  policy_arn <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">access_policy_user</span></span>
<span id="cb141-11"><a href="components.html#cb141-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Concluding the module code, an AWS Secrets Manager secret is generated with a name derived from the username found in <code>var.profile</code>. A secret version is also established and populated with a range of attributes, encompassing access key information, username, email, role, and IAM role ARN. This comprehensive secret ensures secure storage and retrieval of critical user-specific data for authentication and access control.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb142-1"><a href="components.html#cb142-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_secretsmanager_secret&quot;</span> <span class="st">&quot;this&quot;</span> {</span>
<span id="cb142-2"><a href="components.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  name                    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="at">username</span></span>
<span id="cb142-3"><a href="components.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  recovery_window_in_days <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb142-4"><a href="components.html#cb142-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-5"><a href="components.html#cb142-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-6"><a href="components.html#cb142-6" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_secretsmanager_secret_version&quot;</span> <span class="st">&quot;this&quot;</span> {</span>
<span id="cb142-7"><a href="components.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  secret_id <span class="op">=</span> aws_secretsmanager_secret<span class="op">.</span><span class="at">this</span><span class="op">.</span><span class="at">id</span></span>
<span id="cb142-8"><a href="components.html#cb142-8" aria-hidden="true" tabindex="-1"></a>  secret_string <span class="op">=</span> <span class="fu">jsonencode</span>(</span>
<span id="cb142-9"><a href="components.html#cb142-9" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb142-10"><a href="components.html#cb142-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;ACCESS_KEY_ID&quot;</span> <span class="op">:</span> aws_iam_access_key<span class="op">.</span><span class="at">this</span><span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb142-11"><a href="components.html#cb142-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;SECRET_ACCESS_KEY&quot;</span> <span class="op">:</span> aws_iam_access_key<span class="op">.</span><span class="at">this</span><span class="op">.</span><span class="at">secret</span></span>
<span id="cb142-12"><a href="components.html#cb142-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;username&quot;</span> <span class="op">:</span> <span class="kw">var</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="at">username</span></span>
<span id="cb142-13"><a href="components.html#cb142-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;email&quot;</span> <span class="op">:</span> <span class="kw">var</span><span class="op">.</span><span class="at">profile</span><span class="op">.</span><span class="at">email</span></span>
<span id="cb142-14"><a href="components.html#cb142-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;role&quot;</span> <span class="op">:</span> local<span class="op">.</span><span class="at">role</span></span>
<span id="cb142-15"><a href="components.html#cb142-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;firstName&quot;</span> <span class="op">:</span> local<span class="op">.</span><span class="at">firstName</span></span>
<span id="cb142-16"><a href="components.html#cb142-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;lastName&quot;</span> <span class="op">:</span> local<span class="op">.</span><span class="at">lastName</span></span>
<span id="cb142-17"><a href="components.html#cb142-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;AWS_role&quot;</span> <span class="op">:</span> aws_iam_role<span class="op">.</span><span class="at">user_access_role</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb142-18"><a href="components.html#cb142-18" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb142-19"><a href="components.html#cb142-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
<div id="airflow-1" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Airflow<a href="components.html#airflow-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>Airflow</code> module is responsible for provisioning all components related to the deployment of Airflow. Being a crucial workflow orchestration tool in our ML platform, Airflow is tightly integrated with various other components in the Terraform codebase, which requires it to receive multiple input variables and configurations. This Terraform code serves as the foundation for erecting an ML platform dashboard based on Apache Airflow, encompassing the configuration of a diverse array of components, including IAM roles, data storage, RDS, and Helm releases.</p>
<p>The deployment of Airflow itself via this Terraform code hinges on the utilization of a Helm chart. This codebase also seamlessly integrates the Airflow deployment with AWS S3 for efficient data storage and logging, while relying on an AWS RDS instance from the <a href="infrastructure-2.html#relational-database-service">infrastructure section</a> to serve as the bedrock for metadata storage. Furthermore, pertinent Kubernetes secrets are meticulously integrated into the setup to ensure a secure and well-protected deployment.</p>
<p>The code initiation begins with the declaration of several local variables, encompassing prefixes, secret names, and variable lists. These variables serve as cornerstones throughout the code, fostering consistency in naming conventions and configurations. Additionally, essential data sources, such as <code>"aws_caller_identity"</code> and <code>"aws_region"</code>, are defined. A dedicated Kubernetes namespace for Airflow is also established, providing a controlled and isolated environment for Airflow resources within the Kubernetes cluster.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb143-1"><a href="components.html#cb143-1" aria-hidden="true" tabindex="-1"></a>locals {</span>
<span id="cb143-2"><a href="components.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  prefix                       <span class="op">=</span> <span class="st">&quot;${var.name_prefix}-${var.namespace}&quot;</span></span>
<span id="cb143-3"><a href="components.html#cb143-3" aria-hidden="true" tabindex="-1"></a>  k8s_airflow_db_secret_name   <span class="op">=</span> <span class="st">&quot;${local.prefix}-db-auth&quot;</span></span>
<span id="cb143-4"><a href="components.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  git_airflow_repo_secret_name <span class="op">=</span> <span class="st">&quot;${local.prefix}-https-git-secret&quot;</span></span>
<span id="cb143-5"><a href="components.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  git_organization_secret_name <span class="op">=</span> <span class="st">&quot;${local.prefix}-organization-git-secret&quot;</span></span>
<span id="cb143-6"><a href="components.html#cb143-6" aria-hidden="true" tabindex="-1"></a>  s3_data_bucket_secret_name   <span class="op">=</span> <span class="st">&quot;${var.namespace}-${var.s3_data_bucket_secret_name}&quot;</span></span>
<span id="cb143-7"><a href="components.html#cb143-7" aria-hidden="true" tabindex="-1"></a>  s3_data_bucket_name          <span class="op">=</span> <span class="st">&quot;${local.prefix}-${var.s3_data_bucket_name}&quot;</span></span>
<span id="cb143-8"><a href="components.html#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="components.html#cb143-9" aria-hidden="true" tabindex="-1"></a>  airflow_variable_list_addition <span class="op">=</span> [</span>
<span id="cb143-10"><a href="components.html#cb143-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb143-11"><a href="components.html#cb143-11" aria-hidden="true" tabindex="-1"></a>      key   <span class="op">=</span> <span class="st">&quot;s3_access_name&quot;</span></span>
<span id="cb143-12"><a href="components.html#cb143-12" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> <span class="st">&quot;${local.s3_data_bucket_secret_name}&quot;</span></span>
<span id="cb143-13"><a href="components.html#cb143-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-14"><a href="components.html#cb143-14" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb143-15"><a href="components.html#cb143-15" aria-hidden="true" tabindex="-1"></a>  airflow_variable_list_full <span class="op">=</span> <span class="fu">concat</span>(<span class="kw">var</span><span class="op">.</span><span class="at">airflow_variable_list</span><span class="op">,</span> local<span class="op">.</span><span class="at">airflow_variable_list_addition</span>)</span>
<span id="cb143-16"><a href="components.html#cb143-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-17"><a href="components.html#cb143-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-18"><a href="components.html#cb143-18" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_caller_identity&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb143-19"><a href="components.html#cb143-19" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_region&quot;</span> <span class="st">&quot;current&quot;</span> {} #</span>
<span id="cb143-20"><a href="components.html#cb143-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-21"><a href="components.html#cb143-21" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;kubernetes_namespace&quot;</span> <span class="st">&quot;airflow&quot;</span> {</span>
<span id="cb143-22"><a href="components.html#cb143-22" aria-hidden="true" tabindex="-1"></a>  metadata {</span>
<span id="cb143-23"><a href="components.html#cb143-23" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb143-24"><a href="components.html#cb143-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb143-25"><a href="components.html#cb143-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Subsequently, a customized Terraform module, denoted as <code>"iam-service-account,"</code> is enlisted to configure IAM roles and policies tailored to service accounts associated with Airflow. These configurations include enabling role access through an OIDC provider and attaching an IAM policy that grants access to S3 buckets related to MLflow. These roles and policies serve as the bedrock for permissions and access control over a multitude of resources.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb144-1"><a href="components.html#cb144-1" aria-hidden="true" tabindex="-1"></a>module <span class="st">&quot;iam-service-account&quot;</span> {</span>
<span id="cb144-2"><a href="components.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  source                      <span class="op">=</span> <span class="st">&quot;./iam-service-account&quot;</span></span>
<span id="cb144-3"><a href="components.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  namespace                   <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb144-4"><a href="components.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  oidc_provider_arn           <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">oidc_provider_arn</span></span>
<span id="cb144-5"><a href="components.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  s3_mlflow_bucket_policy_arn <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">s3_mlflow_bucket_policy_arn</span></span>
<span id="cb144-6"><a href="components.html#cb144-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Moreover, an additional customized Terraform module, titled <code>"s3-data-storage,"</code> is harnessed to configure data storage. This entails the definition of an S3 bucket designed for data storage, complete with associated configurations such as the bucket name, secret names, and policies. This data storage facility empowers Airflow users to securely store a diverse range of data, including training images and more.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb145-1"><a href="components.html#cb145-1" aria-hidden="true" tabindex="-1"></a>module <span class="st">&quot;s3-data-storage&quot;</span> {</span>
<span id="cb145-2"><a href="components.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  source                      <span class="op">=</span> <span class="st">&quot;./data-storage&quot;</span></span>
<span id="cb145-3"><a href="components.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  namespace                   <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb145-4"><a href="components.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  s3_data_bucket_name         <span class="op">=</span> local<span class="op">.</span><span class="at">s3_data_bucket_name</span></span>
<span id="cb145-5"><a href="components.html#cb145-5" aria-hidden="true" tabindex="-1"></a>  s3_data_bucket_secret_name  <span class="op">=</span> local<span class="op">.</span><span class="at">s3_data_bucket_secret_name</span></span>
<span id="cb145-6"><a href="components.html#cb145-6" aria-hidden="true" tabindex="-1"></a>  s3_mlflow_bucket_policy_arn <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">s3_mlflow_bucket_policy_arn</span></span>
<span id="cb145-7"><a href="components.html#cb145-7" aria-hidden="true" tabindex="-1"></a>  s3_force_destroy            <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb145-8"><a href="components.html#cb145-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Before the Airflow deployment can take shape, the code diligently crafts Kubernetes secrets serving various purposes. These secrets play a pivotal role in safeguarding sensitive information and providing secure access and configurations for Airflow. They encompass a spectrum of crucial details, including database credentials, Git authentication credentials, AWS account information, and SageMaker access data.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb146-1"><a href="components.html#cb146-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;kubernetes_secret&quot;</span> <span class="st">&quot;airflow_db_credentials&quot;</span> {</span>
<span id="cb146-2"><a href="components.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  metadata {</span>
<span id="cb146-3"><a href="components.html#cb146-3" aria-hidden="true" tabindex="-1"></a>    name      <span class="op">=</span> local<span class="op">.</span><span class="at">k8s_airflow_db_secret_name</span></span>
<span id="cb146-4"><a href="components.html#cb146-4" aria-hidden="true" tabindex="-1"></a>    namespace <span class="op">=</span> helm_release<span class="op">.</span><span class="at">airflow</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb146-5"><a href="components.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-6"><a href="components.html#cb146-6" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> {</span>
<span id="cb146-7"><a href="components.html#cb146-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;postgresql-password&quot;</span> <span class="op">=</span> module<span class="op">.</span><span class="at">rds</span><span class="op">-</span>airflow<span class="op">.</span><span class="at">rds_password</span></span>
<span id="cb146-8"><a href="components.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-9"><a href="components.html#cb146-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-10"><a href="components.html#cb146-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-11"><a href="components.html#cb146-11" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;kubernetes_secret&quot;</span> <span class="st">&quot;airflow_https_git_secret&quot;</span> {</span>
<span id="cb146-12"><a href="components.html#cb146-12" aria-hidden="true" tabindex="-1"></a>  metadata {</span>
<span id="cb146-13"><a href="components.html#cb146-13" aria-hidden="true" tabindex="-1"></a>    name      <span class="op">=</span> local<span class="op">.</span><span class="at">git_airflow_repo_secret_name</span></span>
<span id="cb146-14"><a href="components.html#cb146-14" aria-hidden="true" tabindex="-1"></a>    namespace <span class="op">=</span> helm_release<span class="op">.</span><span class="at">airflow</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb146-15"><a href="components.html#cb146-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-16"><a href="components.html#cb146-16" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> {</span>
<span id="cb146-17"><a href="components.html#cb146-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;username&quot;</span> <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_username</span></span>
<span id="cb146-18"><a href="components.html#cb146-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;password&quot;</span> <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_token</span></span>
<span id="cb146-19"><a href="components.html#cb146-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-20"><a href="components.html#cb146-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-21"><a href="components.html#cb146-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-22"><a href="components.html#cb146-22" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;kubernetes_secret&quot;</span> <span class="st">&quot;airflow_organization_git_secret&quot;</span> {</span>
<span id="cb146-23"><a href="components.html#cb146-23" aria-hidden="true" tabindex="-1"></a>  metadata {</span>
<span id="cb146-24"><a href="components.html#cb146-24" aria-hidden="true" tabindex="-1"></a>    name      <span class="op">=</span> local<span class="op">.</span><span class="at">git_organization_secret_name</span></span>
<span id="cb146-25"><a href="components.html#cb146-25" aria-hidden="true" tabindex="-1"></a>    namespace <span class="op">=</span> helm_release<span class="op">.</span><span class="at">airflow</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb146-26"><a href="components.html#cb146-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-27"><a href="components.html#cb146-27" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> {</span>
<span id="cb146-28"><a href="components.html#cb146-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;GITHUB_CLIENT_ID&quot;</span>     <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_client_id</span></span>
<span id="cb146-29"><a href="components.html#cb146-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;GITHUB_CLIENT_SECRET&quot;</span> <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_client_secret</span></span>
<span id="cb146-30"><a href="components.html#cb146-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-31"><a href="components.html#cb146-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-32"><a href="components.html#cb146-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-33"><a href="components.html#cb146-33" aria-hidden="true" tabindex="-1"></a># secret <span class="cf">with</span> account information</span>
<span id="cb146-34"><a href="components.html#cb146-34" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;kubernetes_secret&quot;</span> <span class="st">&quot;aws-account-information&quot;</span> {</span>
<span id="cb146-35"><a href="components.html#cb146-35" aria-hidden="true" tabindex="-1"></a>  metadata {</span>
<span id="cb146-36"><a href="components.html#cb146-36" aria-hidden="true" tabindex="-1"></a>    name      <span class="op">=</span> <span class="st">&quot;${var.namespace}-aws-account-information&quot;</span></span>
<span id="cb146-37"><a href="components.html#cb146-37" aria-hidden="true" tabindex="-1"></a>    namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb146-38"><a href="components.html#cb146-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-39"><a href="components.html#cb146-39" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> {</span>
<span id="cb146-40"><a href="components.html#cb146-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AWS_REGION&quot;</span> <span class="op">=</span> <span class="st">&quot;${data.aws_region.current.name}&quot;</span></span>
<span id="cb146-41"><a href="components.html#cb146-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AWS_ID&quot;</span>     <span class="op">=</span> <span class="st">&quot;${data.aws_caller_identity.current.account_id}&quot;</span></span>
<span id="cb146-42"><a href="components.html#cb146-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-43"><a href="components.html#cb146-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-44"><a href="components.html#cb146-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-45"><a href="components.html#cb146-45" aria-hidden="true" tabindex="-1"></a># secret <span class="cf">for</span> sagemaker</span>
<span id="cb146-46"><a href="components.html#cb146-46" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;kubernetes_secret&quot;</span> <span class="st">&quot;sagemaker-access&quot;</span> {</span>
<span id="cb146-47"><a href="components.html#cb146-47" aria-hidden="true" tabindex="-1"></a>  metadata {</span>
<span id="cb146-48"><a href="components.html#cb146-48" aria-hidden="true" tabindex="-1"></a>    name      <span class="op">=</span> <span class="st">&quot;${var.namespace}-sagemaker-access&quot;</span></span>
<span id="cb146-49"><a href="components.html#cb146-49" aria-hidden="true" tabindex="-1"></a>    namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb146-50"><a href="components.html#cb146-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-51"><a href="components.html#cb146-51" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> {</span>
<span id="cb146-52"><a href="components.html#cb146-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AWS_ROLE_NAME_SAGEMAKER&quot;</span> <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">sagemaker_access_role_name</span></span>
<span id="cb146-53"><a href="components.html#cb146-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-54"><a href="components.html#cb146-54" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Additionally, the code orchestrates the deployment of an RDS database through the utilization of a dedicated module. This RDS database is earmarked to serve as the metadata repository for the Airflow deployment, with a randomly generated password enhancing security.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb147-1"><a href="components.html#cb147-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;random_password&quot;</span> <span class="st">&quot;rds_password&quot;</span> {</span>
<span id="cb147-2"><a href="components.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  length  <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb147-3"><a href="components.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  special <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb147-4"><a href="components.html#cb147-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-5"><a href="components.html#cb147-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-6"><a href="components.html#cb147-6" aria-hidden="true" tabindex="-1"></a>module <span class="st">&quot;rds-airflow&quot;</span> {</span>
<span id="cb147-7"><a href="components.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  source                      <span class="op">=</span> <span class="st">&quot;../../infrastructure/rds&quot;</span></span>
<span id="cb147-8"><a href="components.html#cb147-8" aria-hidden="true" tabindex="-1"></a>  vpc_id                      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">vpc_id</span></span>
<span id="cb147-9"><a href="components.html#cb147-9" aria-hidden="true" tabindex="-1"></a>  private_subnets             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">private_subnets</span></span>
<span id="cb147-10"><a href="components.html#cb147-10" aria-hidden="true" tabindex="-1"></a>  private_subnets_cidr_blocks <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">private_subnets_cidr_blocks</span></span>
<span id="cb147-11"><a href="components.html#cb147-11" aria-hidden="true" tabindex="-1"></a>  rds_port                    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_port</span></span>
<span id="cb147-12"><a href="components.html#cb147-12" aria-hidden="true" tabindex="-1"></a>  rds_name                    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_name</span></span>
<span id="cb147-13"><a href="components.html#cb147-13" aria-hidden="true" tabindex="-1"></a>  rds_password                <span class="op">=</span> <span class="fu">coalesce</span>(<span class="kw">var</span><span class="op">.</span><span class="at">rds_password</span><span class="op">,</span> random_password<span class="op">.</span><span class="at">rds_password</span><span class="op">.</span><span class="at">result</span>)</span>
<span id="cb147-14"><a href="components.html#cb147-14" aria-hidden="true" tabindex="-1"></a>  rds_engine                  <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_engine</span></span>
<span id="cb147-15"><a href="components.html#cb147-15" aria-hidden="true" tabindex="-1"></a>  rds_engine_version          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_engine_version</span></span>
<span id="cb147-16"><a href="components.html#cb147-16" aria-hidden="true" tabindex="-1"></a>  rds_instance_class          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_instance_class</span></span>
<span id="cb147-17"><a href="components.html#cb147-17" aria-hidden="true" tabindex="-1"></a>  storage_type                <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_storage_type</span></span>
<span id="cb147-18"><a href="components.html#cb147-18" aria-hidden="true" tabindex="-1"></a>  max_allocated_storage       <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_max_allocated_storage</span></span>
<span id="cb147-19"><a href="components.html#cb147-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In this final phase, Apache Airflow is deployed using Helm, and meticulous configurations are set to ensure its smooth operation. These configurations encompass various aspects of Airflow, encompassing Git authentication, database connections, and Ingress settings for external accessibility. The Helm release configurations can be dissected into several key parts, each serving a specific purpose within the larger infrastructure of the dashboard.</p>
<ul>
<li><strong>Helm Release Configuration</strong>: This segment delineates the Helm release resource named “airflow,” responsible for the deployment of Apache Airflow. It encompasses crucial details such as the Helm chart repository, chart name, chart version, and assorted configuration options.</li>
<li><strong>Airflow Configuration</strong>: In this section, comprehensive configurations for Apache Airflow are provided. This includes environment variables, Airflow-specific settings, and additional parameters required for tailoring the Airflow deployment. Of notable significance is the establishment of GitHub authentication and the definition of the Airflow webserver’s base URL.</li>
<li><strong>Service Account Configuration</strong>: This segment is dedicated to specifying the configuration for the service account utilized by Airflow. It initiates the creation of a service account named “airflow-sa” and establishes its association with an IAM role, as denoted by the “eks.amazonaws.com/role-arn” annotation.</li>
<li><strong>Ingress Configuration</strong>: Here, meticulous configuration of the Ingress for Apache Airflow takes place, facilitating external accessibility. This involves specifying annotations and settings for the Ingress controller, including hostname and health check path.</li>
<li><strong>Web Configuration</strong>: This component defines settings pertinent to the Airflow web component. It encompasses aspects such as readiness and liveness probes, which are instrumental in verifying the responsiveness of the web server. Additionally, provisions are made for configuration overrides through the utilization of a custom Python file, affording flexibility in tailoring the web server’s behavior.</li>
</ul>
<div class="sourceCode" id="cb148"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb148-1"><a href="components.html#cb148-1" aria-hidden="true" tabindex="-1"></a># HELM</span>
<span id="cb148-2"><a href="components.html#cb148-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;airflow&quot;</span> {</span>
<span id="cb148-3"><a href="components.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb148-4"><a href="components.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb148-5"><a href="components.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb148-6"><a href="components.html#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="components.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  repository <span class="op">=</span> <span class="st">&quot;https://airflow-helm.github.io/charts&quot;</span></span>
<span id="cb148-8"><a href="components.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  chart      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">helm_chart_name</span></span>
<span id="cb148-9"><a href="components.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  version    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">helm_chart_version</span></span>
<span id="cb148-10"><a href="components.html#cb148-10" aria-hidden="true" tabindex="-1"></a>  wait       <span class="op">=</span> <span class="kw">false</span> # deactivate post install hooks otherwise will fail</span>
<span id="cb148-11"><a href="components.html#cb148-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-12"><a href="components.html#cb148-12" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [<span class="fu">yamlencode</span>({</span>
<span id="cb148-13"><a href="components.html#cb148-13" aria-hidden="true" tabindex="-1"></a>    airflow <span class="op">=</span> {</span>
<span id="cb148-14"><a href="components.html#cb148-14" aria-hidden="true" tabindex="-1"></a>      extraEnv <span class="op">=</span> [</span>
<span id="cb148-15"><a href="components.html#cb148-15" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb148-16"><a href="components.html#cb148-16" aria-hidden="true" tabindex="-1"></a>          name <span class="op">=</span> <span class="st">&quot;GITHUB_CLIENT_ID&quot;</span></span>
<span id="cb148-17"><a href="components.html#cb148-17" aria-hidden="true" tabindex="-1"></a>          valueFrom <span class="op">=</span> {</span>
<span id="cb148-18"><a href="components.html#cb148-18" aria-hidden="true" tabindex="-1"></a>            secretKeyRef <span class="op">=</span> {</span>
<span id="cb148-19"><a href="components.html#cb148-19" aria-hidden="true" tabindex="-1"></a>              name <span class="op">=</span> local<span class="op">.</span><span class="at">git_organization_secret_name</span></span>
<span id="cb148-20"><a href="components.html#cb148-20" aria-hidden="true" tabindex="-1"></a>              key  <span class="op">=</span> <span class="st">&quot;GITHUB_CLIENT_ID&quot;</span></span>
<span id="cb148-21"><a href="components.html#cb148-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb148-22"><a href="components.html#cb148-22" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb148-23"><a href="components.html#cb148-23" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb148-24"><a href="components.html#cb148-24" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb148-25"><a href="components.html#cb148-25" aria-hidden="true" tabindex="-1"></a>          name <span class="op">=</span> <span class="st">&quot;GITHUB_CLIENT_SECRET&quot;</span></span>
<span id="cb148-26"><a href="components.html#cb148-26" aria-hidden="true" tabindex="-1"></a>          valueFrom <span class="op">=</span> {</span>
<span id="cb148-27"><a href="components.html#cb148-27" aria-hidden="true" tabindex="-1"></a>            secretKeyRef <span class="op">=</span> {</span>
<span id="cb148-28"><a href="components.html#cb148-28" aria-hidden="true" tabindex="-1"></a>              name <span class="op">=</span> local<span class="op">.</span><span class="at">git_organization_secret_name</span></span>
<span id="cb148-29"><a href="components.html#cb148-29" aria-hidden="true" tabindex="-1"></a>              key  <span class="op">=</span> <span class="st">&quot;GITHUB_CLIENT_SECRET&quot;</span></span>
<span id="cb148-30"><a href="components.html#cb148-30" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb148-31"><a href="components.html#cb148-31" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb148-32"><a href="components.html#cb148-32" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb148-33"><a href="components.html#cb148-33" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb148-34"><a href="components.html#cb148-34" aria-hidden="true" tabindex="-1"></a>      config <span class="op">=</span> {</span>
<span id="cb148-35"><a href="components.html#cb148-35" aria-hidden="true" tabindex="-1"></a>        AIRFLOW__WEBSERVER__EXPOSE_CONFIG <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-36"><a href="components.html#cb148-36" aria-hidden="true" tabindex="-1"></a>        AIRFLOW__WEBSERVER__BASE_URL      <span class="op">=</span> <span class="st">&quot;http://${var.domain_name}/${var.domain_suffix}&quot;</span></span>
<span id="cb148-37"><a href="components.html#cb148-37" aria-hidden="true" tabindex="-1"></a>        AIRFLOW__CORE__LOAD_EXAMPLES <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-38"><a href="components.html#cb148-38" aria-hidden="true" tabindex="-1"></a>        AIRFLOW__CORE__DEFAULT_TIMEZONE <span class="op">=</span> <span class="st">&quot;Europe/Amsterdam&quot;</span></span>
<span id="cb148-39"><a href="components.html#cb148-39" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb148-40"><a href="components.html#cb148-40" aria-hidden="true" tabindex="-1"></a>      users <span class="op">=</span> []</span>
<span id="cb148-41"><a href="components.html#cb148-41" aria-hidden="true" tabindex="-1"></a>      image <span class="op">=</span> {</span>
<span id="cb148-42"><a href="components.html#cb148-42" aria-hidden="true" tabindex="-1"></a>        repository <span class="op">=</span> <span class="st">&quot;seblum/airflow&quot;</span></span>
<span id="cb148-43"><a href="components.html#cb148-43" aria-hidden="true" tabindex="-1"></a>        tag        <span class="op">=</span> <span class="st">&quot;2.6.3-python3.11-custom-light&quot;</span></span>
<span id="cb148-44"><a href="components.html#cb148-44" aria-hidden="true" tabindex="-1"></a>        pullPolicy <span class="op">=</span> <span class="st">&quot;IfNotPresent&quot;</span></span>
<span id="cb148-45"><a href="components.html#cb148-45" aria-hidden="true" tabindex="-1"></a>        pullSecret <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb148-46"><a href="components.html#cb148-46" aria-hidden="true" tabindex="-1"></a>        uid        <span class="op">=</span> <span class="dv">50000</span></span>
<span id="cb148-47"><a href="components.html#cb148-47" aria-hidden="true" tabindex="-1"></a>        gid        <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb148-48"><a href="components.html#cb148-48" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb148-49"><a href="components.html#cb148-49" aria-hidden="true" tabindex="-1"></a>      executor           <span class="op">=</span> <span class="st">&quot;KubernetesExecutor&quot;</span></span>
<span id="cb148-50"><a href="components.html#cb148-50" aria-hidden="true" tabindex="-1"></a>      fernetKey          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">fernet_key</span></span>
<span id="cb148-51"><a href="components.html#cb148-51" aria-hidden="true" tabindex="-1"></a>      webserverSecretKey <span class="op">=</span> <span class="st">&quot;THIS IS UNSAFE!&quot;</span></span>
<span id="cb148-52"><a href="components.html#cb148-52" aria-hidden="true" tabindex="-1"></a>      variables <span class="op">=</span> local<span class="op">.</span><span class="at">airflow_variable_list_full</span></span>
<span id="cb148-53"><a href="components.html#cb148-53" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-54"><a href="components.html#cb148-54" aria-hidden="true" tabindex="-1"></a>    serviceAccount <span class="op">=</span> {</span>
<span id="cb148-55"><a href="components.html#cb148-55" aria-hidden="true" tabindex="-1"></a>      create <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-56"><a href="components.html#cb148-56" aria-hidden="true" tabindex="-1"></a>      name   <span class="op">=</span> <span class="st">&quot;airflow-sa&quot;</span></span>
<span id="cb148-57"><a href="components.html#cb148-57" aria-hidden="true" tabindex="-1"></a>      annotations <span class="op">=</span> {</span>
<span id="cb148-58"><a href="components.html#cb148-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;eks.amazonaws.com/role-arn&quot;</span> <span class="op">=</span> <span class="st">&quot;${module.iam-service-account.airflow_service_account_role_arn}&quot;</span></span>
<span id="cb148-59"><a href="components.html#cb148-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-60"><a href="components.html#cb148-60" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-61"><a href="components.html#cb148-61" aria-hidden="true" tabindex="-1"></a>    scheduler <span class="op">=</span> {</span>
<span id="cb148-62"><a href="components.html#cb148-62" aria-hidden="true" tabindex="-1"></a>      logCleanup <span class="op">=</span> {</span>
<span id="cb148-63"><a href="components.html#cb148-63" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-64"><a href="components.html#cb148-64" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-65"><a href="components.html#cb148-65" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-66"><a href="components.html#cb148-66" aria-hidden="true" tabindex="-1"></a>    workers <span class="op">=</span> {</span>
<span id="cb148-67"><a href="components.html#cb148-67" aria-hidden="true" tabindex="-1"></a>      enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-68"><a href="components.html#cb148-68" aria-hidden="true" tabindex="-1"></a>      logCleanup <span class="op">=</span> {</span>
<span id="cb148-69"><a href="components.html#cb148-69" aria-hidden="true" tabindex="-1"></a>        enables <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-70"><a href="components.html#cb148-70" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-71"><a href="components.html#cb148-71" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-72"><a href="components.html#cb148-72" aria-hidden="true" tabindex="-1"></a>    flower <span class="op">=</span> {</span>
<span id="cb148-73"><a href="components.html#cb148-73" aria-hidden="true" tabindex="-1"></a>      enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-74"><a href="components.html#cb148-74" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-75"><a href="components.html#cb148-75" aria-hidden="true" tabindex="-1"></a>    postgresql <span class="op">=</span> {</span>
<span id="cb148-76"><a href="components.html#cb148-76" aria-hidden="true" tabindex="-1"></a>      enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-77"><a href="components.html#cb148-77" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-78"><a href="components.html#cb148-78" aria-hidden="true" tabindex="-1"></a>    redis <span class="op">=</span> {</span>
<span id="cb148-79"><a href="components.html#cb148-79" aria-hidden="true" tabindex="-1"></a>      enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb148-80"><a href="components.html#cb148-80" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-81"><a href="components.html#cb148-81" aria-hidden="true" tabindex="-1"></a>    externalDatabase <span class="op">=</span> {</span>
<span id="cb148-82"><a href="components.html#cb148-82" aria-hidden="true" tabindex="-1"></a>      type              <span class="op">=</span> <span class="st">&quot;postgres&quot;</span></span>
<span id="cb148-83"><a href="components.html#cb148-83" aria-hidden="true" tabindex="-1"></a>      host              <span class="op">=</span> module<span class="op">.</span><span class="at">rds</span><span class="op">-</span>airflow<span class="op">.</span><span class="at">rds_host</span></span>
<span id="cb148-84"><a href="components.html#cb148-84" aria-hidden="true" tabindex="-1"></a>      port              <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_port</span></span>
<span id="cb148-85"><a href="components.html#cb148-85" aria-hidden="true" tabindex="-1"></a>      database          <span class="op">=</span> <span class="st">&quot;airflow_db&quot;</span></span>
<span id="cb148-86"><a href="components.html#cb148-86" aria-hidden="true" tabindex="-1"></a>      user              <span class="op">=</span> <span class="st">&quot;airflow_admin&quot;</span></span>
<span id="cb148-87"><a href="components.html#cb148-87" aria-hidden="true" tabindex="-1"></a>      passwordSecret    <span class="op">=</span> local<span class="op">.</span><span class="at">k8s_airflow_db_secret_name</span></span>
<span id="cb148-88"><a href="components.html#cb148-88" aria-hidden="true" tabindex="-1"></a>      passwordSecretKey <span class="op">=</span> <span class="st">&quot;postgresql-password&quot;</span></span>
<span id="cb148-89"><a href="components.html#cb148-89" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-90"><a href="components.html#cb148-90" aria-hidden="true" tabindex="-1"></a>    dags <span class="op">=</span> {</span>
<span id="cb148-91"><a href="components.html#cb148-91" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> <span class="st">&quot;/opt/airflow/dags&quot;</span></span>
<span id="cb148-92"><a href="components.html#cb148-92" aria-hidden="true" tabindex="-1"></a>      gitSync <span class="op">=</span> {</span>
<span id="cb148-93"><a href="components.html#cb148-93" aria-hidden="true" tabindex="-1"></a>        enabled  <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-94"><a href="components.html#cb148-94" aria-hidden="true" tabindex="-1"></a>        repo     <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_repository_url</span></span>
<span id="cb148-95"><a href="components.html#cb148-95" aria-hidden="true" tabindex="-1"></a>        branch   <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_branch</span></span>
<span id="cb148-96"><a href="components.html#cb148-96" aria-hidden="true" tabindex="-1"></a>        revision <span class="op">=</span> <span class="st">&quot;HEAD&quot;</span></span>
<span id="cb148-97"><a href="components.html#cb148-97" aria-hidden="true" tabindex="-1"></a>        # repoSubPath           <span class="op">=</span> <span class="st">&quot;workflows&quot;</span></span>
<span id="cb148-98"><a href="components.html#cb148-98" aria-hidden="true" tabindex="-1"></a>        httpSecret            <span class="op">=</span> local<span class="op">.</span><span class="at">git_airflow_repo_secret_name</span></span>
<span id="cb148-99"><a href="components.html#cb148-99" aria-hidden="true" tabindex="-1"></a>        httpSecretUsernameKey <span class="op">=</span> <span class="st">&quot;username&quot;</span></span>
<span id="cb148-100"><a href="components.html#cb148-100" aria-hidden="true" tabindex="-1"></a>        httpSecretPasswordKey <span class="op">=</span> <span class="st">&quot;password&quot;</span></span>
<span id="cb148-101"><a href="components.html#cb148-101" aria-hidden="true" tabindex="-1"></a>        syncWait              <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb148-102"><a href="components.html#cb148-102" aria-hidden="true" tabindex="-1"></a>        syncTimeout           <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb148-103"><a href="components.html#cb148-103" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-104"><a href="components.html#cb148-104" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-105"><a href="components.html#cb148-105" aria-hidden="true" tabindex="-1"></a>    logs <span class="op">=</span> {</span>
<span id="cb148-106"><a href="components.html#cb148-106" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> <span class="st">&quot;/opt/airflow/logs&quot;</span></span>
<span id="cb148-107"><a href="components.html#cb148-107" aria-hidden="true" tabindex="-1"></a>      persistence <span class="op">=</span> {</span>
<span id="cb148-108"><a href="components.html#cb148-108" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-109"><a href="components.html#cb148-109" aria-hidden="true" tabindex="-1"></a>        <span class="dt">storageClass</span> <span class="op">:</span> <span class="st">&quot;efs&quot;</span></span>
<span id="cb148-110"><a href="components.html#cb148-110" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size</span> <span class="op">:</span> <span class="st">&quot;5Gi&quot;</span></span>
<span id="cb148-111"><a href="components.html#cb148-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">accessMode</span> <span class="op">:</span> <span class="st">&quot;ReadWriteMany&quot;</span></span>
<span id="cb148-112"><a href="components.html#cb148-112" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-113"><a href="components.html#cb148-113" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-114"><a href="components.html#cb148-114" aria-hidden="true" tabindex="-1"></a>    ingress <span class="op">=</span> {</span>
<span id="cb148-115"><a href="components.html#cb148-115" aria-hidden="true" tabindex="-1"></a>      enabled    <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-116"><a href="components.html#cb148-116" aria-hidden="true" tabindex="-1"></a>      apiVersion <span class="op">=</span> <span class="st">&quot;networking.k8s.io/v1&quot;</span></span>
<span id="cb148-117"><a href="components.html#cb148-117" aria-hidden="true" tabindex="-1"></a>      web <span class="op">=</span> {</span>
<span id="cb148-118"><a href="components.html#cb148-118" aria-hidden="true" tabindex="-1"></a>        annotations <span class="op">=</span> {</span>
<span id="cb148-119"><a href="components.html#cb148-119" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;external-dns.alpha.kubernetes.io/hostname&quot;</span>  <span class="op">=</span> <span class="st">&quot;${var.domain_name}&quot;</span></span>
<span id="cb148-120"><a href="components.html#cb148-120" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/scheme&quot;</span>           <span class="op">=</span> <span class="st">&quot;internet-facing&quot;</span></span>
<span id="cb148-121"><a href="components.html#cb148-121" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/target-type&quot;</span>      <span class="op">=</span> <span class="st">&quot;ip&quot;</span></span>
<span id="cb148-122"><a href="components.html#cb148-122" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;kubernetes.io/ingress.class&quot;</span>                <span class="op">=</span> <span class="st">&quot;alb&quot;</span></span>
<span id="cb148-123"><a href="components.html#cb148-123" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/group.name&quot;</span>       <span class="op">=</span> <span class="st">&quot;mlplatform&quot;</span></span>
<span id="cb148-124"><a href="components.html#cb148-124" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/healthcheck-path&quot;</span> <span class="op">=</span> <span class="st">&quot;/${var.domain_suffix}/health&quot;</span></span>
<span id="cb148-125"><a href="components.html#cb148-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb148-126"><a href="components.html#cb148-126" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> <span class="st">&quot;/${var.domain_suffix}&quot;</span></span>
<span id="cb148-127"><a href="components.html#cb148-127" aria-hidden="true" tabindex="-1"></a>        host <span class="op">=</span> <span class="st">&quot;${var.domain_name}&quot;</span></span>
<span id="cb148-128"><a href="components.html#cb148-128" aria-hidden="true" tabindex="-1"></a>        precedingPaths <span class="op">=</span> [{</span>
<span id="cb148-129"><a href="components.html#cb148-129" aria-hidden="true" tabindex="-1"></a>          path        <span class="op">=</span> <span class="st">&quot;/${var.domain_suffix}*&quot;</span></span>
<span id="cb148-130"><a href="components.html#cb148-130" aria-hidden="true" tabindex="-1"></a>          serviceName <span class="op">=</span> <span class="st">&quot;airflow-web&quot;</span></span>
<span id="cb148-131"><a href="components.html#cb148-131" aria-hidden="true" tabindex="-1"></a>          servicePort <span class="op">=</span> <span class="st">&quot;web&quot;</span></span>
<span id="cb148-132"><a href="components.html#cb148-132" aria-hidden="true" tabindex="-1"></a>        }]</span>
<span id="cb148-133"><a href="components.html#cb148-133" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-134"><a href="components.html#cb148-134" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-135"><a href="components.html#cb148-135" aria-hidden="true" tabindex="-1"></a>    web <span class="op">=</span> {</span>
<span id="cb148-136"><a href="components.html#cb148-136" aria-hidden="true" tabindex="-1"></a>      readinessProbe <span class="op">=</span> {</span>
<span id="cb148-137"><a href="components.html#cb148-137" aria-hidden="true" tabindex="-1"></a>        enabled             <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-138"><a href="components.html#cb148-138" aria-hidden="true" tabindex="-1"></a>        initialDelaySeconds <span class="op">=</span> <span class="dv">45</span></span>
<span id="cb148-139"><a href="components.html#cb148-139" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb148-140"><a href="components.html#cb148-140" aria-hidden="true" tabindex="-1"></a>      livenessProbe <span class="op">=</span> {</span>
<span id="cb148-141"><a href="components.html#cb148-141" aria-hidden="true" tabindex="-1"></a>        enabled             <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb148-142"><a href="components.html#cb148-142" aria-hidden="true" tabindex="-1"></a>        initialDelaySeconds <span class="op">=</span> <span class="dv">45</span></span>
<span id="cb148-143"><a href="components.html#cb148-143" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb148-144"><a href="components.html#cb148-144" aria-hidden="true" tabindex="-1"></a>      webserverConfig <span class="op">=</span> {</span>
<span id="cb148-145"><a href="components.html#cb148-145" aria-hidden="true" tabindex="-1"></a>        stringOverride <span class="op">=</span> <span class="fu">file</span>(<span class="st">&quot;${path.module}/WebServerConfig.py&quot;</span>)</span>
<span id="cb148-146"><a href="components.html#cb148-146" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb148-147"><a href="components.html#cb148-147" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb148-148"><a href="components.html#cb148-148" aria-hidden="true" tabindex="-1"></a>  })]</span>
<span id="cb148-149"><a href="components.html#cb148-149" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In summary, the Terraform code provisions the necessary infrastructure components, IAM roles and policies, data storage, RDS database, Kubernetes secrets, and deploys Apache Airflow using Helm. This setup forms the foundation for the ML platform’s dashboard, enabling workflow orchestration and data management capabilities with Airflow.</p>
<div id="webserverconfig" class="section level4 hasAnchor" number="8.3.2.1">
<h4><span class="header-section-number">8.3.2.1</span> WebServerConfig<a href="components.html#webserverconfig" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In a final step of the Helm Chart, a custom <code>WebServerConfig.py</code> is specified which is set to integrate our Airflow deployment with a Github Authentication provider. The Python script consists of two major parts: a custom AirflowSecurityManager class definition and the actual webserver_config configuration file for Apache Airflow’s web server.</p>
<p>The custom <code>CustomSecurityManager</code> class extends the default AirflowSecurityManager to retrieves user information from the GitHub OAuth provider. The webserver_config configuration sets up the configurations for the web server component of Apache Airflow by indicating that OAuth will be used for user authentication. The <code>SECURITY_MANAGER_CLASS</code> is set to the previously defined <code>CustomSecurityManager</code> to customizes how user information is retrieved from the OAuth provider. Finally, the GitHub provider is configured with its required parameters like <code>client_id</code>, <code>client_secret</code>, and API endpoints.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb149-1"><a href="components.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################</span></span>
<span id="cb149-2"><a href="components.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom AirflowSecurityManager</span></span>
<span id="cb149-3"><a href="components.html#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################</span></span>
<span id="cb149-4"><a href="components.html#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.www.security <span class="im">import</span> AirflowSecurityManager</span>
<span id="cb149-5"><a href="components.html#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb149-6"><a href="components.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="components.html#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="components.html#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomSecurityManager(AirflowSecurityManager):</span>
<span id="cb149-9"><a href="components.html#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_oauth_user_info(<span class="va">self</span>, provider, resp):</span>
<span id="cb149-10"><a href="components.html#cb149-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> provider <span class="op">==</span> <span class="st">&quot;github&quot;</span>:</span>
<span id="cb149-11"><a href="components.html#cb149-11" aria-hidden="true" tabindex="-1"></a>            user_data <span class="op">=</span> <span class="va">self</span>.appbuilder.sm.oauth_remotes[provider].get(<span class="st">&quot;user&quot;</span>).json()</span>
<span id="cb149-12"><a href="components.html#cb149-12" aria-hidden="true" tabindex="-1"></a>            emails_data <span class="op">=</span> (</span>
<span id="cb149-13"><a href="components.html#cb149-13" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.appbuilder.sm.oauth_remotes[provider].get(<span class="st">&quot;user/emails&quot;</span>).json()</span>
<span id="cb149-14"><a href="components.html#cb149-14" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb149-15"><a href="components.html#cb149-15" aria-hidden="true" tabindex="-1"></a>            teams_data <span class="op">=</span> (</span>
<span id="cb149-16"><a href="components.html#cb149-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.appbuilder.sm.oauth_remotes[provider].get(<span class="st">&quot;user/teams&quot;</span>).json()</span>
<span id="cb149-17"><a href="components.html#cb149-17" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb149-18"><a href="components.html#cb149-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-19"><a href="components.html#cb149-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># unpack the user&#39;s name</span></span>
<span id="cb149-20"><a href="components.html#cb149-20" aria-hidden="true" tabindex="-1"></a>            first_name <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb149-21"><a href="components.html#cb149-21" aria-hidden="true" tabindex="-1"></a>            last_name <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb149-22"><a href="components.html#cb149-22" aria-hidden="true" tabindex="-1"></a>            name <span class="op">=</span> user_data.get(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;&quot;</span>).split(maxsplit<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb149-23"><a href="components.html#cb149-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(name) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb149-24"><a href="components.html#cb149-24" aria-hidden="true" tabindex="-1"></a>                first_name <span class="op">=</span> name[<span class="dv">0</span>]</span>
<span id="cb149-25"><a href="components.html#cb149-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(name) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb149-26"><a href="components.html#cb149-26" aria-hidden="true" tabindex="-1"></a>                first_name <span class="op">=</span> name[<span class="dv">0</span>]</span>
<span id="cb149-27"><a href="components.html#cb149-27" aria-hidden="true" tabindex="-1"></a>                last_name <span class="op">=</span> name[<span class="dv">1</span>]</span>
<span id="cb149-28"><a href="components.html#cb149-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-29"><a href="components.html#cb149-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># unpack the user&#39;s email</span></span>
<span id="cb149-30"><a href="components.html#cb149-30" aria-hidden="true" tabindex="-1"></a>            email <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb149-31"><a href="components.html#cb149-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> email_data <span class="kw">in</span> emails_data:</span>
<span id="cb149-32"><a href="components.html#cb149-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> email_data[<span class="st">&quot;primary&quot;</span>]:</span>
<span id="cb149-33"><a href="components.html#cb149-33" aria-hidden="true" tabindex="-1"></a>                    email <span class="op">=</span> email_data[<span class="st">&quot;email&quot;</span>]</span>
<span id="cb149-34"><a href="components.html#cb149-34" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb149-35"><a href="components.html#cb149-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-36"><a href="components.html#cb149-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># unpack the user&#39;s teams as role_keys</span></span>
<span id="cb149-37"><a href="components.html#cb149-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co">: each role key will be &quot;my-github-org/my-team-name&quot;</span></span>
<span id="cb149-38"><a href="components.html#cb149-38" aria-hidden="true" tabindex="-1"></a>            role_keys <span class="op">=</span> []</span>
<span id="cb149-39"><a href="components.html#cb149-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> team_data <span class="kw">in</span> teams_data:</span>
<span id="cb149-40"><a href="components.html#cb149-40" aria-hidden="true" tabindex="-1"></a>                team_org <span class="op">=</span> team_data[<span class="st">&quot;organization&quot;</span>][<span class="st">&quot;login&quot;</span>]</span>
<span id="cb149-41"><a href="components.html#cb149-41" aria-hidden="true" tabindex="-1"></a>                team_slug <span class="op">=</span> team_data[<span class="st">&quot;slug&quot;</span>]</span>
<span id="cb149-42"><a href="components.html#cb149-42" aria-hidden="true" tabindex="-1"></a>                team_ref <span class="op">=</span> team_org <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> team_slug</span>
<span id="cb149-43"><a href="components.html#cb149-43" aria-hidden="true" tabindex="-1"></a>                role_keys.append(team_ref)</span>
<span id="cb149-44"><a href="components.html#cb149-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-45"><a href="components.html#cb149-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb149-46"><a href="components.html#cb149-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;username&quot;</span>: <span class="st">&quot;github_&quot;</span> <span class="op">+</span> user_data.get(<span class="st">&quot;login&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb149-47"><a href="components.html#cb149-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;first_name&quot;</span>: first_name,</span>
<span id="cb149-48"><a href="components.html#cb149-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;last_name&quot;</span>: last_name,</span>
<span id="cb149-49"><a href="components.html#cb149-49" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;email&quot;</span>: email,</span>
<span id="cb149-50"><a href="components.html#cb149-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;role_keys&quot;</span>: role_keys,</span>
<span id="cb149-51"><a href="components.html#cb149-51" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb149-52"><a href="components.html#cb149-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb149-53"><a href="components.html#cb149-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {}</span>
<span id="cb149-54"><a href="components.html#cb149-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-55"><a href="components.html#cb149-55" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################</span></span>
<span id="cb149-56"><a href="components.html#cb149-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual `webserver_config.py`</span></span>
<span id="cb149-57"><a href="components.html#cb149-57" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################</span></span>
<span id="cb149-58"><a href="components.html#cb149-58" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_appbuilder.security.manager <span class="im">import</span> AUTH_OAUTH</span>
<span id="cb149-59"><a href="components.html#cb149-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-60"><a href="components.html#cb149-60" aria-hidden="true" tabindex="-1"></a><span class="co"># only needed for airflow 1.10</span></span>
<span id="cb149-61"><a href="components.html#cb149-61" aria-hidden="true" tabindex="-1"></a><span class="co"># from airflow import configuration as conf</span></span>
<span id="cb149-62"><a href="components.html#cb149-62" aria-hidden="true" tabindex="-1"></a><span class="co"># SQLALCHEMY_DATABASE_URI = conf.get(&quot;core&quot;, &quot;SQL_ALCHEMY_CONN&quot;)</span></span>
<span id="cb149-63"><a href="components.html#cb149-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-64"><a href="components.html#cb149-64" aria-hidden="true" tabindex="-1"></a>AUTH_TYPE <span class="op">=</span> AUTH_OAUTH</span>
<span id="cb149-65"><a href="components.html#cb149-65" aria-hidden="true" tabindex="-1"></a>SECURITY_MANAGER_CLASS <span class="op">=</span> CustomSecurityManager</span>
<span id="cb149-66"><a href="components.html#cb149-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-67"><a href="components.html#cb149-67" aria-hidden="true" tabindex="-1"></a><span class="co"># registration configs</span></span>
<span id="cb149-68"><a href="components.html#cb149-68" aria-hidden="true" tabindex="-1"></a>AUTH_USER_REGISTRATION <span class="op">=</span> <span class="va">True</span>  <span class="co"># allow users who are not already in the FAB DB</span></span>
<span id="cb149-69"><a href="components.html#cb149-69" aria-hidden="true" tabindex="-1"></a>AUTH_USER_REGISTRATION_ROLE <span class="op">=</span> (</span>
<span id="cb149-70"><a href="components.html#cb149-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Public&quot;</span>  <span class="co"># this role will be given in addition to any AUTH_ROLES_MAPPING</span></span>
<span id="cb149-71"><a href="components.html#cb149-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-72"><a href="components.html#cb149-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-73"><a href="components.html#cb149-73" aria-hidden="true" tabindex="-1"></a><span class="co"># the list of providers which the user can choose from</span></span>
<span id="cb149-74"><a href="components.html#cb149-74" aria-hidden="true" tabindex="-1"></a>OAUTH_PROVIDERS <span class="op">=</span> [</span>
<span id="cb149-75"><a href="components.html#cb149-75" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb149-76"><a href="components.html#cb149-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;name&quot;</span>: <span class="st">&quot;github&quot;</span>,</span>
<span id="cb149-77"><a href="components.html#cb149-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;icon&quot;</span>: <span class="st">&quot;fa-github&quot;</span>,</span>
<span id="cb149-78"><a href="components.html#cb149-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;token_key&quot;</span>: <span class="st">&quot;access_token&quot;</span>,</span>
<span id="cb149-79"><a href="components.html#cb149-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;remote_app&quot;</span>: {</span>
<span id="cb149-80"><a href="components.html#cb149-80" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;client_id&quot;</span>: os.getenv(<span class="st">&quot;GITHUB_CLIENT_ID&quot;</span>),</span>
<span id="cb149-81"><a href="components.html#cb149-81" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;client_secret&quot;</span>: os.getenv(<span class="st">&quot;GITHUB_CLIENT_SECRET&quot;</span>),</span>
<span id="cb149-82"><a href="components.html#cb149-82" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;api_base_url&quot;</span>: <span class="st">&quot;https://api.github.com&quot;</span>,</span>
<span id="cb149-83"><a href="components.html#cb149-83" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;client_kwargs&quot;</span>: {<span class="st">&quot;scope&quot;</span>: <span class="st">&quot;read:org read:user user:email&quot;</span>},</span>
<span id="cb149-84"><a href="components.html#cb149-84" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;access_token_url&quot;</span>: <span class="st">&quot;https://github.com/login/oauth/access_token&quot;</span>,</span>
<span id="cb149-85"><a href="components.html#cb149-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;authorize_url&quot;</span>: <span class="st">&quot;https://github.com/login/oauth/authorize&quot;</span>,</span>
<span id="cb149-86"><a href="components.html#cb149-86" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb149-87"><a href="components.html#cb149-87" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb149-88"><a href="components.html#cb149-88" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb149-89"><a href="components.html#cb149-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-90"><a href="components.html#cb149-90" aria-hidden="true" tabindex="-1"></a><span class="co"># a mapping from the values of `userinfo[&quot;role_keys&quot;]` to a list of FAB roles</span></span>
<span id="cb149-91"><a href="components.html#cb149-91" aria-hidden="true" tabindex="-1"></a>AUTH_ROLES_MAPPING <span class="op">=</span> {</span>
<span id="cb149-92"><a href="components.html#cb149-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github-organization/airflow-users-team&quot;</span>: [<span class="st">&quot;User&quot;</span>],</span>
<span id="cb149-93"><a href="components.html#cb149-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github-organization/airflow-admin-team&quot;</span>: [<span class="st">&quot;Admin&quot;</span>],</span>
<span id="cb149-94"><a href="components.html#cb149-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-95"><a href="components.html#cb149-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-96"><a href="components.html#cb149-96" aria-hidden="true" tabindex="-1"></a><span class="co"># if we should replace ALL the user&#39;s roles each login, or only on registration</span></span>
<span id="cb149-97"><a href="components.html#cb149-97" aria-hidden="true" tabindex="-1"></a>AUTH_ROLES_SYNC_AT_LOGIN <span class="op">=</span> <span class="va">True</span></span>
<span id="cb149-98"><a href="components.html#cb149-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-99"><a href="components.html#cb149-99" aria-hidden="true" tabindex="-1"></a><span class="co"># force users to re-auth after 30min of inactivity (to keep roles in sync)</span></span>
<span id="cb149-100"><a href="components.html#cb149-100" aria-hidden="true" tabindex="-1"></a>PERMANENT_SESSION_LIFETIME <span class="op">=</span> <span class="dv">1800</span></span></code></pre></div>

</div>
</div>
<div id="mlflow-1" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Mlflow<a href="components.html#mlflow-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to enable model tracking, the deployment of MLflow necessitates specific requirements. These include the establishment of a data store on AWS S3, a metadata store utilizing PostgreSQL (RDS), and the MLflow server itself. The initial two components are crafted using Terraform resources.</p>
<p>However, it’s worth noting that MLflow lacks native support for Kubernetes and an official Helm chart. In light of this, despite being a highly effective tool, we need to create a fundamental custom Helm chart for deploying the MLflow server. Furthermore, a custom container image is employed for running MLflow. This process entails the creation of YAML configurations for deployment, service, and configmap, all of which are executed on our Kubernetes cluster.</p>
<p>The provided Terraform code assumes responsibility for orchestrating the deployment of a dashboard tailored for an ML platform, relying on the power of MLflow. This intricate process encompasses various configurations and resource deployments. It commences by defining local variables, including a unique S3 bucket name. Subsequently, an S3 bucket with the name <code>"mlflow"</code> is generated, designed explicitly for housing MLflow artifacts.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb150-1"><a href="components.html#cb150-1" aria-hidden="true" tabindex="-1"></a>locals {</span>
<span id="cb150-2"><a href="components.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  s3_bucket_name        <span class="op">=</span> <span class="st">&quot;${var.name_prefix}-${var.namespace}-${var.s3_bucket_name}&quot;</span></span>
<span id="cb150-3"><a href="components.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  s3_bucket_path_prefix <span class="op">=</span> <span class="st">&quot;users&quot;</span></span>
<span id="cb150-4"><a href="components.html#cb150-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb150-5"><a href="components.html#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="components.html#cb150-6" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_caller_identity&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb150-7"><a href="components.html#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="components.html#cb150-8" aria-hidden="true" tabindex="-1"></a># create s3 bucket <span class="cf">for</span> artifacts</span>
<span id="cb150-9"><a href="components.html#cb150-9" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_s3_bucket&quot;</span> <span class="st">&quot;mlflow&quot;</span> {</span>
<span id="cb150-10"><a href="components.html#cb150-10" aria-hidden="true" tabindex="-1"></a>  bucket <span class="op">=</span> local<span class="op">.</span><span class="at">s3_bucket_name</span></span>
<span id="cb150-11"><a href="components.html#cb150-11" aria-hidden="true" tabindex="-1"></a>  # tags          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">tags</span></span>
<span id="cb150-12"><a href="components.html#cb150-12" aria-hidden="true" tabindex="-1"></a>  force_destroy <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">s3_force_destroy</span></span>
<span id="cb150-13"><a href="components.html#cb150-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb150-14"><a href="components.html#cb150-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-15"><a href="components.html#cb150-15" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span> <span class="st">&quot;bucket_state_encryption&quot;</span> {</span>
<span id="cb150-16"><a href="components.html#cb150-16" aria-hidden="true" tabindex="-1"></a>  bucket <span class="op">=</span> aws_s3_bucket<span class="op">.</span><span class="at">mlflow</span><span class="op">.</span><span class="at">bucket</span></span>
<span id="cb150-17"><a href="components.html#cb150-17" aria-hidden="true" tabindex="-1"></a>  rule {</span>
<span id="cb150-18"><a href="components.html#cb150-18" aria-hidden="true" tabindex="-1"></a>    apply_server_side_encryption_by_default {</span>
<span id="cb150-19"><a href="components.html#cb150-19" aria-hidden="true" tabindex="-1"></a>      sse_algorithm <span class="op">=</span> <span class="st">&quot;AES256&quot;</span></span>
<span id="cb150-20"><a href="components.html#cb150-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb150-21"><a href="components.html#cb150-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb150-22"><a href="components.html#cb150-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Following this, an IAM role by the name of <code>"mlflow_s3_role"</code> is crafted, bestowing access to the S3 bucket. This role assumes a web identity role using the OIDC provider ARN specified by <code>var.oidc_provider_arn</code>. In a similar vein, an IAM policy named <code>"mlflow_s3_policy"</code> is forged, extending specific permissions for S3 access. These permissions encompass actions such as object creation, listing, and deletion within the S3 bucket. The policy is meticulously scoped to the S3 bucket and its associated objects. Subsequently, the <code>"mlflow_s3_policy"</code> is attached to the <code>"mlflow_s3_role"</code>, effectively enabling the IAM role to wield the permissions delineated in the policy.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb151-1"><a href="components.html#cb151-1" aria-hidden="true" tabindex="-1"></a># <span class="st">&quot;arn:aws:iam::${data.aws_caller_identity.current.account_id}:oidc-provider/${var.eks_oidc_provider}&quot;</span></span>
<span id="cb151-2"><a href="components.html#cb151-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role&quot;</span> <span class="st">&quot;mlflow_s3_role&quot;</span> {</span>
<span id="cb151-3"><a href="components.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> <span class="st">&quot;${var.namespace}-s3-access-role&quot;</span></span>
<span id="cb151-4"><a href="components.html#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="components.html#cb151-5" aria-hidden="true" tabindex="-1"></a>  assume_role_policy <span class="op">=</span> <span class="op">&lt;&lt;</span>EOF</span>
<span id="cb151-6"><a href="components.html#cb151-6" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb151-7"><a href="components.html#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Version&quot;</span><span class="op">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="op">,</span></span>
<span id="cb151-8"><a href="components.html#cb151-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Statement&quot;</span><span class="op">:</span> [</span>
<span id="cb151-9"><a href="components.html#cb151-9" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb151-10"><a href="components.html#cb151-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Action&quot;</span> <span class="op">:</span> <span class="st">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="op">,</span></span>
<span id="cb151-11"><a href="components.html#cb151-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Effect&quot;</span><span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb151-12"><a href="components.html#cb151-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Principal&quot;</span> <span class="op">:</span> {</span>
<span id="cb151-13"><a href="components.html#cb151-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Federated&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-14"><a href="components.html#cb151-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;${var.oidc_provider_arn}&quot;</span></span>
<span id="cb151-15"><a href="components.html#cb151-15" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb151-16"><a href="components.html#cb151-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb151-17"><a href="components.html#cb151-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb151-18"><a href="components.html#cb151-18" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb151-19"><a href="components.html#cb151-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-20"><a href="components.html#cb151-20" aria-hidden="true" tabindex="-1"></a>  EOF</span>
<span id="cb151-21"><a href="components.html#cb151-21" aria-hidden="true" tabindex="-1"></a>  tags <span class="op">=</span> {</span>
<span id="cb151-22"><a href="components.html#cb151-22" aria-hidden="true" tabindex="-1"></a>    tag<span class="op">-</span>key <span class="op">=</span> <span class="st">&quot;tag-value&quot;</span></span>
<span id="cb151-23"><a href="components.html#cb151-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-24"><a href="components.html#cb151-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-25"><a href="components.html#cb151-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-26"><a href="components.html#cb151-26" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_policy&quot;</span> <span class="st">&quot;mlflow_s3_policy&quot;</span> {</span>
<span id="cb151-27"><a href="components.html#cb151-27" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> <span class="st">&quot;${var.namespace}-s3-access-policy&quot;</span></span>
<span id="cb151-28"><a href="components.html#cb151-28" aria-hidden="true" tabindex="-1"></a>  path <span class="op">=</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb151-29"><a href="components.html#cb151-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-30"><a href="components.html#cb151-30" aria-hidden="true" tabindex="-1"></a>  policy <span class="op">=</span> <span class="fu">jsonencode</span>({</span>
<span id="cb151-31"><a href="components.html#cb151-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Version&quot;</span> <span class="op">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="op">,</span></span>
<span id="cb151-32"><a href="components.html#cb151-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Statement&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-33"><a href="components.html#cb151-33" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb151-34"><a href="components.html#cb151-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Effect&quot;</span> <span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb151-35"><a href="components.html#cb151-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Action&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-36"><a href="components.html#cb151-36" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;s3:*Object&quot;</span><span class="op">,</span></span>
<span id="cb151-37"><a href="components.html#cb151-37" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;s3:GetObjectVersion&quot;</span><span class="op">,</span></span>
<span id="cb151-38"><a href="components.html#cb151-38" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;s3:*&quot;</span></span>
<span id="cb151-39"><a href="components.html#cb151-39" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb151-40"><a href="components.html#cb151-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Resource&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-41"><a href="components.html#cb151-41" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;arn:aws:s3:::${local.s3_bucket_name}/*&quot;</span><span class="op">,</span></span>
<span id="cb151-42"><a href="components.html#cb151-42" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;arn:aws:s3:::${local.s3_bucket_name}&quot;</span></span>
<span id="cb151-43"><a href="components.html#cb151-43" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb151-44"><a href="components.html#cb151-44" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb151-45"><a href="components.html#cb151-45" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb151-46"><a href="components.html#cb151-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Effect&quot;</span> <span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb151-47"><a href="components.html#cb151-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Action&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-48"><a href="components.html#cb151-48" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;s3:ListBucket&quot;</span><span class="op">,</span></span>
<span id="cb151-49"><a href="components.html#cb151-49" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;s3:ListBucketVersions&quot;</span></span>
<span id="cb151-50"><a href="components.html#cb151-50" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb151-51"><a href="components.html#cb151-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Resource&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-52"><a href="components.html#cb151-52" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;arn:aws:s3:::${local.s3_bucket_name}/*&quot;</span><span class="op">,</span></span>
<span id="cb151-53"><a href="components.html#cb151-53" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;arn:aws:s3:::${local.s3_bucket_name}&quot;</span></span>
<span id="cb151-54"><a href="components.html#cb151-54" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb151-55"><a href="components.html#cb151-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Condition&quot;</span> <span class="op">:</span> {</span>
<span id="cb151-56"><a href="components.html#cb151-56" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;StringLike&quot;</span> <span class="op">:</span> {</span>
<span id="cb151-57"><a href="components.html#cb151-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;s3:prefix&quot;</span> <span class="op">:</span> [</span>
<span id="cb151-58"><a href="components.html#cb151-58" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;${local.s3_bucket_path_prefix}/*&quot;</span></span>
<span id="cb151-59"><a href="components.html#cb151-59" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb151-60"><a href="components.html#cb151-60" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb151-61"><a href="components.html#cb151-61" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb151-62"><a href="components.html#cb151-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb151-63"><a href="components.html#cb151-63" aria-hidden="true" tabindex="-1"></a>  ] })</span>
<span id="cb151-64"><a href="components.html#cb151-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-65"><a href="components.html#cb151-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-66"><a href="components.html#cb151-66" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role_policy_attachment&quot;</span> <span class="st">&quot;mlflow_s3_policy&quot;</span> {</span>
<span id="cb151-67"><a href="components.html#cb151-67" aria-hidden="true" tabindex="-1"></a>  role       <span class="op">=</span> aws_iam_role<span class="op">.</span><span class="at">mlflow_s3_role</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb151-68"><a href="components.html#cb151-68" aria-hidden="true" tabindex="-1"></a>  policy_arn <span class="op">=</span> aws_iam_policy<span class="op">.</span><span class="at">mlflow_s3_policy</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb151-69"><a href="components.html#cb151-69" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Much like the Airflow deployment, an RDS database is deployed for use as a metadata store through the specified RDS module. Here, a random password is generated for the RDS database that will be employed by MLflow.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb152-1"><a href="components.html#cb152-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-2"><a href="components.html#cb152-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;random_password&quot;</span> <span class="st">&quot;rds_password&quot;</span> {</span>
<span id="cb152-3"><a href="components.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  length <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb152-4"><a href="components.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  # MLFlow has troubles using special characters</span>
<span id="cb152-5"><a href="components.html#cb152-5" aria-hidden="true" tabindex="-1"></a>  special <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb152-6"><a href="components.html#cb152-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb152-7"><a href="components.html#cb152-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-8"><a href="components.html#cb152-8" aria-hidden="true" tabindex="-1"></a># create rds <span class="cf">for</span> s3</span>
<span id="cb152-9"><a href="components.html#cb152-9" aria-hidden="true" tabindex="-1"></a>module <span class="st">&quot;rds-mlflow&quot;</span> {</span>
<span id="cb152-10"><a href="components.html#cb152-10" aria-hidden="true" tabindex="-1"></a>  source                      <span class="op">=</span> <span class="st">&quot;../../infrastructure/rds&quot;</span></span>
<span id="cb152-11"><a href="components.html#cb152-11" aria-hidden="true" tabindex="-1"></a>  vpc_id                      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">vpc_id</span></span>
<span id="cb152-12"><a href="components.html#cb152-12" aria-hidden="true" tabindex="-1"></a>  private_subnets             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">private_subnets</span></span>
<span id="cb152-13"><a href="components.html#cb152-13" aria-hidden="true" tabindex="-1"></a>  private_subnets_cidr_blocks <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">private_subnets_cidr_blocks</span></span>
<span id="cb152-14"><a href="components.html#cb152-14" aria-hidden="true" tabindex="-1"></a>  rds_port                    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_port</span></span>
<span id="cb152-15"><a href="components.html#cb152-15" aria-hidden="true" tabindex="-1"></a>  rds_name                    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_name</span></span>
<span id="cb152-16"><a href="components.html#cb152-16" aria-hidden="true" tabindex="-1"></a>  rds_password                <span class="op">=</span> <span class="fu">coalesce</span>(<span class="kw">var</span><span class="op">.</span><span class="at">rds_password</span><span class="op">,</span> random_password<span class="op">.</span><span class="at">rds_password</span><span class="op">.</span><span class="at">result</span>)</span>
<span id="cb152-17"><a href="components.html#cb152-17" aria-hidden="true" tabindex="-1"></a>  rds_engine                  <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_engine</span></span>
<span id="cb152-18"><a href="components.html#cb152-18" aria-hidden="true" tabindex="-1"></a>  rds_engine_version          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_engine_version</span></span>
<span id="cb152-19"><a href="components.html#cb152-19" aria-hidden="true" tabindex="-1"></a>  rds_instance_class          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_instance_class</span></span>
<span id="cb152-20"><a href="components.html#cb152-20" aria-hidden="true" tabindex="-1"></a>  storage_type                <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_storage_type</span></span>
<span id="cb152-21"><a href="components.html#cb152-21" aria-hidden="true" tabindex="-1"></a>  max_allocated_storage       <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_max_allocated_storage</span></span>
<span id="cb152-22"><a href="components.html#cb152-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The final phase of this deployment leverages Helm to roll out MLflow. It encompasses crucial aspects such as the Docker image selection for MLflow, configuration settings for external access through Ingress, configuration of the S3 bucket, and provision of essential information regarding the RDS database. This Helm release orchestrates the deployment of MLflow, a pivotal component within the ML platform’s dashboard.</p>
<p>Given the absence of a native Helm chart for MLflow, a custom Helm chart has been crafted to facilitate this deployment. The chart brings together various Kubernetes deployments, including the MLflow deployment itself, a service account, a secret, and an ingress configuration. For a detailed look at the chart and its components, you can refer to this <a href="https://github.com/seblum/mlops-mlplatform-on-eks/tree/main/deployment/modules/mlflow/helm/templates">implementation</a>.
Furthermore, as MLflow doesn’t offer a suitable container image for our specific use case, a custom container image has been defined and can be explored <a href="https://github.com/seblum/mlflow-image">here</a>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb153-1"><a href="components.html#cb153-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-2"><a href="components.html#cb153-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;mlflow&quot;</span> {</span>
<span id="cb153-3"><a href="components.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb153-4"><a href="components.html#cb153-4" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb153-5"><a href="components.html#cb153-5" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb153-6"><a href="components.html#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="components.html#cb153-7" aria-hidden="true" tabindex="-1"></a>  chart <span class="op">=</span> <span class="st">&quot;${path.module}/helm/&quot;</span></span>
<span id="cb153-8"><a href="components.html#cb153-8" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [<span class="fu">yamlencode</span>({</span>
<span id="cb153-9"><a href="components.html#cb153-9" aria-hidden="true" tabindex="-1"></a>    deployment <span class="op">=</span> {</span>
<span id="cb153-10"><a href="components.html#cb153-10" aria-hidden="true" tabindex="-1"></a>      image     <span class="op">=</span> <span class="st">&quot;seblum/mlflow:v2.4.1&quot;</span></span>
<span id="cb153-11"><a href="components.html#cb153-11" aria-hidden="true" tabindex="-1"></a>      namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb153-12"><a href="components.html#cb153-12" aria-hidden="true" tabindex="-1"></a>      name      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb153-13"><a href="components.html#cb153-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb153-14"><a href="components.html#cb153-14" aria-hidden="true" tabindex="-1"></a>    ingress <span class="op">=</span> {</span>
<span id="cb153-15"><a href="components.html#cb153-15" aria-hidden="true" tabindex="-1"></a>      host <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">domain_name</span></span>
<span id="cb153-16"><a href="components.html#cb153-16" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">domain_suffix</span></span>
<span id="cb153-17"><a href="components.html#cb153-17" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb153-18"><a href="components.html#cb153-18" aria-hidden="true" tabindex="-1"></a>    artifacts <span class="op">=</span> {</span>
<span id="cb153-19"><a href="components.html#cb153-19" aria-hidden="true" tabindex="-1"></a>      s3_role_arn   <span class="op">=</span> <span class="st">&quot;arn:aws:iam::${data.aws_caller_identity.current.account_id}:role/${aws_iam_role.mlflow_s3_role.name}&quot;</span><span class="op">,</span></span>
<span id="cb153-20"><a href="components.html#cb153-20" aria-hidden="true" tabindex="-1"></a>      s3_key_prefix <span class="op">=</span> local<span class="op">.</span><span class="at">s3_bucket_path_prefix</span><span class="op">,</span></span>
<span id="cb153-21"><a href="components.html#cb153-21" aria-hidden="true" tabindex="-1"></a>      s3_bucket     <span class="op">=</span> local<span class="op">.</span><span class="at">s3_bucket_name</span><span class="op">,</span></span>
<span id="cb153-22"><a href="components.html#cb153-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb153-23"><a href="components.html#cb153-23" aria-hidden="true" tabindex="-1"></a>    rds <span class="op">=</span> {</span>
<span id="cb153-24"><a href="components.html#cb153-24" aria-hidden="true" tabindex="-1"></a>      host     <span class="op">=</span> module<span class="op">.</span><span class="at">rds</span><span class="op">-</span>mlflow<span class="op">.</span><span class="at">rds_host</span></span>
<span id="cb153-25"><a href="components.html#cb153-25" aria-hidden="true" tabindex="-1"></a>      port     <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">rds_port</span><span class="op">,</span></span>
<span id="cb153-26"><a href="components.html#cb153-26" aria-hidden="true" tabindex="-1"></a>      username <span class="op">=</span> module<span class="op">.</span><span class="at">rds</span><span class="op">-</span>mlflow<span class="op">.</span><span class="at">rds_username</span><span class="op">,</span></span>
<span id="cb153-27"><a href="components.html#cb153-27" aria-hidden="true" tabindex="-1"></a>      password <span class="op">=</span> module<span class="op">.</span><span class="at">rds</span><span class="op">-</span>mlflow<span class="op">.</span><span class="at">rds_password</span><span class="op">,</span></span>
<span id="cb153-28"><a href="components.html#cb153-28" aria-hidden="true" tabindex="-1"></a>      db_name  <span class="op">=</span> module<span class="op">.</span><span class="at">rds</span><span class="op">-</span>mlflow<span class="op">.</span><span class="at">rds_dbname</span></span>
<span id="cb153-29"><a href="components.html#cb153-29" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb153-30"><a href="components.html#cb153-30" aria-hidden="true" tabindex="-1"></a>  })]</span>
<span id="cb153-31"><a href="components.html#cb153-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p><strong><em>NOTE:</em></strong> It’s important to note that the deployment has an open endpoint, which means it lacks sufficient security measures.</p>
</blockquote>

</div>
<div id="jupyterhub" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Jupyterhub<a href="components.html#jupyterhub" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In our setup, JupyterHub plays a crucial role by providing an Integrated Development Environment (IDE). The Terraform code presented here defines a <code>helm_release</code> responsible for deploying JupyterHub onto our EKS cluster. In contrast to other components of our ML platform, JupyterHub doesn’t require additional resources to operate.</p>
<p>The Helm configuration used in this deployment is multifaceted, encompassing various settings and customizations. Its primary aim is to establish a JupyterHub instance that seamlessly integrates with a single-user Jupyter notebook server. This configuration encompasses user sessions, GitHub authentication, proxy settings, Ingress for external access, and various other JupyterHub-related configurations. This ensures that JupyterHub is finely tuned to meet the specific requirements of our ML platform, providing users with the ability to run interactive notebooks and access MLflow services effortlessly.</p>
<p>Within the Terraform code, a Helm release named <code>"jupyterhub"</code> is defined, orchestrating the deployment of JupyterHub into the designated Kubernetes namespace. The Helm chart is sourced from the JupyterHub Helm chart repository at a version specified by <code>var.helm_chart_version</code>. The <code>values</code> block within this configuration contains a YAML-encoded set of parameters for JupyterHub, including numerous settings related to single-user notebooks, Ingress, proxy, culling, and hub configuration.</p>
<ul>
<li><strong>Single-User Notebook Configuration</strong>: This segment of the configuration is dedicated to single-user notebook settings. It encompasses parameters like the default URL for notebooks, the Docker image to be employed, and lifecycle hooks. The Docker image is set to “seblum/jupyterhub-server:latest,” and a postStart lifecycle hook is defined to clone a Git repository specified by <code>var.git_repository_url</code>. Additionally, an environment variable <code>MLFLOW_TRACKING_URI</code> is configured to point to the URI of the MLflow service.</li>
<li><strong>Ingress Configuration</strong>: The Ingress resource is configured to facilitate external access to JupyterHub. This entails the inclusion of annotations to tailor its behavior. Key settings include the specification of the hostname, scheme, healthcheck path, and ingress class. Hosts are configured to <code>${var.domain_name}</code> and <code>www.${var.domain_name}</code>, facilitating access through the designated domain name.</li>
<li><strong>Proxy Configuration</strong>: Within the proxy configuration, the service type for the JupyterHub proxy is set as “ClusterIP.” Additionally, the <code>secretToken</code> is configured with a value provided by <code>var.proxy_secret_token</code>.</li>
<li><strong>Culling Configuration</strong>: Culling is enabled and finely tuned to manage user sessions. Users are subject to culling when their sessions become idle.</li>
<li><strong>Hub Configuration</strong>: The hub configuration addresses settings pertaining to the JupyterHub’s base URL, GitHub OAuthenticator, and JupyterHub’s authenticator class. Similar to the Airflow deployment, the JupyterHub instance is configured to utilize GitHub OAuthenticator for user authentication. This OAuthenticator is then configured with the supplied GitHub credentials (<code>var.git_client_id</code> and <code>var.git_client_secret</code>), along with the <code>oauth_callback_url</code> parameter, which specifies a specific endpoint under the provided domain name.</li>
</ul>
<div class="sourceCode" id="cb154"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb154-1"><a href="components.html#cb154-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;jupyterhub&quot;</span> {</span>
<span id="cb154-2"><a href="components.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb154-3"><a href="components.html#cb154-3" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb154-4"><a href="components.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb154-5"><a href="components.html#cb154-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-6"><a href="components.html#cb154-6" aria-hidden="true" tabindex="-1"></a>  repository <span class="op">=</span> <span class="st">&quot;https://jupyterhub.github.io/helm-chart/&quot;</span></span>
<span id="cb154-7"><a href="components.html#cb154-7" aria-hidden="true" tabindex="-1"></a>  chart      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">helm_chart_name</span></span>
<span id="cb154-8"><a href="components.html#cb154-8" aria-hidden="true" tabindex="-1"></a>  version    <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">helm_chart_version</span></span>
<span id="cb154-9"><a href="components.html#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="components.html#cb154-10" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [<span class="fu">yamlencode</span>({</span>
<span id="cb154-11"><a href="components.html#cb154-11" aria-hidden="true" tabindex="-1"></a>    singleuser <span class="op">=</span> {</span>
<span id="cb154-12"><a href="components.html#cb154-12" aria-hidden="true" tabindex="-1"></a>      defaultUrl <span class="op">=</span> <span class="st">&quot;/lab&quot;</span></span>
<span id="cb154-13"><a href="components.html#cb154-13" aria-hidden="true" tabindex="-1"></a>      image <span class="op">=</span> {</span>
<span id="cb154-14"><a href="components.html#cb154-14" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> <span class="st">&quot;seblum/jupyterhub-server&quot;</span></span>
<span id="cb154-15"><a href="components.html#cb154-15" aria-hidden="true" tabindex="-1"></a>        tag  <span class="op">=</span> <span class="st">&quot;latest&quot;</span></span>
<span id="cb154-16"><a href="components.html#cb154-16" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb154-17"><a href="components.html#cb154-17" aria-hidden="true" tabindex="-1"></a>      lifecycleHooks <span class="op">=</span> {</span>
<span id="cb154-18"><a href="components.html#cb154-18" aria-hidden="true" tabindex="-1"></a>        postStart <span class="op">=</span> {</span>
<span id="cb154-19"><a href="components.html#cb154-19" aria-hidden="true" tabindex="-1"></a>          exec <span class="op">=</span> {</span>
<span id="cb154-20"><a href="components.html#cb154-20" aria-hidden="true" tabindex="-1"></a>            command <span class="op">=</span> [<span class="st">&quot;git&quot;</span><span class="op">,</span> <span class="st">&quot;clone&quot;</span><span class="op">,</span> <span class="st">&quot;${var.git_repository_url}&quot;</span>]</span>
<span id="cb154-21"><a href="components.html#cb154-21" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb154-22"><a href="components.html#cb154-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-23"><a href="components.html#cb154-23" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb154-24"><a href="components.html#cb154-24" aria-hidden="true" tabindex="-1"></a>      extraEnv <span class="op">=</span> {</span>
<span id="cb154-25"><a href="components.html#cb154-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;MLFLOW_TRACKING_URI&quot;</span> <span class="op">=</span> <span class="st">&quot;http://mlflow-service.mlflow.svc.cluster.local&quot;</span></span>
<span id="cb154-26"><a href="components.html#cb154-26" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-27"><a href="components.html#cb154-27" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb154-28"><a href="components.html#cb154-28" aria-hidden="true" tabindex="-1"></a>    ingress <span class="op">=</span> {</span>
<span id="cb154-29"><a href="components.html#cb154-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">enabled</span> <span class="op">:</span> <span class="kw">true</span></span>
<span id="cb154-30"><a href="components.html#cb154-30" aria-hidden="true" tabindex="-1"></a>      annotations <span class="op">=</span> {</span>
<span id="cb154-31"><a href="components.html#cb154-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;external-dns.alpha.kubernetes.io/hostname&quot;</span> <span class="op">=</span> <span class="st">&quot;${var.domain_name}&quot;</span></span>
<span id="cb154-32"><a href="components.html#cb154-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;alb.ingress.kubernetes.io/scheme&quot;</span>          <span class="op">=</span> <span class="st">&quot;internet-facing&quot;</span></span>
<span id="cb154-33"><a href="components.html#cb154-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;alb.ingress.kubernetes.io/target-type&quot;</span>     <span class="op">=</span> <span class="st">&quot;ip&quot;</span></span>
<span id="cb154-34"><a href="components.html#cb154-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;kubernetes.io/ingress.class&quot;</span>               <span class="op">=</span> <span class="st">&quot;alb&quot;</span></span>
<span id="cb154-35"><a href="components.html#cb154-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;alb.ingress.kubernetes.io/group.name&quot;</span>      <span class="op">=</span> <span class="st">&quot;mlplatform&quot;</span></span>
<span id="cb154-36"><a href="components.html#cb154-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-37"><a href="components.html#cb154-37" aria-hidden="true" tabindex="-1"></a>      hosts <span class="op">=</span> [<span class="st">&quot;${var.domain_name}&quot;</span><span class="op">,</span> <span class="st">&quot;www.${var.domain_name}&quot;</span>]</span>
<span id="cb154-38"><a href="components.html#cb154-38" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb154-39"><a href="components.html#cb154-39" aria-hidden="true" tabindex="-1"></a>    proxy <span class="op">=</span> {</span>
<span id="cb154-40"><a href="components.html#cb154-40" aria-hidden="true" tabindex="-1"></a>      service <span class="op">=</span> {</span>
<span id="cb154-41"><a href="components.html#cb154-41" aria-hidden="true" tabindex="-1"></a>        type <span class="op">=</span> <span class="st">&quot;ClusterIP&quot;</span></span>
<span id="cb154-42"><a href="components.html#cb154-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-43"><a href="components.html#cb154-43" aria-hidden="true" tabindex="-1"></a>      secretToken <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">proxy_secret_token</span></span>
<span id="cb154-44"><a href="components.html#cb154-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-45"><a href="components.html#cb154-45" aria-hidden="true" tabindex="-1"></a>    cull <span class="op">=</span> {</span>
<span id="cb154-46"><a href="components.html#cb154-46" aria-hidden="true" tabindex="-1"></a>      enabled <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb154-47"><a href="components.html#cb154-47" aria-hidden="true" tabindex="-1"></a>      users   <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb154-48"><a href="components.html#cb154-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-49"><a href="components.html#cb154-49" aria-hidden="true" tabindex="-1"></a>    hub <span class="op">=</span> {</span>
<span id="cb154-50"><a href="components.html#cb154-50" aria-hidden="true" tabindex="-1"></a>      baseUrl <span class="op">=</span> <span class="st">&quot;/${var.domain_suffix}&quot;</span></span>
<span id="cb154-51"><a href="components.html#cb154-51" aria-hidden="true" tabindex="-1"></a>      config <span class="op">=</span> {</span>
<span id="cb154-52"><a href="components.html#cb154-52" aria-hidden="true" tabindex="-1"></a>        GitHubOAuthenticator <span class="op">=</span> {</span>
<span id="cb154-53"><a href="components.html#cb154-53" aria-hidden="true" tabindex="-1"></a>          client_id          <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_client_id</span></span>
<span id="cb154-54"><a href="components.html#cb154-54" aria-hidden="true" tabindex="-1"></a>          client_secret      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_client_secret</span></span>
<span id="cb154-55"><a href="components.html#cb154-55" aria-hidden="true" tabindex="-1"></a>          oauth_callback_url <span class="op">=</span> <span class="st">&quot;http://${var.domain_name}/${var.domain_suffix}/hub/oauth_callback&quot;</span></span>
<span id="cb154-56"><a href="components.html#cb154-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-57"><a href="components.html#cb154-57" aria-hidden="true" tabindex="-1"></a>        JupyterHub <span class="op">=</span> {</span>
<span id="cb154-58"><a href="components.html#cb154-58" aria-hidden="true" tabindex="-1"></a>          authenticator_class <span class="op">=</span> <span class="st">&quot;github&quot;</span></span>
<span id="cb154-59"><a href="components.html#cb154-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-60"><a href="components.html#cb154-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-61"><a href="components.html#cb154-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-62"><a href="components.html#cb154-62" aria-hidden="true" tabindex="-1"></a>  })]</span>
<span id="cb154-63"><a href="components.html#cb154-63" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
<div id="monitoring" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Monitoring<a href="components.html#monitoring" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Incorporated into the setup is a monitoring system leveraging Prometheus and Grafana. While not a direct component of the ML pipeline, this configuration serves as an instructive illustration of proficient cluster monitoring. It encompasses a fundamental monitoring setup accomplished through the utilization of Prometheus and Grafana.</p>
<p>Prometheus and Grafana play distinct yet complementary roles in the domain of monitoring and observability. Prometheus is primarily responsible for collecting, storing, and alerting based on time-series metrics. It scrapes data from various sources, defines alerting rules, and supports service discovery, making it a robust monitoring and alerting tool. It also offers a query language for metric analysis and flexible data retention policies.</p>
<p>On the other hand, Grafana specializes in data visualization and interactive dashboard creation. It connects to data sources like Prometheus and transforms metric data into visually engaging charts and graphs. Grafana is instrumental in designing comprehensive monitoring dashboards, visualizing alerts, and facilitating data exploration. Together, Prometheus and Grafana form a powerful monitoring stack, enabling organizations to monitor, analyze, and visualize their systems effectively.</p>
<p>Both tools, Prometheus and Grafana, are seamlessly deployed via a Helm chart. The crucial interconnection between Grafana and Prometheus is thoughtfully established within the Grafana Helm chart, ensuring a cohesive and comprehensive monitoring solution.</p>
<div id="prometheus" class="section level4 hasAnchor" number="8.3.5.1">
<h4><span class="header-section-number">8.3.5.1</span> Prometheus<a href="components.html#prometheus" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The provided Terraform code facilitates the deployment of Prometheus and Prometheus Operator Custom Resource Definitions (CRDs) for the ML platform dashboard. This deployment leverages Helm for efficient management, allowing for customizable configurations and streamlined monitoring and alerting system setup.</p>
<p>The process begins with the definition of a Helm release named <code>"prometheus"</code> responsible for deploying Prometheus, a comprehensive monitoring and alerting toolkit, to the specified Kubernetes namespace. The Helm chart utilized for this deployment is sourced from the Prometheus community Helm charts repository, adhering to a specified version.</p>
<p>Within the <code>"values"</code> block, you’ll find a YAML-encoded configuration for Prometheus. This configuration tailors specific aspects of the Prometheus installation, including the option to disable Alertmanager and Prometheus Pushgateway components. It also provides the flexibility to enable or disable persistent volumes for the Prometheus server.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb155-1"><a href="components.html#cb155-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;prometheus&quot;</span> {</span>
<span id="cb155-2"><a href="components.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  chart            <span class="op">=</span> <span class="st">&quot;prometheus&quot;</span></span>
<span id="cb155-3"><a href="components.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="st">&quot;prometheus&quot;</span></span>
<span id="cb155-4"><a href="components.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb155-5"><a href="components.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb155-6"><a href="components.html#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="components.html#cb155-7" aria-hidden="true" tabindex="-1"></a>  repository <span class="op">=</span> <span class="st">&quot;https://prometheus-community.github.io/helm-charts&quot;</span></span>
<span id="cb155-8"><a href="components.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  version    <span class="op">=</span> <span class="st">&quot;19.7.2&quot;</span></span>
<span id="cb155-9"><a href="components.html#cb155-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-10"><a href="components.html#cb155-10" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [</span>
<span id="cb155-11"><a href="components.html#cb155-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">yamlencode</span>({</span>
<span id="cb155-12"><a href="components.html#cb155-12" aria-hidden="true" tabindex="-1"></a>      alertmanager <span class="op">=</span> {</span>
<span id="cb155-13"><a href="components.html#cb155-13" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb155-14"><a href="components.html#cb155-14" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb155-15"><a href="components.html#cb155-15" aria-hidden="true" tabindex="-1"></a>      prometheus<span class="op">-</span>pushgateway <span class="op">=</span> {</span>
<span id="cb155-16"><a href="components.html#cb155-16" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb155-17"><a href="components.html#cb155-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb155-18"><a href="components.html#cb155-18" aria-hidden="true" tabindex="-1"></a>      server <span class="op">=</span> {</span>
<span id="cb155-19"><a href="components.html#cb155-19" aria-hidden="true" tabindex="-1"></a>        persistentVolume <span class="op">=</span> {</span>
<span id="cb155-20"><a href="components.html#cb155-20" aria-hidden="true" tabindex="-1"></a>          enabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb155-21"><a href="components.html#cb155-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb155-22"><a href="components.html#cb155-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb155-23"><a href="components.html#cb155-23" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb155-24"><a href="components.html#cb155-24" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb155-25"><a href="components.html#cb155-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In addition to the Prometheus release, another Helm release named <code>"prometheus-operator-crds"</code> is established. This release is focused on deploying the Custom Resource Definitions (CRDs) essential for the Prometheus Operator. Similarly, the Helm chart used for this deployment originates from the Prometheus community Helm charts repository but at a distinct version.</p>
<p>The Prometheus Operator CRDs are essential for defining and managing Prometheus instances and associated resources within the Kubernetes cluster, ensuring effective monitoring and alerting for the ML platform dashboard.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb156-1"><a href="components.html#cb156-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;prometheus-operator-crds&quot;</span> {</span>
<span id="cb156-2"><a href="components.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  chart            <span class="op">=</span> <span class="st">&quot;prometheus-operator-crds&quot;</span></span>
<span id="cb156-3"><a href="components.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="st">&quot;prometheus-operator-crds&quot;</span></span>
<span id="cb156-4"><a href="components.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb156-5"><a href="components.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb156-6"><a href="components.html#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="components.html#cb156-7" aria-hidden="true" tabindex="-1"></a>  repository <span class="op">=</span> <span class="st">&quot;https://prometheus-community.github.io/helm-charts&quot;</span></span>
<span id="cb156-8"><a href="components.html#cb156-8" aria-hidden="true" tabindex="-1"></a>  version    <span class="op">=</span> <span class="st">&quot;5.1.0&quot;</span></span>
<span id="cb156-9"><a href="components.html#cb156-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="grafana" class="section level4 hasAnchor" number="8.3.5.2">
<h4><span class="header-section-number">8.3.5.2</span> Grafana<a href="components.html#grafana" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The provided Terraform code deploys Grafana, a dashboard and visualization platform, for an ML platform. The Grafana deployment is highly customized, with various settings and configurations.</p>
<p>A Helm release named <code>"grafana"</code> is defined, deploying Grafana to the specified Kubernetes namespace. It pulls the Grafana chart from the official Helm charts repository at version <code>"6.57.4."</code> The <code>"values"</code> block contains a YAML-encoded configuration for Grafana, including various settings related to service type, Ingress, data sources, dashboard providers, and more.</p>
<ul>
<li><strong>Service and Ingress Configuration</strong>: The Grafana service is configured to be of type <code>"ClusterIP"</code> and an Ingress resource is enabled for external access. Several annotations are added to the Ingress to customize how it interacts with the Kubernetes cluster, including specifying the hostname, scheme, healthcheck path, and other settings. The Ingress is set up to handle requests for the specified domain name and subdomain, allowing external access to Grafana.</li>
<li><strong>Data Sources Configuration</strong>: The configuration includes data source settings, specifically for Prometheus. It defines a data source named “Prometheus” with details like the type, URL, access mode, and setting it as the default data source. This configuration allows Grafana to retrieve metrics and data from Prometheus for visualization and dashboard creation.</li>
<li><strong>Dashboard Providers Configuration</strong>: Grafana’s dashboard providers are configured using a YAML block. It defines a default provider with options specifying the path to dashboards. This configuration enables Grafana to load dashboards from the specified path within the Grafana container.</li>
<li><strong>Dashboards Configuration</strong>: The code defines a set of dashboards and their configurations. Each dashboard is associated with a data source (in this case, Prometheus) and has various settings such as gnetId (unique identifier), revision, and data source. These configurations determine which data is displayed on each dashboard and how it is accessed.</li>
<li><strong>Grafana Configuration (grafana.ini)</strong>: This section provides a set of configurations for Grafana itself, including security settings that allow embedding Grafana in iframes. It specifies the server’s domain and root URL, enabling Grafana to serve from a subpath. Additionally, GitHub authentication is enabled for user sign-up and authentication, using the provided GitHub OAuth client ID and secret.</li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb157-1"><a href="components.html#cb157-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;grafana&quot;</span> {</span>
<span id="cb157-2"><a href="components.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  chart            <span class="op">=</span> <span class="st">&quot;grafana&quot;</span></span>
<span id="cb157-3"><a href="components.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="st">&quot;grafana&quot;</span></span>
<span id="cb157-4"><a href="components.html#cb157-4" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb157-5"><a href="components.html#cb157-5" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb157-6"><a href="components.html#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="components.html#cb157-7" aria-hidden="true" tabindex="-1"></a>  repository <span class="op">=</span> <span class="st">&quot;https://grafana.github.io/helm-charts/&quot;</span></span>
<span id="cb157-8"><a href="components.html#cb157-8" aria-hidden="true" tabindex="-1"></a>  version    <span class="op">=</span> <span class="st">&quot;6.57.4&quot;</span></span>
<span id="cb157-9"><a href="components.html#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="components.html#cb157-10" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [</span>
<span id="cb157-11"><a href="components.html#cb157-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">yamlencode</span>({</span>
<span id="cb157-12"><a href="components.html#cb157-12" aria-hidden="true" tabindex="-1"></a>      service <span class="op">=</span> {</span>
<span id="cb157-13"><a href="components.html#cb157-13" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb157-14"><a href="components.html#cb157-14" aria-hidden="true" tabindex="-1"></a>        type    <span class="op">=</span> <span class="st">&quot;ClusterIP&quot;</span></span>
<span id="cb157-15"><a href="components.html#cb157-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb157-16"><a href="components.html#cb157-16" aria-hidden="true" tabindex="-1"></a>      ingress <span class="op">=</span> {</span>
<span id="cb157-17"><a href="components.html#cb157-17" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb157-18"><a href="components.html#cb157-18" aria-hidden="true" tabindex="-1"></a>        annotations <span class="op">=</span> {</span>
<span id="cb157-19"><a href="components.html#cb157-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;external-dns.alpha.kubernetes.io/hostname&quot;</span>  <span class="op">=</span> <span class="st">&quot;${var.domain_name}&quot;</span><span class="op">,</span></span>
<span id="cb157-20"><a href="components.html#cb157-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/scheme&quot;</span>           <span class="op">=</span> <span class="st">&quot;internet-facing&quot;</span><span class="op">,</span></span>
<span id="cb157-21"><a href="components.html#cb157-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/target-type&quot;</span>      <span class="op">=</span> <span class="st">&quot;ip&quot;</span><span class="op">,</span></span>
<span id="cb157-22"><a href="components.html#cb157-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;kubernetes.io/ingress.class&quot;</span>                <span class="op">=</span> <span class="st">&quot;alb&quot;</span><span class="op">,</span></span>
<span id="cb157-23"><a href="components.html#cb157-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/group.name&quot;</span>       <span class="op">=</span> <span class="st">&quot;mlplatform&quot;</span><span class="op">,</span></span>
<span id="cb157-24"><a href="components.html#cb157-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;alb.ingress.kubernetes.io/healthcheck-path&quot;</span> <span class="op">=</span> <span class="st">&quot;/api/health&quot;</span></span>
<span id="cb157-25"><a href="components.html#cb157-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb157-26"><a href="components.html#cb157-26" aria-hidden="true" tabindex="-1"></a>        labels   <span class="op">=</span> {}</span>
<span id="cb157-27"><a href="components.html#cb157-27" aria-hidden="true" tabindex="-1"></a>        path     <span class="op">=</span> <span class="st">&quot;${var.domain_suffix}&quot;</span></span>
<span id="cb157-28"><a href="components.html#cb157-28" aria-hidden="true" tabindex="-1"></a>        pathType <span class="op">=</span> <span class="st">&quot;Prefix&quot;</span></span>
<span id="cb157-29"><a href="components.html#cb157-29" aria-hidden="true" tabindex="-1"></a>        hosts <span class="op">=</span> [</span>
<span id="cb157-30"><a href="components.html#cb157-30" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;${var.domain_name}&quot;</span><span class="op">,</span></span>
<span id="cb157-31"><a href="components.html#cb157-31" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;www.${var.domain_name}&quot;</span></span>
<span id="cb157-32"><a href="components.html#cb157-32" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb157-33"><a href="components.html#cb157-33" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb157-34"><a href="components.html#cb157-34" aria-hidden="true" tabindex="-1"></a>      datasources <span class="op">=</span> {</span>
<span id="cb157-35"><a href="components.html#cb157-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;datasources.yaml&quot;</span> <span class="op">=</span> {</span>
<span id="cb157-36"><a href="components.html#cb157-36" aria-hidden="true" tabindex="-1"></a>          apiVersion <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb157-37"><a href="components.html#cb157-37" aria-hidden="true" tabindex="-1"></a>          datasources <span class="op">=</span> [</span>
<span id="cb157-38"><a href="components.html#cb157-38" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb157-39"><a href="components.html#cb157-39" aria-hidden="true" tabindex="-1"></a>              name      <span class="op">=</span> <span class="st">&quot;Prometheus&quot;</span></span>
<span id="cb157-40"><a href="components.html#cb157-40" aria-hidden="true" tabindex="-1"></a>              type      <span class="op">=</span> <span class="st">&quot;prometheus&quot;</span></span>
<span id="cb157-41"><a href="components.html#cb157-41" aria-hidden="true" tabindex="-1"></a>              url       <span class="op">=</span> <span class="st">&quot;http://prometheus-server.${var.namespace}.svc.cluster.local&quot;</span></span>
<span id="cb157-42"><a href="components.html#cb157-42" aria-hidden="true" tabindex="-1"></a>              access    <span class="op">=</span> <span class="st">&quot;proxy&quot;</span></span>
<span id="cb157-43"><a href="components.html#cb157-43" aria-hidden="true" tabindex="-1"></a>              isDefault <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb157-44"><a href="components.html#cb157-44" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb157-45"><a href="components.html#cb157-45" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb157-46"><a href="components.html#cb157-46" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb157-47"><a href="components.html#cb157-47" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb157-48"><a href="components.html#cb157-48" aria-hidden="true" tabindex="-1"></a>      dashboardProviders <span class="op">=</span> {</span>
<span id="cb157-49"><a href="components.html#cb157-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;dashboardproviders.yaml&quot;</span> <span class="op">=</span> {</span>
<span id="cb157-50"><a href="components.html#cb157-50" aria-hidden="true" tabindex="-1"></a>          apiVersion <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb157-51"><a href="components.html#cb157-51" aria-hidden="true" tabindex="-1"></a>          providers <span class="op">=</span> [</span>
<span id="cb157-52"><a href="components.html#cb157-52" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb157-53"><a href="components.html#cb157-53" aria-hidden="true" tabindex="-1"></a>              name   <span class="op">=</span> <span class="st">&quot;&#39;default&#39;&quot;</span></span>
<span id="cb157-54"><a href="components.html#cb157-54" aria-hidden="true" tabindex="-1"></a>              orgId  <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb157-55"><a href="components.html#cb157-55" aria-hidden="true" tabindex="-1"></a>              folder <span class="op">=</span> <span class="st">&quot;&#39;&#39;&quot;</span></span>
<span id="cb157-56"><a href="components.html#cb157-56" aria-hidden="true" tabindex="-1"></a>              <span class="dt">type</span> <span class="op">:</span> <span class="st">&quot;file&quot;</span></span>
<span id="cb157-57"><a href="components.html#cb157-57" aria-hidden="true" tabindex="-1"></a>              <span class="dt">disableDeletion</span> <span class="op">:</span> <span class="kw">false</span></span>
<span id="cb157-58"><a href="components.html#cb157-58" aria-hidden="true" tabindex="-1"></a>              <span class="dt">editable</span> <span class="op">:</span> <span class="kw">true</span></span>
<span id="cb157-59"><a href="components.html#cb157-59" aria-hidden="true" tabindex="-1"></a>              options <span class="op">=</span> {</span>
<span id="cb157-60"><a href="components.html#cb157-60" aria-hidden="true" tabindex="-1"></a>                path <span class="op">=</span> <span class="st">&quot;/var/lib/grafana/dashboards/default&quot;</span></span>
<span id="cb157-61"><a href="components.html#cb157-61" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb157-62"><a href="components.html#cb157-62" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb157-63"><a href="components.html#cb157-63" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb157-64"><a href="components.html#cb157-64" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb157-65"><a href="components.html#cb157-65" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb157-66"><a href="components.html#cb157-66" aria-hidden="true" tabindex="-1"></a>      dashboards <span class="op">=</span> {</span>
<span id="cb157-67"><a href="components.html#cb157-67" aria-hidden="true" tabindex="-1"></a>        <span class="im">default</span> <span class="op">=</span> {</span>
<span id="cb157-68"><a href="components.html#cb157-68" aria-hidden="true" tabindex="-1"></a>          prometheus<span class="op">-</span>stats <span class="op">=</span> {</span>
<span id="cb157-69"><a href="components.html#cb157-69" aria-hidden="true" tabindex="-1"></a>            gnetId     <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb157-70"><a href="components.html#cb157-70" aria-hidden="true" tabindex="-1"></a>            revision   <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb157-71"><a href="components.html#cb157-71" aria-hidden="true" tabindex="-1"></a>            datasource <span class="op">=</span> <span class="st">&quot;Prometheus&quot;</span></span>
<span id="cb157-72"><a href="components.html#cb157-72" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb157-73"><a href="components.html#cb157-73" aria-hidden="true" tabindex="-1"></a>          prometheus<span class="op">-</span>stats<span class="op">-</span><span class="dv">2</span> <span class="op">=</span> {</span>
<span id="cb157-74"><a href="components.html#cb157-74" aria-hidden="true" tabindex="-1"></a>            gnetId     <span class="op">=</span> <span class="dv">315</span></span>
<span id="cb157-75"><a href="components.html#cb157-75" aria-hidden="true" tabindex="-1"></a>            datasource <span class="op">=</span> <span class="st">&quot;Prometheus&quot;</span></span>
<span id="cb157-76"><a href="components.html#cb157-76" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb157-77"><a href="components.html#cb157-77" aria-hidden="true" tabindex="-1"></a>          k8s<span class="op">-</span>cluster <span class="op">=</span> {</span>
<span id="cb157-78"><a href="components.html#cb157-78" aria-hidden="true" tabindex="-1"></a>            gnetId     <span class="op">=</span> <span class="dv">6417</span></span>
<span id="cb157-79"><a href="components.html#cb157-79" aria-hidden="true" tabindex="-1"></a>            datasource <span class="op">=</span> <span class="st">&quot;Prometheus&quot;</span></span>
<span id="cb157-80"><a href="components.html#cb157-80" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb157-81"><a href="components.html#cb157-81" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb157-82"><a href="components.html#cb157-82" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb157-83"><a href="components.html#cb157-83" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;grafana.ini&quot;</span> <span class="op">=</span> {</span>
<span id="cb157-84"><a href="components.html#cb157-84" aria-hidden="true" tabindex="-1"></a>        security <span class="op">=</span> {</span>
<span id="cb157-85"><a href="components.html#cb157-85" aria-hidden="true" tabindex="-1"></a>          allow_embedding <span class="op">=</span> <span class="kw">true</span> # enables iframe loading</span>
<span id="cb157-86"><a href="components.html#cb157-86" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb157-87"><a href="components.html#cb157-87" aria-hidden="true" tabindex="-1"></a>        server <span class="op">=</span> {</span>
<span id="cb157-88"><a href="components.html#cb157-88" aria-hidden="true" tabindex="-1"></a>          <span class="dt">domain</span> <span class="op">:</span> <span class="st">&quot;${var.domain_name}&quot;</span></span>
<span id="cb157-89"><a href="components.html#cb157-89" aria-hidden="true" tabindex="-1"></a>          <span class="dt">root_url</span> <span class="op">:</span> <span class="st">&quot;%(protocol)s://%(domain)s/grafana/&quot;</span></span>
<span id="cb157-90"><a href="components.html#cb157-90" aria-hidden="true" tabindex="-1"></a>          <span class="dt">serve_from_sub_path</span> <span class="op">:</span> <span class="kw">true</span></span>
<span id="cb157-91"><a href="components.html#cb157-91" aria-hidden="true" tabindex="-1"></a>          # <span class="dt">https</span><span class="op">:</span><span class="co">//grafana.com/docs/grafana/latest/auth/github/#enable-github-in-grafana</span></span>
<span id="cb157-92"><a href="components.html#cb157-92" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb157-93"><a href="components.html#cb157-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;auth.github&quot;</span> <span class="op">=</span> {</span>
<span id="cb157-94"><a href="components.html#cb157-94" aria-hidden="true" tabindex="-1"></a>          enabled       <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb157-95"><a href="components.html#cb157-95" aria-hidden="true" tabindex="-1"></a>          allow_sign_up <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb157-96"><a href="components.html#cb157-96" aria-hidden="true" tabindex="-1"></a>          scopes        <span class="op">=</span> <span class="st">&quot;user:email,read:org&quot;</span></span>
<span id="cb157-97"><a href="components.html#cb157-97" aria-hidden="true" tabindex="-1"></a>          auth_url      <span class="op">=</span> <span class="st">&quot;https://github.com/login/oauth/authorize&quot;</span></span>
<span id="cb157-98"><a href="components.html#cb157-98" aria-hidden="true" tabindex="-1"></a>          token_url     <span class="op">=</span> <span class="st">&quot;https://github.com/login/oauth/access_token&quot;</span></span>
<span id="cb157-99"><a href="components.html#cb157-99" aria-hidden="true" tabindex="-1"></a>          api_url       <span class="op">=</span> <span class="st">&quot;https://api.github.com/user&quot;</span></span>
<span id="cb157-100"><a href="components.html#cb157-100" aria-hidden="true" tabindex="-1"></a>          # <span class="dt">team_ids</span><span class="op">:</span> grafana<span class="op">-</span>user<span class="op">-</span>team</span>
<span id="cb157-101"><a href="components.html#cb157-101" aria-hidden="true" tabindex="-1"></a>          # <span class="dt">allowed_organizations</span><span class="op">:</span></span>
<span id="cb157-102"><a href="components.html#cb157-102" aria-hidden="true" tabindex="-1"></a>          client_id     <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_client_id</span></span>
<span id="cb157-103"><a href="components.html#cb157-103" aria-hidden="true" tabindex="-1"></a>          client_secret <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">git_client_secret</span></span>
<span id="cb157-104"><a href="components.html#cb157-104" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb157-105"><a href="components.html#cb157-105" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb157-106"><a href="components.html#cb157-106" aria-hidden="true" tabindex="-1"></a>  })]</span>
<span id="cb157-107"><a href="components.html#cb157-107" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
<div id="sagemaker" class="section level3 hasAnchor" number="8.3.6">
<h3><span class="header-section-number">8.3.6</span> Sagemaker<a href="components.html#sagemaker" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Sagemaker module serves as a vital component of the ML platform, ensuring seamless interaction with SageMaker by providing essential IAM roles and permissions. Additionally, it deploys a custom Helm chart designed to harness the capabilities of a straightforward Streamlit application, effectively presenting all deployed SageMaker endpoints.</p>
<p>The Terraform code commences by establishing local variables, meticulously capturing a spectrum of configuration details pivotal for this deployment. These variables encompass crucial information such as Docker image specifics, ECR repository nomenclature, IAM role designations, and more. The judicious utilization of these variables throughout the code enhances both consistency and reusability.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb158-1"><a href="components.html#cb158-1" aria-hidden="true" tabindex="-1"></a>locals {</span>
<span id="cb158-2"><a href="components.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  docker_mlflow_sagemaker_base_image <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">docker_mlflow_sagemaker_base_image</span></span>
<span id="cb158-3"><a href="components.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  base_image_tag                     <span class="op">=</span> <span class="fu">split</span>(<span class="st">&quot;:&quot;</span><span class="op">,</span> <span class="kw">var</span><span class="op">.</span><span class="at">docker_mlflow_sagemaker_base_image</span>)[<span class="dv">1</span>]</span>
<span id="cb158-4"><a href="components.html#cb158-4" aria-hidden="true" tabindex="-1"></a>  ecr_repository_name                <span class="op">=</span> <span class="st">&quot;mlflow-sagemaker-deployment&quot;</span></span>
<span id="cb158-5"><a href="components.html#cb158-5" aria-hidden="true" tabindex="-1"></a>  iam_name_sagemaker_access          <span class="op">=</span> <span class="st">&quot;sagemaker-access&quot;</span></span>
<span id="cb158-6"><a href="components.html#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="components.html#cb158-7" aria-hidden="true" tabindex="-1"></a>  sagemaker_dashboard_read_access_user_name <span class="op">=</span> <span class="st">&quot;sagemaker-dashboard-read-access-user&quot;</span></span>
<span id="cb158-8"><a href="components.html#cb158-8" aria-hidden="true" tabindex="-1"></a>  sagemaker_dashboard_read_access_role_name <span class="op">=</span> <span class="st">&quot;sagemaker-dashboard-read-access-role&quot;</span></span>
<span id="cb158-9"><a href="components.html#cb158-9" aria-hidden="true" tabindex="-1"></a>  sagemaker_dashboard_read_access_secret    <span class="op">=</span> <span class="st">&quot;sagemaker-dashboard-read-access-secret&quot;</span></span>
<span id="cb158-10"><a href="components.html#cb158-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-11"><a href="components.html#cb158-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-12"><a href="components.html#cb158-12" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_caller_identity&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb158-13"><a href="components.html#cb158-13" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_region&quot;</span> <span class="st">&quot;current&quot;</span> {}</span>
<span id="cb158-14"><a href="components.html#cb158-14" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_iam_policy&quot;</span> <span class="st">&quot;AmazonSageMakerFullAccess&quot;</span> {</span>
<span id="cb158-15"><a href="components.html#cb158-15" aria-hidden="true" tabindex="-1"></a>  arn <span class="op">=</span> <span class="st">&quot;arn:aws:iam::aws:policy/AmazonSageMakerFullAccess&quot;</span></span>
<span id="cb158-16"><a href="components.html#cb158-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-17"><a href="components.html#cb158-17" aria-hidden="true" tabindex="-1"></a>data <span class="st">&quot;aws_iam_policy&quot;</span> <span class="st">&quot;AmazonSageMakerReadOnlyAccess&quot;</span> {</span>
<span id="cb158-18"><a href="components.html#cb158-18" aria-hidden="true" tabindex="-1"></a>  arn <span class="op">=</span> <span class="st">&quot;arn:aws:iam::aws:policy/AmazonSageMakerReadOnly&quot;</span></span>
<span id="cb158-19"><a href="components.html#cb158-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The code efficiently leverages the <code>"terraform-aws-modules/ecr/aws"</code> module, effectively birthing an Elastic Container Registry (ECR) repository christened as <code>"mlflow-sagemaker-deployment"</code>. Furthermore, a <code>"null_resource"</code> block is meticulously crafted to orchestrate the packaging and dissemination of a Docker image to the ECR repository. This resource leverages a local-exec provisioner, deftly executing a series of Docker commands. These commands encompass the retrieval of the base image, affixing it with the ECR repository URL, securing authentication to the ECR registry, and ultimately, the seamless transmission of the image. This strategic orchestration guarantees the availability of the MLflow base image, purpose-built for SageMaker deployments, within the ECR repository, ready for deployment when needed.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb159-1"><a href="components.html#cb159-1" aria-hidden="true" tabindex="-1"></a># Create Container Registry</span>
<span id="cb159-2"><a href="components.html#cb159-2" aria-hidden="true" tabindex="-1"></a>module <span class="st">&quot;ecr&quot;</span> {</span>
<span id="cb159-3"><a href="components.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  source          <span class="op">=</span> <span class="st">&quot;terraform-aws-modules/ecr/aws&quot;</span></span>
<span id="cb159-4"><a href="components.html#cb159-4" aria-hidden="true" tabindex="-1"></a>  repository_name <span class="op">=</span> local<span class="op">.</span><span class="at">ecr_repository_name</span></span>
<span id="cb159-5"><a href="components.html#cb159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-6"><a href="components.html#cb159-6" aria-hidden="true" tabindex="-1"></a>  repository_lifecycle_policy <span class="op">=</span> <span class="fu">jsonencode</span>({</span>
<span id="cb159-7"><a href="components.html#cb159-7" aria-hidden="true" tabindex="-1"></a>    rules <span class="op">=</span> [</span>
<span id="cb159-8"><a href="components.html#cb159-8" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb159-9"><a href="components.html#cb159-9" aria-hidden="true" tabindex="-1"></a>        rulePriority <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb159-10"><a href="components.html#cb159-10" aria-hidden="true" tabindex="-1"></a>        description  <span class="op">=</span> <span class="st">&quot;Keep last 30 images&quot;</span><span class="op">,</span></span>
<span id="cb159-11"><a href="components.html#cb159-11" aria-hidden="true" tabindex="-1"></a>        selection <span class="op">=</span> {</span>
<span id="cb159-12"><a href="components.html#cb159-12" aria-hidden="true" tabindex="-1"></a>          tagStatus     <span class="op">=</span> <span class="st">&quot;tagged&quot;</span><span class="op">,</span></span>
<span id="cb159-13"><a href="components.html#cb159-13" aria-hidden="true" tabindex="-1"></a>          tagPrefixList <span class="op">=</span> [<span class="st">&quot;v&quot;</span>]<span class="op">,</span></span>
<span id="cb159-14"><a href="components.html#cb159-14" aria-hidden="true" tabindex="-1"></a>          countType     <span class="op">=</span> <span class="st">&quot;imageCountMoreThan&quot;</span><span class="op">,</span></span>
<span id="cb159-15"><a href="components.html#cb159-15" aria-hidden="true" tabindex="-1"></a>          countNumber   <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb159-16"><a href="components.html#cb159-16" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb159-17"><a href="components.html#cb159-17" aria-hidden="true" tabindex="-1"></a>        action <span class="op">=</span> {</span>
<span id="cb159-18"><a href="components.html#cb159-18" aria-hidden="true" tabindex="-1"></a>          type <span class="op">=</span> <span class="st">&quot;expire&quot;</span></span>
<span id="cb159-19"><a href="components.html#cb159-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb159-20"><a href="components.html#cb159-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb159-21"><a href="components.html#cb159-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb159-22"><a href="components.html#cb159-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb159-23"><a href="components.html#cb159-23" aria-hidden="true" tabindex="-1"></a>  repository_force_delete <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb159-24"><a href="components.html#cb159-24" aria-hidden="true" tabindex="-1"></a>  # tags <span class="op">=</span> {</span>
<span id="cb159-25"><a href="components.html#cb159-25" aria-hidden="true" tabindex="-1"></a>  #   Terraform   <span class="op">=</span> <span class="st">&quot;true&quot;</span></span>
<span id="cb159-26"><a href="components.html#cb159-26" aria-hidden="true" tabindex="-1"></a>  #   Environment <span class="op">=</span> <span class="st">&quot;dev&quot;</span></span>
<span id="cb159-27"><a href="components.html#cb159-27" aria-hidden="true" tabindex="-1"></a>  # }</span>
<span id="cb159-28"><a href="components.html#cb159-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-29"><a href="components.html#cb159-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-30"><a href="components.html#cb159-30" aria-hidden="true" tabindex="-1"></a># mlflow sagemaker build<span class="op">-</span>and<span class="op">-</span>push<span class="op">-</span>container <span class="op">--</span>build <span class="op">--</span>no<span class="op">-</span>push <span class="op">-</span>c mlflow<span class="op">-</span>sagemaker<span class="op">-</span>deployment</span>
<span id="cb159-31"><a href="components.html#cb159-31" aria-hidden="true" tabindex="-1"></a># https<span class="op">:</span><span class="co">//mlflow.org/docs/latest/cli.html</span></span>
<span id="cb159-32"><a href="components.html#cb159-32" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;null_resource&quot;</span> <span class="st">&quot;docker_packaging&quot;</span> {</span>
<span id="cb159-33"><a href="components.html#cb159-33" aria-hidden="true" tabindex="-1"></a>  provisioner <span class="st">&quot;local-exec&quot;</span> {</span>
<span id="cb159-34"><a href="components.html#cb159-34" aria-hidden="true" tabindex="-1"></a>    command <span class="op">=</span> <span class="op">&lt;&lt;</span>EOF</span>
<span id="cb159-35"><a href="components.html#cb159-35" aria-hidden="true" tabindex="-1"></a>        docker pull <span class="st">&quot;${local.docker_mlflow_sagemaker_base_image}&quot;</span></span>
<span id="cb159-36"><a href="components.html#cb159-36" aria-hidden="true" tabindex="-1"></a>      docker tag <span class="st">&quot;${local.docker_mlflow_sagemaker_base_image}&quot;</span> <span class="st">&quot;${module.ecr.repository_url}:${local.base_image_tag}&quot;</span></span>
<span id="cb159-37"><a href="components.html#cb159-37" aria-hidden="true" tabindex="-1"></a>      aws ecr get<span class="op">-</span>login<span class="op">-</span>password <span class="op">--</span>region ${data<span class="op">.</span><span class="at">aws_region</span><span class="op">.</span><span class="at">current</span><span class="op">.</span><span class="at">name</span>} <span class="op">|</span> docker login <span class="op">--</span>username AWS <span class="op">--</span>password<span class="op">-</span>stdin ${data<span class="op">.</span><span class="at">aws_caller_identity</span><span class="op">.</span><span class="at">current</span><span class="op">.</span><span class="at">account_id</span>}<span class="op">.</span><span class="at">dkr</span><span class="op">.</span><span class="at">ecr</span><span class="op">.</span><span class="at">$</span>{data<span class="op">.</span><span class="at">aws_region</span><span class="op">.</span><span class="at">current</span><span class="op">.</span><span class="at">name</span>}<span class="op">.</span><span class="at">amazonaws</span><span class="op">.</span><span class="at">com</span></span>
<span id="cb159-38"><a href="components.html#cb159-38" aria-hidden="true" tabindex="-1"></a>        docker push <span class="st">&quot;${module.ecr.repository_url}:${local.base_image_tag}&quot;</span></span>
<span id="cb159-39"><a href="components.html#cb159-39" aria-hidden="true" tabindex="-1"></a>        EOF</span>
<span id="cb159-40"><a href="components.html#cb159-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-41"><a href="components.html#cb159-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-42"><a href="components.html#cb159-42" aria-hidden="true" tabindex="-1"></a>  # triggers <span class="op">=</span> {</span>
<span id="cb159-43"><a href="components.html#cb159-43" aria-hidden="true" tabindex="-1"></a>  #   <span class="st">&quot;run_at&quot;</span> <span class="op">=</span> <span class="fu">timestamp</span>()</span>
<span id="cb159-44"><a href="components.html#cb159-44" aria-hidden="true" tabindex="-1"></a>  # }</span>
<span id="cb159-45"><a href="components.html#cb159-45" aria-hidden="true" tabindex="-1"></a>  depends_on <span class="op">=</span> [</span>
<span id="cb159-46"><a href="components.html#cb159-46" aria-hidden="true" tabindex="-1"></a>    module<span class="op">.</span><span class="at">ecr</span><span class="op">,</span></span>
<span id="cb159-47"><a href="components.html#cb159-47" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb159-48"><a href="components.html#cb159-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-49"><a href="components.html#cb159-49" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<p>Moreover, the Terraform module assumes responsibility for the creation of an IAM role christened as <code>"sagemaker_access_role"</code>. This role plays a pivotal role, enabling SageMaker to assume its authority for requisite access. The trust policy governing this role stipulates SageMaker’s unequivocal authority to assume it. Notably, the code adjoins the <code>"AmazonSageMakerFullAccess"</code> IAM policy to the <code>"sagemaker_access_role"</code>, conferring comprehensive access rights to SageMaker resources. Parallel to the MLflow SageMaker base image residing within ECR, the <code>"sagemaker_access_role"</code> becomes an indispensable component, facilitating MLflow’s deployments to AWS SageMaker.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb160-1"><a href="components.html#cb160-1" aria-hidden="true" tabindex="-1"></a># Access role to allow access to Sagemaker</span>
<span id="cb160-2"><a href="components.html#cb160-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role&quot;</span> <span class="st">&quot;sagemaker_access_role&quot;</span> {</span>
<span id="cb160-3"><a href="components.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  name                 <span class="op">=</span> <span class="st">&quot;${local.iam_name_sagemaker_access}-role&quot;</span></span>
<span id="cb160-4"><a href="components.html#cb160-4" aria-hidden="true" tabindex="-1"></a>  max_session_duration <span class="op">=</span> <span class="dv">28800</span></span>
<span id="cb160-5"><a href="components.html#cb160-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-6"><a href="components.html#cb160-6" aria-hidden="true" tabindex="-1"></a>  assume_role_policy <span class="op">=</span> <span class="op">&lt;&lt;</span>EOF</span>
<span id="cb160-7"><a href="components.html#cb160-7" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb160-8"><a href="components.html#cb160-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Version&quot;</span><span class="op">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="op">,</span></span>
<span id="cb160-9"><a href="components.html#cb160-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Statement&quot;</span><span class="op">:</span> [</span>
<span id="cb160-10"><a href="components.html#cb160-10" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb160-11"><a href="components.html#cb160-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Sid&quot;</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb160-12"><a href="components.html#cb160-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Effect&quot;</span><span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb160-13"><a href="components.html#cb160-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Principal&quot;</span><span class="op">:</span> {</span>
<span id="cb160-14"><a href="components.html#cb160-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Service&quot;</span><span class="op">:</span> <span class="st">&quot;sagemaker.amazonaws.com&quot;</span></span>
<span id="cb160-15"><a href="components.html#cb160-15" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb160-16"><a href="components.html#cb160-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Action&quot;</span><span class="op">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></span>
<span id="cb160-17"><a href="components.html#cb160-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb160-18"><a href="components.html#cb160-18" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb160-19"><a href="components.html#cb160-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-20"><a href="components.html#cb160-20" aria-hidden="true" tabindex="-1"></a>  EOF</span>
<span id="cb160-21"><a href="components.html#cb160-21" aria-hidden="true" tabindex="-1"></a>  # tags <span class="op">=</span> {</span>
<span id="cb160-22"><a href="components.html#cb160-22" aria-hidden="true" tabindex="-1"></a>  #   tag<span class="op">-</span>key <span class="op">=</span> <span class="st">&quot;tag-value&quot;</span></span>
<span id="cb160-23"><a href="components.html#cb160-23" aria-hidden="true" tabindex="-1"></a>  # }</span>
<span id="cb160-24"><a href="components.html#cb160-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb160-25"><a href="components.html#cb160-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-26"><a href="components.html#cb160-26" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role_policy_attachment&quot;</span> <span class="st">&quot;sagemaker_access_role_policy&quot;</span> {</span>
<span id="cb160-27"><a href="components.html#cb160-27" aria-hidden="true" tabindex="-1"></a>  role       <span class="op">=</span> aws_iam_role<span class="op">.</span><span class="at">sagemaker_access_role</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb160-28"><a href="components.html#cb160-28" aria-hidden="true" tabindex="-1"></a>  policy_arn <span class="op">=</span> data<span class="op">.</span><span class="at">aws_iam_policy</span><span class="op">.</span><span class="at">AmazonSageMakerFullAccess</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb160-29"><a href="components.html#cb160-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In the final orchestration, the ML platform’s Sagemaker Dashboard materializes through the medium of Helm. The deployment specifications encompass critical parameters, encompassing the Docker image identity, deployment nomenclature, namespace delineation, Ingress configuration tailored for efficient routing of external traffic, and essential secrets mandatorily required for authentication. Notably, the deployment relies on the Docker image bearing the label <code>"seblum/streamlit-sagemaker-app:v1.0.0"</code>, which serves as the engine propelling the Streamlit application. For those seeking deeper insights, the inner workings of this Docker image are meticulously documented <a href="https://github.com/seblum/streamlit-sagemaker-app">here</a>.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb161-1"><a href="components.html#cb161-1" aria-hidden="true" tabindex="-1"></a># Helm Deployment</span>
<span id="cb161-2"><a href="components.html#cb161-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;sagemaker-dashboard&quot;</span> {</span>
<span id="cb161-3"><a href="components.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb161-4"><a href="components.html#cb161-4" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb161-5"><a href="components.html#cb161-5" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb161-6"><a href="components.html#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="components.html#cb161-7" aria-hidden="true" tabindex="-1"></a>  chart <span class="op">=</span> <span class="st">&quot;${path.module}/helm/&quot;</span></span>
<span id="cb161-8"><a href="components.html#cb161-8" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [<span class="fu">yamlencode</span>({</span>
<span id="cb161-9"><a href="components.html#cb161-9" aria-hidden="true" tabindex="-1"></a>    deployment <span class="op">=</span> {</span>
<span id="cb161-10"><a href="components.html#cb161-10" aria-hidden="true" tabindex="-1"></a>      image     <span class="op">=</span> <span class="st">&quot;seblum/streamlit-sagemaker-app:v1.0.0&quot;</span><span class="op">,</span></span>
<span id="cb161-11"><a href="components.html#cb161-11" aria-hidden="true" tabindex="-1"></a>      name      <span class="op">=</span> <span class="st">&quot;sagemaker-streamlit&quot;</span><span class="op">,</span></span>
<span id="cb161-12"><a href="components.html#cb161-12" aria-hidden="true" tabindex="-1"></a>      namespace <span class="op">=</span> <span class="st">&quot;${var.namespace}&quot;</span></span>
<span id="cb161-13"><a href="components.html#cb161-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb161-14"><a href="components.html#cb161-14" aria-hidden="true" tabindex="-1"></a>    ingress <span class="op">=</span> {</span>
<span id="cb161-15"><a href="components.html#cb161-15" aria-hidden="true" tabindex="-1"></a>      host <span class="op">=</span> <span class="st">&quot;${var.domain_name}&quot;</span></span>
<span id="cb161-16"><a href="components.html#cb161-16" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> <span class="st">&quot;${var.domain_suffix}&quot;</span></span>
<span id="cb161-17"><a href="components.html#cb161-17" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb161-18"><a href="components.html#cb161-18" aria-hidden="true" tabindex="-1"></a>    secret <span class="op">=</span> {</span>
<span id="cb161-19"><a href="components.html#cb161-19" aria-hidden="true" tabindex="-1"></a>      aws_region            <span class="op">=</span> <span class="st">&quot;${data.aws_region.current.name}&quot;</span></span>
<span id="cb161-20"><a href="components.html#cb161-20" aria-hidden="true" tabindex="-1"></a>      aws_access_key_id     <span class="op">=</span> <span class="st">&quot;${aws_iam_access_key.sagemaker_dashboard_read_access_user_credentials.id}&quot;</span></span>
<span id="cb161-21"><a href="components.html#cb161-21" aria-hidden="true" tabindex="-1"></a>      aws_secret_access_key <span class="op">=</span> <span class="st">&quot;${aws_iam_access_key.sagemaker_dashboard_read_access_user_credentials.secret}&quot;</span></span>
<span id="cb161-22"><a href="components.html#cb161-22" aria-hidden="true" tabindex="-1"></a>      aws_role_name         <span class="op">=</span> <span class="st">&quot;${aws_iam_role.sagemaker_dashboard_read_access_role.name}&quot;</span></span>
<span id="cb161-23"><a href="components.html#cb161-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb161-24"><a href="components.html#cb161-24" aria-hidden="true" tabindex="-1"></a>  })]</span>
<span id="cb161-25"><a href="components.html#cb161-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In tandem with this deployment, an additional IAM role christened as <code>"sagemaker_dashboard_read_access_role"</code> takes center stage, conferring access rights to SageMaker resources. The trust policy associated with this role casts a discerning gaze, specifying the entities deemed eligible to assume its authority. Among the authorized entities are the SageMaker user and the SageMaker dashboard read-access user. To further bolster the role’s capabilities, it is graced with the <code>"AmazonSageMakerReadOnlyAccess"</code> IAM policy, gracefully endowing it with read-only access privileges to SageMaker resources. Concomitantly, an IAM user, christened as <code>"sagemaker_dashboard_read_access_user,"</code> is ushered into existence, complete with an associated access key. This user is purpose-built for interfacing with SageMaker resources, playing a pivotal role in accessing SageMaker endpoints and seamlessly presenting them within the Streamlit application.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb162-1"><a href="components.html#cb162-1" aria-hidden="true" tabindex="-1"></a># Access role to allow access to Sagemaker</span>
<span id="cb162-2"><a href="components.html#cb162-2" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role&quot;</span> <span class="st">&quot;sagemaker_dashboard_read_access_role&quot;</span> {</span>
<span id="cb162-3"><a href="components.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  name                 <span class="op">=</span> local<span class="op">.</span><span class="at">sagemaker_dashboard_read_access_role_name</span></span>
<span id="cb162-4"><a href="components.html#cb162-4" aria-hidden="true" tabindex="-1"></a>  max_session_duration <span class="op">=</span> <span class="dv">28800</span></span>
<span id="cb162-5"><a href="components.html#cb162-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-6"><a href="components.html#cb162-6" aria-hidden="true" tabindex="-1"></a>  assume_role_policy <span class="op">=</span> <span class="op">&lt;&lt;</span>EOF</span>
<span id="cb162-7"><a href="components.html#cb162-7" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb162-8"><a href="components.html#cb162-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Version&quot;</span><span class="op">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="op">,</span></span>
<span id="cb162-9"><a href="components.html#cb162-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Statement&quot;</span><span class="op">:</span> [</span>
<span id="cb162-10"><a href="components.html#cb162-10" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb162-11"><a href="components.html#cb162-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Effect&quot;</span><span class="op">:</span> <span class="st">&quot;Allow&quot;</span><span class="op">,</span></span>
<span id="cb162-12"><a href="components.html#cb162-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Principal&quot;</span><span class="op">:</span> {</span>
<span id="cb162-13"><a href="components.html#cb162-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;AWS&quot;</span><span class="op">:</span> <span class="st">&quot;arn:aws:iam::${data.aws_caller_identity.current.account_id}:user/${aws_iam_user.sagemaker_dashboard_read_access_user.name}&quot;</span></span>
<span id="cb162-14"><a href="components.html#cb162-14" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb162-15"><a href="components.html#cb162-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Action&quot;</span><span class="op">:</span> <span class="st">&quot;sts:AssumeRole&quot;</span></span>
<span id="cb162-16"><a href="components.html#cb162-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb162-17"><a href="components.html#cb162-17" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb162-18"><a href="components.html#cb162-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-19"><a href="components.html#cb162-19" aria-hidden="true" tabindex="-1"></a>  EOF</span>
<span id="cb162-20"><a href="components.html#cb162-20" aria-hidden="true" tabindex="-1"></a>  # tags <span class="op">=</span> {</span>
<span id="cb162-21"><a href="components.html#cb162-21" aria-hidden="true" tabindex="-1"></a>  #   tag<span class="op">-</span>key <span class="op">=</span> <span class="st">&quot;tag-value&quot;</span></span>
<span id="cb162-22"><a href="components.html#cb162-22" aria-hidden="true" tabindex="-1"></a>  # }</span>
<span id="cb162-23"><a href="components.html#cb162-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-24"><a href="components.html#cb162-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-25"><a href="components.html#cb162-25" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_role_policy_attachment&quot;</span> <span class="st">&quot;sagemaker_dashboard_read__access_role_policy&quot;</span> {</span>
<span id="cb162-26"><a href="components.html#cb162-26" aria-hidden="true" tabindex="-1"></a>  role       <span class="op">=</span> aws_iam_role<span class="op">.</span><span class="at">sagemaker_dashboard_read_access_role</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb162-27"><a href="components.html#cb162-27" aria-hidden="true" tabindex="-1"></a>  policy_arn <span class="op">=</span> data<span class="op">.</span><span class="at">aws_iam_policy</span><span class="op">.</span><span class="at">AmazonSageMakerReadOnlyAccess</span><span class="op">.</span><span class="at">arn</span></span>
<span id="cb162-28"><a href="components.html#cb162-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-29"><a href="components.html#cb162-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-30"><a href="components.html#cb162-30" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_user&quot;</span> <span class="st">&quot;sagemaker_dashboard_read_access_user&quot;</span> {</span>
<span id="cb162-31"><a href="components.html#cb162-31" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> local<span class="op">.</span><span class="at">sagemaker_dashboard_read_access_user_name</span></span>
<span id="cb162-32"><a href="components.html#cb162-32" aria-hidden="true" tabindex="-1"></a>  path <span class="op">=</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb162-33"><a href="components.html#cb162-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-34"><a href="components.html#cb162-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-35"><a href="components.html#cb162-35" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;aws_iam_access_key&quot;</span> <span class="st">&quot;sagemaker_dashboard_read_access_user_credentials&quot;</span> {</span>
<span id="cb162-36"><a href="components.html#cb162-36" aria-hidden="true" tabindex="-1"></a>  user <span class="op">=</span> aws_iam_user<span class="op">.</span><span class="at">sagemaker_dashboard_read_access_user</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb162-37"><a href="components.html#cb162-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
<div id="dashboard" class="section level3 hasAnchor" number="8.3.7">
<h3><span class="header-section-number">8.3.7</span> Dashboard<a href="components.html#dashboard" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Dashboard module leverages Terraform and Helm to deploy a custom Vue.js-based dashboard for an ML platform.</p>
<p>This deployment is accomplished through the definition of a <code>"helm_release"</code> resource. A custom Helm chart, akin to the mlflow deployment, takes center stage. This Helm chart is expected to reside in a directory nested within the Terraform module, conveniently defined as <code>"${path.module}/helm/"</code>. The configuration for this deployment encompasses critical parameters pivotal to the successful deployment of the dashboard. Notably, it specifies the utilization of a bespoke Docker image, bearing the tag <code>"seblum/vuejs-ml-dashboard:latest"</code>, meticulously tailored for this specific deployment. Moreover, the deployment name and namespace exhibit dynamic characteristics, rendering the code adaptable to diverse environments and specific requirements.</p>
<p>A main aspect of the code revolves around the configuration of an Ingress resource, designed to efficiently route external traffic to the dashboard. This resource employs the <code>"var.domain_name"</code> variable to determine the host value, which can signify the domain or subdomain intricately linked to the dashboard. Furthermore, the <code>"path"</code> parameter derives its value from the <code>"var.domain_suffix"</code> variable, delineating the path through which users can access the ML platform’s dashboard. In essence, this Terraform code exemplifies an indispensable tool, enabling the consistent and streamlined deployment and management of the ML dashboard within the Kubernetes environment.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb163-1"><a href="components.html#cb163-1" aria-hidden="true" tabindex="-1"></a>resource <span class="st">&quot;helm_release&quot;</span> <span class="st">&quot;dashboard&quot;</span> {</span>
<span id="cb163-2"><a href="components.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  name             <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb163-3"><a href="components.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  namespace        <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb163-4"><a href="components.html#cb163-4" aria-hidden="true" tabindex="-1"></a>  create_namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">create_namespace</span></span>
<span id="cb163-5"><a href="components.html#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="components.html#cb163-6" aria-hidden="true" tabindex="-1"></a>  chart <span class="op">=</span> <span class="st">&quot;${path.module}/helm/&quot;</span></span>
<span id="cb163-7"><a href="components.html#cb163-7" aria-hidden="true" tabindex="-1"></a>  values <span class="op">=</span> [<span class="fu">yamlencode</span>({</span>
<span id="cb163-8"><a href="components.html#cb163-8" aria-hidden="true" tabindex="-1"></a>    deployment <span class="op">=</span> {</span>
<span id="cb163-9"><a href="components.html#cb163-9" aria-hidden="true" tabindex="-1"></a>      image     <span class="op">=</span> <span class="st">&quot;seblum/vuejs-ml-dashboard:latest&quot;</span></span>
<span id="cb163-10"><a href="components.html#cb163-10" aria-hidden="true" tabindex="-1"></a>      name      <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb163-11"><a href="components.html#cb163-11" aria-hidden="true" tabindex="-1"></a>      namespace <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">namespace</span></span>
<span id="cb163-12"><a href="components.html#cb163-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb163-13"><a href="components.html#cb163-13" aria-hidden="true" tabindex="-1"></a>    ingress <span class="op">=</span> {</span>
<span id="cb163-14"><a href="components.html#cb163-14" aria-hidden="true" tabindex="-1"></a>      host <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">domain_name</span></span>
<span id="cb163-15"><a href="components.html#cb163-15" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> <span class="kw">var</span><span class="op">.</span><span class="at">domain_suffix</span></span>
<span id="cb163-16"><a href="components.html#cb163-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb163-17"><a href="components.html#cb163-17" aria-hidden="true" tabindex="-1"></a>  })]</span>
<span id="cb163-18"><a href="components.html#cb163-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>It’s worth noting that the Vue.js Dashboard, while underpinned by a free Vue.js template from <a href="https://www.creative-tim.com/product/vue-material-dashboard">Creative Tim</a>, has been thoughtfully customized to cater to the specific requirements of the ML platform. For an in-depth exploration of Vue.js, the reader is encouraged to explore external resources, as it falls outside the scope of this documentation. Nevertheless, the complete Vue.js dashboard application is readily accessible <a href="https://github.com/seblum/mlops-platform-dashboard">here</a> for those with a keen interest.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="infrastructure-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="design-decisions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/seblum/kubernetes-training/edit/master/08.3-Deployment-Infrastructure_Modules.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
